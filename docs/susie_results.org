#+PROPERTY: header-args :eval never-export

* PTB Project

** LDSC Results

#+BEGIN_SRC R :dir /home/nwknoblauch/Dropbox/scratch/ptb_scratch/ :session rbio 

  library(tidyverse)
  library(ldmap)
  library(readr)
  library(patchwork)

  lexico_rank <- function(...) {
       args <- rlang::list2(...)
       rank_a <- map(args, rank)
       max_rank <- max(map_dbl(rank_a, max))
       stopifnot(max_rank <= 26)
       let_a <- map(rank_a, ~ letters[.x])
       ret_let <- rlang::exec(paste0, !!!let_a)
       return(rank(ret_let))
     }

  read_sldsc <- function(x,tiss=NA_character_,tiss_name = tiss) {
    cls <- cols(
      Category = col_character(),
      Prop._SNPs = col_double(),
      Prop._h2 = col_double(),
      Prop._h2_std_error = col_double(),
      Enrichment = col_double(),
      Enrichment_std_error = col_double(),
      Enrichment_p = col_double()
    )
    if(is.na(tiss)){
      data_df <- read_tsv(x, col_types = cls)  %>%
        mutate(Category = str_remove(Category,"L?2?_[0-9]+$"),
               Enrichment_q = p.adjust(Enrichment_p, method = "fdr"),
               is_flanking = str_detect(Category, "flanking"),
               Category = str_replace(Category, "hicd-seq-both-dec-HIC", "DSC-Treated_HiC"),
               Category = str_replace(Category, ".+-seq-reproducible-", ""),
               Category = str_replace(Category, "ctr-", "Untreated_"),
               Category = str_replace(Category, "dec-", "Decidualized_"),
               Category = str_replace(Category, glue::glue("{tiss}-"), glue::glue("{tiss_name}_")),
               Category = str_replace(Category, ".+-seq-dec_diff-", "Differential_"),
               DSC_Derived = str_detect(Category, "(Unt)|(Dec)")) %>% arrange(Enrichment_q)
      plot_df <- filter(data_df,DSC_Derived | str_detect(Category,tiss_name)) %>%
        mutate(Sample=str_replace(Category,"(.+)_.+","\\1"),
               Mark=factor(str_replace(Category,".+_(.+)","\\1"))) %>% 
        mutate(Category=fct_reorder(Category,lexico_rank(Mark,Category,Enrichment_p),.desc=TRUE))
    }else{
      stop("you broke it")
    }
    return(plot_df)
  }

    ggpf <- function(df) {
        pa <- ggplot(df, aes(y = Mark, x = Enrichment, col = Sample)) +
            geom_point(position = position_dodge()) + ylab("Genomic Annotation") +
            geom_errorbarh(aes(
                xmin = Enrichment - Enrichment_std_error / 2,
                xmax = Enrichment + Enrichment_std_error / 2
            ),
            position = position_dodge(), height = 0
            ) +
            theme(legend.position = "none")
        pc <- ggplot(df, aes(y = Mark, x = Prop._h2, col = Sample)) +
            geom_point(position = position_dodge()) +
            geom_errorbarh(aes(
                xmin = Prop._h2 - Prop._h2_std_error / 2,
                xmax = Prop._h2 + Prop._h2_std_error / 2
            ), position = position_dodge(), height = 0) +
            theme(
                legend.position = "right",
                axis.title.y = element_blank(),
                axis.text.y = element_blank(),
                axis.ticks.y = element_blank()
            ) + xlab("Proportion of Heritability")
        return(pa + pc)
    }

     ggpf_noneg <- function(df) {
         df <- dplyr::filter(df, DSC_Derived) %>% dplyr::mutate(`Decidualization\n Treatment`=Sample=="Decidualized")
         max_enr <- max(df$Enrichment+df$Enrichment_std_error/2)*1.10
         pa <- df %>% ggplot( aes(y = Category, x = Enrichment,col=`Decidualization\n Treatment`)) +
           geom_point() + ylab("Functional Genomic Annotation") +
           geom_errorbarh(aes(xmin = Enrichment - Enrichment_std_error / 2,
                              xmax = Enrichment + Enrichment_std_error / 2), height = 0) +
           theme(legend.position = "none")+geom_vline(xintercept=1,linetype="dashed")+xlim(c(0,max_enr))
         pc <- ggplot(df, aes(y = Category, x = Prop._h2,col=`Decidualization\n Treatment`)) +
             geom_point() +
             geom_errorbarh(aes(xmin = Prop._h2 - Prop._h2_std_error / 2,
                                xmax = Prop._h2 + Prop._h2_std_error / 2),
                                height = 0) +
             theme(
                 axis.title.y = element_blank(),
                 axis.text.y = element_blank(),
                 axis.ticks.y = element_blank()
             ) +xlab("Prop. of  h2")+theme(legend.position = "none")
         pd <- ggplot(df, aes(y = Category, x = Prop._SNPs,col=`Decidualization\n Treatment`)) +
             geom_point() +
             theme(
                 axis.title.y = element_blank(),
                 axis.text.y = element_blank(),
                 axis.ticks.y = element_blank()
             ) + xlab("Proportion of \nAll GWAS SNPs")
         return(pa+pc+pd)
     }
#+END_SRC

#+RESULTS:



#+BEGIN_SRC R :session rbio :results output graphics :file "~/Dropbox/MOD paper 1/Figures_GWAS/Figure5B.png" :exports both

  #tgene <- readRDS("/home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/genes/15.RDS")

    ##   full_file <- "/home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/ptb/full_reproduciblemerged.results"
    ##   stopifnot(file.exists(full_file))
    ##   full_df <- read_sldsc(full_file)
    ## ggpf_noneg(full_df)

#+END_SRC

#+RESULTS:
[[file:~/Dropbox/MOD paper 1/Figures_GWAS/Figure5B.png]]



** Torus Results


#+BEGIN_SRC R :dir :session rexp 
  library(tidyverse)
  library(ldmap)
  library(readr)
  library(patchwork)
  library(rlang)
  library(fs)
  library(xtable)
  library(furrr)
  library(yaml)
  read_old_rds <- function(x){
  readRDS(x)  %>%
    mutate(snp_struct = ldmap:::migrate_ldmap_snp(snp_struct)) %>%
    rename(snp = snp_struct)
  }
#+END_SRC

#+RESULTS:


*** Torus Parameter Estimates 

Based on the stratified LD score regression results, I've added features to torus.  These features can be found in the table below


#+BEGIN_SRC R :dir :session rexp :colnames yes
  annot_yml <- "../workflow/annots.yaml"
  torus_anno_features <- yaml::read_yaml(annot_yml)$ptb_torus_model

  base_d <- "/home/nwknoblauch/Dropbox/scratch/ptb_scratch/"
  base_f <- fs::dir_ls(fs::path(base_d,"results/plot_data","susie"))
#+END_SRC

#+RESULTS:
| x                                                                                                 |
|---------------------------------------------------------------------------------------------------|
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_15.RDS                  |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_181.RDS                 |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_353.RDS                 |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_356.RDS                 |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_362.RDS                 |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_363.RDS                 |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_373.RDS                 |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_512.RDS                 |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_614.RDS                 |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_973.RDS                 |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_allhic_15.RDS           |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_allhic_181.RDS          |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_allhic_353.RDS          |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_allhic_356.RDS          |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_allhic_362.RDS          |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_allhic_363.RDS          |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_allhic_373.RDS          |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_allhic_512.RDS          |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_allhic_614.RDS          |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_allhic_973.RDS          |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_treatedhic_15.RDS       |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_treatedhic_181.RDS      |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_treatedhic_353.RDS      |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_treatedhic_356.RDS      |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_treatedhic_362.RDS      |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_treatedhic_363.RDS      |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_treatedhic_373.RDS      |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_treatedhic_512.RDS      |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_treatedhic_614.RDS      |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_treatedhic_973.RDS      |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_utme3treatedhic_15.RDS  |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_utme3treatedhic_181.RDS |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_utme3treatedhic_353.RDS |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_utme3treatedhic_356.RDS |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_utme3treatedhic_362.RDS |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_utme3treatedhic_363.RDS |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_utme3treatedhic_373.RDS |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_utme3treatedhic_512.RDS |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_utme3treatedhic_614.RDS |
| /home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_utme3treatedhic_973.RDS |

#+BEGIN_SRC R :dir :session rexp :colnames yes
  enframe(torus_anno_features) %>% 
    mutate(value = map_chr(value,paste0,collapse=",")) %>%
    rename(model = name, features=value)
#+END_SRC

#+RESULTS:
| model              | features                                                                                                                                                                                                                                                                                                                                                                                             |
|--------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| allhic             | chip-seq-dec_diff-H3K27ac,chip-seq-reproducible-ctr-H3K4me1,hicd-seq-both-dec-HIC                                                                                                                                                                                                                                                                                                                    |
| treatedhic         | chip-seq-reproducible-dec-H3K27ac,chip-seq-reproducible-dec-H3K4me1,hicd-seq-both-dec-HIC                                                                                                                                                                                                                                                                                                            |
| reproduciblemerged | chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,chip-seq-reproducible-dec-H3K27ac,chip-seq-reproducible-ctr-H3K27ac,chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC,atac-seq-dec_diff-ATAC,chip-seq-dec_diff-H3K4me3,chip-seq-dec_diff-H3K27ac,chip-seq-dec_diff-H3K4me1,hicd-seq-both-dec-HIC |
| utme3treatedhic    | chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K27ac,chip-seq-reproducible-dec-H3K4me1,hicd-seq-both-dec-HIC                                                                                                                                                                                                                                                                          |
| untreatedhic       | chip-seq-reproducible-ctr-H3K27ac,chip-seq-reproducible-ctr-H3K4me1,hicd-seq-both-dec-HIC                                                                                                                                                                                                                                                                                                            |
| targethic          | chip-seq-dec_diff-H3K27ac,chip-seq-reproducible-ctr-H3K4me1,hicd-seq-target-dec-HIC                                                                                                                                                                                                                                                                                                                  |
| baithic            | chip-seq-dec_diff-H3K27ac,chip-seq-reproducible-ctr-H3K4me1,hicd-seq-bait-dec-HIC                                                                                                                                                                                                                                                                                                                    |

The current Torus model parameter estimates 

#+BEGIN_SRC R :dir :session rexp :colnames yes 

mv_results <- readRDS(fs::path(base_d,"results","torus_ptb_utme3treatedhic_mv.RDS")) %>% 
unnest(cols=c(data))
mv_results  %>% write_tsv("~/tmp/torus_ptb_utme3treatedhic.tsv")
#+END_SRC

#+RESULTS:
| term                              | estimate |     low |    high |                 sd |                 z |                    p |     lik |
|-----------------------------------+----------+---------+---------+--------------------+-------------------+----------------------+---------|
| Intercept                         |  -12.544 | -12.572 | -12.516 | 0.0142857142857136 | -878.080000000041 |                    0 | 47.5227 |
| chip-seq-reproducible-ctr-H3K4me3 |    0.292 |  -1.207 |   1.791 |  0.764795918367347 | 0.381801200800534 |    0.351304414007599 | 47.5227 |
| chip-seq-reproducible-dec-H3K27ac |    0.179 |  -0.469 |   0.827 |  0.330612244897959 |  0.54141975308642 |    0.294109147573619 | 47.5227 |
| chip-seq-reproducible-dec-H3K4me1 |     3.15 |   2.206 |   4.093 |  0.481632653061224 |  6.54025423728814 | 3.07071706370916e-11 | 47.5227 |
| hicd-seq-both-dec-HIC             |     1.35 |   -0.13 |    2.83 |  0.755102040816326 |  1.78783783783784 |   0.0369010871440921 | 47.5227 |


The previous Torus model parameter estimates 

#+BEGIN_SRC R :dir :session rexp :colnames yes 

  mv_result_files <- fs::path(base_d,"results",glue::glue("torus_ptb_{names(torus_anno_features)}_mv.RDS"))
  mv_results_df <- list(feat=names(torus_anno_features),
       files=mv_result_files) %>%
    transpose() %>%
    keep(~file.exists(.x$files)) %>%
    map_df(
      function(x){
        mv_results <- readRDS(x$files) %>% 
          unnest(cols=c(data)) %>% mutate(model=x$feat)
      })
  write_tsv(mv_results_df,"~/tmp/previous_mv_results.tsv")

#+END_SRC

#+RESULTS:
| term                              | estimate |     low |    high |                 sd |                  z |                    p |     lik | model           |
|-----------------------------------+----------+---------+---------+--------------------+--------------------+----------------------+---------+-----------------|
| Intercept                         |  -12.514 | -12.542 | -12.485 | 0.0142857142857145 |  -875.979999999985 |                    0 |  47.379 | allhic          |
| chip-seq-dec_diff-H3K27ac         |    0.071 |  -0.706 |   0.848 |  0.396428571428571 |  0.179099099099099 |    0.428929944692445 |  47.379 | allhic          |
| chip-seq-reproducible-ctr-H3K4me1 |    3.215 |   2.244 |   4.185 |  0.495408163265306 |   6.48959835221421 | 4.30327537026254e-11 |  47.379 | allhic          |
| hicd-seq-both-dec-HIC             |    1.526 |   0.101 |    2.95 |  0.727040816326531 |   2.09891929824561 |   0.0179120076813309 |  47.379 | allhic          |
| Intercept                         |  -12.516 | -12.544 | -12.487 | 0.0142857142857145 |  -876.119999999985 |                    0 | 47.4932 | treatedhic      |
| chip-seq-reproducible-dec-H3K27ac |    0.241 |  -0.367 |    0.85 |  0.310204081632653 |  0.776907894736842 |    0.218606556562197 | 47.4932 | treatedhic      |
| chip-seq-reproducible-dec-H3K4me1 |    3.105 |   2.164 |   4.046 |  0.480102040816326 |   6.46737513283741 | 4.98599402309943e-11 | 47.4932 | treatedhic      |
| hicd-seq-both-dec-HIC             |    1.513 |   0.058 |   2.968 |   0.74234693877551 |   2.03813058419244 |   0.0207684376266758 | 47.4932 | treatedhic      |
| Intercept                         |  -12.544 | -12.572 | -12.516 | 0.0142857142857136 |  -878.080000000041 |                    0 | 47.5227 | utme3treatedhic |
| chip-seq-reproducible-ctr-H3K4me3 |    0.292 |  -1.207 |   1.791 |  0.764795918367347 |  0.381801200800534 |    0.351304414007599 | 47.5227 | utme3treatedhic |
| chip-seq-reproducible-dec-H3K27ac |    0.179 |  -0.469 |   0.827 |  0.330612244897959 |   0.54141975308642 |    0.294109147573619 | 47.5227 | utme3treatedhic |
| chip-seq-reproducible-dec-H3K4me1 |     3.15 |   2.206 |   4.093 |  0.481632653061224 |   6.54025423728814 | 3.07071706370916e-11 | 47.5227 | utme3treatedhic |
| hicd-seq-both-dec-HIC             |     1.35 |   -0.13 |    2.83 |  0.755102040816326 |   1.78783783783784 |   0.0369010871440921 | 47.5227 | utme3treatedhic |
| Intercept                         |   -12.51 | -12.538 | -12.481 | 0.0142857142857145 |  -875.699999999985 |                    0 | 47.4138 | targethic       |
| chip-seq-dec_diff-H3K27ac         |    0.076 |  -0.688 |    0.84 |  0.389795918367347 |  0.194973821989529 |    0.422706720670298 | 47.4138 | targethic       |
| chip-seq-reproducible-ctr-H3K4me1 |    3.216 |   2.245 |   4.187 |  0.495408163265306 |   6.49161688980432 | 4.24599923147062e-11 | 47.4138 | targethic       |
| hicd-seq-target-dec-HIC           |    1.602 |    0.12 |   3.084 |  0.756122448979592 |    2.1187044534413 |   0.0170577258755341 | 47.4138 | targethic       |
| Intercept                         |  -12.657 | -12.685 | -12.628 | 0.0142857142857145 |  -885.989999999985 |                    0 | 47.1702 | baithic         |
| chip-seq-dec_diff-H3K27ac         |    0.018 |  -0.514 |    0.55 |  0.271428571428571 | 0.0663157894736842 |    0.473563206357114 | 47.1702 | baithic         |
| chip-seq-reproducible-ctr-H3K4me1 |    3.677 |   2.645 |    4.71 |  0.526530612244898 |    6.9834496124031 | 1.44009388661232e-12 | 47.1702 | baithic         |
| hicd-seq-bait-dec-HIC             |    1.192 |  -2.943 |   5.327 |   2.10969387755102 |  0.565010882708585 |    0.286033181023359 | 47.1702 | baithic         |


*** Locus level FDR results 

#+BEGIN_SRC R :dir :session rexp :colnames yes 

  fdr_result_files <- fs::path(base_d,"results",glue::glue("torus_ptb_{c(names(torus_anno_features),\"null\")}_fdr.RDS"))
  fdr_results_df <- list(feat=c(names(torus_anno_features),"null"),
                         files=fdr_result_files) %>%
    transpose() %>%
    keep(~file.exists(.x$files)) %>%
    map_df(
        function(x){
          readRDS(x$files) %>% dplyr::select(-rej) %>% 
            mutate(model=x$feat)
        })  %>%
    mutate(locus=ldetect_EUR[region_id]) %>%
    group_by(region_id) %>%
    mutate(n_dec=sum(decision)) %>%
    ungroup() %>% filter(n_dec>0) %>% select(-n_dec,-decision) %>% 
    pivot_wider(names_from = model, values_from = fdr)
    write_tsv(fdr_results_df,"~/tmp/torus_fdr_results.tsv")

#+END_SRC

#+RESULTS:
| region_id | locus                     |      allhic |  treatedhic | utme3treatedhic |   targethic |     baithic |        null |
|-----------+---------------------------+-------------+-------------+-----------------+-------------+-------------+-------------|
|       614 | chr5:156628700_158825698  | 4.03271e-19 | 4.37455e-19 |     4.35846e-19 | 4.01182e-19 | 3.24777e-19 | 3.79167e-19 |
|        15 | chr1:21736588_23086883    | 4.62359e-07 | 5.09993e-07 |     4.33026e-07 | 4.37634e-07 | 4.13806e-07 | 3.38354e-06 |
|       356 | chr3:126214943_128194861  |  6.1507e-07 |  7.1175e-07 |     7.53749e-07 |  5.9305e-07 | 7.14627e-07 | 9.27161e-07 |
|       373 | chr3:154714218_156008700  |   0.0017685 |  0.00173492 |      0.00184284 |  0.00187154 |  0.00187676 |  0.00128931 |
|       353 | chr3:121974097_123517768  |  0.00238978 |     0.00247 |      0.00250298 |  0.00237865 |  0.00227852 |  0.00101615 |
|       973 | chr9:79471208_81079055    |  0.00833534 |  0.00814066 |      0.00796256 |  0.00828002 |  0.00637199 |   0.0178529 |
|       181 | chr2:73174848_75630086    |   0.0257302 |   0.0370334 |       0.0397986 |   0.0243557 |   0.0392233 |    0.113147 |
|       512 | chr4:174264132_176570716  |   0.0338219 |   0.0291498 |       0.0270001 |   0.0315895 |    0.066551 |    0.227073 |
|       362 | chr3:137371083_139954597  |   0.0377881 |   0.0398978 |       0.0398933 |   0.0375853 |    0.028204 |    0.115969 |
|       363 | chr3:139954597_141339097  |   0.0432089 |    0.038527 |       0.0356205 |   0.0422462 |   0.0384497 |     0.18815 |
|       437 | chr4:48123600_53877433    |    0.165432 |    0.172089 |        0.164931 |    0.219346 |    0.164251 |    0.272008 |
|        18 | chr1:25516845_27401867    |    0.181203 |     0.19758 |        0.195441 |    0.180293 |    0.142229 |     0.40751 |
|      1482 | chr16:87647349_89041165   |    0.206877 |    0.209965 |        0.205798 |    0.203702 |    0.185519 |    0.478827 |
|      1377 | chr14:103012102_105001723 |    0.212718 |      0.1971 |        0.207273 |    0.209864 |    0.190315 |    0.394185 |
|       281 | chr3:4431647_6083183      |    0.277441 |    0.277132 |        0.282833 |    0.276637 |    0.307011 |    0.097318 |


*** Susie Fine mapping results
    
**** HAND2 and GATA2

 I used the torus enrichment estimates to generate priors and ran susie, using the ~utme3treatedhic~ model.
 Here are the results for the GATA2 and HAND2 loci. The "~old~" model is ~allhic~

 First the HAND2 results
 #+BEGIN_SRC R :dir :session rexp :colnames yes

   handfile <- "/home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_utme3treatedhic_512.RDS"
   ohandfile <- "/home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_allhic_512.RDS"

   handdf <- read_old_rds(handfile)
   ohanddf <- read_old_rds(ohandfile) %>% 
     rename(old_pip=pip,old_prior=prior,old_CS=CS)

   filter(handdf,pip>0.05) %>% arrange(desc(pip)) 
 #+END_SRC

 #+RESULTS:
 | snp                |      pval |      prior |                pip | CS   |
 |--------------------+-----------+------------+--------------------+------|
 | chr4:174728703_C_T |  3.86e-07 | 0.00051366 |  0.381114818123928 | TRUE |
 | chr4:174729014_G_A | 4.482e-07 | 0.00051366 |  0.329331089464829 | TRUE |
 | chr4:174729270_A_G | 5.175e-07 | 0.00013325 | 0.0742724933484663 | TRUE |
 | chr4:174729550_C_T |  4.98e-07 | 9.9467e-05 |  0.057620400846482 | TRUE |
 | chr4:174741209_C_T | 5.796e-07 | 9.9467e-05 |   0.05060760706165 | TRUE |
 | chr4:174728566_T_G | 7.909e-07 | 0.00013325 | 0.0505149760256708 | TRUE |

 And now the new HAND2 results compared to the old results

 #+BEGIN_SRC R :dir :session rexp :colnames yes
 inner_join(handdf,ohanddf) %>% filter(pip>0.05 | old_pip > 0.05) %>% arrange(desc(pip))

 #+END_SRC

 #+RESULTS:
 | snp                |      pval |      prior |                pip | CS   |  old_prior |             old_pip | old_CS |
 |--------------------+-----------+------------+--------------------+------+------------+---------------------+--------|
 | chr4:174728703_C_T |  3.86e-07 | 0.00051366 |  0.381114818123928 | TRUE | 0.00045245 |   0.422981933535501 | TRUE   |
 | chr4:174729014_G_A | 4.482e-07 | 0.00051366 |  0.329331089464829 | TRUE | 0.00045245 |    0.36550309640011 | TRUE   |
 | chr4:174729270_A_G | 5.175e-07 | 0.00013325 | 0.0742724933484663 | TRUE | 9.8435e-05 |  0.0691299876680923 | TRUE   |
 | chr4:174729550_C_T |  4.98e-07 | 9.9467e-05 |  0.057620400846482 | TRUE | 9.8435e-05 |  0.0718463928995937 | TRUE   |
 | chr4:174741209_C_T | 5.796e-07 | 9.9467e-05 |   0.05060760706165 | TRUE |  3.955e-06 | 0.00253533082794133 | FALSE  |
 | chr4:174728566_T_G | 7.909e-07 | 0.00013325 | 0.0505149760256708 | TRUE | 9.8435e-05 |  0.0470152148531499 | TRUE   |


 Next the GATA2 results

 #+BEGIN_SRC R :dir :session rexp :colnames yes
 ogatafile <- "/home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_allhic_356.RDS"
 gatafile <- "/home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/ptb_utme3treatedhic_356.RDS"
 ogatadf <- read_old_rds(ogatafile) %>% rename(old_pip=pip,old_prior=prior,old_CS=CS)
 gatadf <- read_old_rds(gatafile) 
 filter(gatadf,pip>0.05) %>% arrange(desc(pip)) 
 #+END_SRC

 #+RESULTS:
 | snp                |      pval |      prior |                pip | CS   |
 |--------------------+-----------+------------+--------------------+------|
 | chr3:127889287_A_G | 5.401e-12 |  0.0003207 |  0.181751312175621 | TRUE |
 | chr3:127878416_G_A | 2.008e-12 | 8.3182e-05 |   0.11894897541832 | TRUE |
 | chr3:127895986_G_A | 1.221e-11 | 0.00038347 |  0.098883034177444 | TRUE |
 | chr3:127898501_A_C | 6.389e-12 | 0.00013325 | 0.0649480930862608 | TRUE |
 | chr3:127936527_T_C | 4.311e-12 | 8.3182e-05 | 0.0577792799723961 | TRUE |
 | chr3:127936532_T_C | 4.311e-12 | 8.3182e-05 | 0.0577792799723961 | TRUE |
 | chr3:127937645_G_A | 4.419e-12 | 8.3182e-05 | 0.0566819421381121 | TRUE |


 And the most recent GATA2 results compared to the old GATA2 results
 #+BEGIN_SRC R :dir :session rexp :colnames yes
 inner_join(gatadf,ogatadf) %>% filter(pip>0.05 | old_pip > 0.05) %>% arrange(desc(pip))
 #+END_SRC

 #+RESULTS:
 | snp                |      pval |      prior |                 pip | CS   |  old_prior |            old_pip | old_CS |
 |--------------------+-----------+------------+---------------------+------+------------+--------------------+--------|
 | chr3:127889287_A_G | 5.401e-12 |  0.0003207 |   0.181751312175621 | TRUE | 0.00042058 |  0.194352857926694 | TRUE   |
 | chr3:127878416_G_A | 2.008e-12 | 8.3182e-05 |    0.11894897541832 | TRUE |   9.15e-05 |  0.106690485282052 | TRUE   |
 | chr3:127895986_G_A | 1.221e-11 | 0.00038347 |   0.098883034177444 | TRUE | 0.00042058 | 0.0884289806633446 | TRUE   |
 | chr3:127898501_A_C | 6.389e-12 | 0.00013325 |  0.0649480930862608 | TRUE |   9.15e-05 | 0.0363649042118332 | TRUE   |
 | chr3:127936527_T_C | 4.311e-12 | 8.3182e-05 |  0.0577792799723961 | TRUE | 9.8435e-05 | 0.0557517016478215 | TRUE   |
 | chr3:127936532_T_C | 4.311e-12 | 8.3182e-05 |  0.0577792799723961 | TRUE | 9.8435e-05 | 0.0557517016478215 | TRUE   |
 | chr3:127937645_G_A | 4.419e-12 | 8.3182e-05 |  0.0566819421381121 | TRUE | 9.8435e-05 | 0.0546928464986421 | TRUE   |
 | chr3:127920023_T_C | 3.339e-12 | 3.5663e-06 | 0.00317996792616315 | TRUE |   9.15e-05 | 0.0665264495233288 | TRUE   |

**** All Susie results

 All (or at least several) of the previous results

 #+BEGIN_SRC R :session rexp 

     afile_d <- "/home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/susie/"
     all_sfiles <- dir_ls(afile_d,regexp=".+/ptb_[a-zA-Z0-9]+_[0-9]+.RDS")
     null_sfiles  <- dir_ls(afile_d) %>% keep(~ !.x %in% all_sfiles) 

     afiles <- fs::dir_ls(afile_d,regexp="*utme3treatedhic*")
     oldfiles <- fs::dir_ls(afile_d,regexp="*allhic*")

     num_match <- function(p,q,cutoff=0.05){
     sum(p>cutoff)/sum(q>cutoff)
     }

   new_susie_fun <- function(x){
       rel_file <- path_file(x)
       model <- str_replace(rel_file,"ptb_(.+)_([0-9]+)\\.RDS","\\1")
       if(model==rel_file){
         model <- "uniform"
         region_id <- as.integer(str_replace(rel_file,"ptb_([0-9]+)\\.RDS","\\1"))
       }else{
         region_id <- as.integer(str_replace(rel_file,"ptb_(.+)_([0-9]+)\\.RDS","\\2"))
       }
       ddf <- read_old_rds(x) %>% mutate(region_id=region_id,model=model)
     }

     susie_fun <- function(x){
         regions <- as.integer(stringr::str_replace(x,".+_([0-9]+).RDS","\\1"))
         nullf <- fs::path(afile_d,glue::glue("ptb_{regions}.RDS"))
         nulldf <- read_old_rds(nullf) %>% select(snp,uniform_pip=pip,uniform_prior=prior)
         read_old_rds(x) %>% 
         mutate(region_id=regions,ldmr=ldetect_EUR[regions]) %>% 
         inner_join(nulldf,by=c("snp"))
       }

   all_susie_df <- map_df(c(all_sfiles,null_sfiles),new_susie_fun) %>%
     mutate(snp = as_ldmap_snp(snp),
            locus=ldetect_EUR[region_id]) %>%
     pivot_wider(names_from = model,
                 values_from = c(prior, pip, CS))
   write_tsv(all_susie_df,"~/tmp/all_susie_results.tsv")
 #+END_SRC

 #+RESULTS:


 #+BEGIN_SRC R :session rexp :colnames yes 
 arrange(all_susie_df,desc(pip_utme3treatedhic)) %>% head(20)
 #+END_SRC

 #+RESULTS:
 | snp                |      pval | region_id | locus                    | prior_allhic | prior_treatedhic | prior_utme3treatedhic | prior_uniform |         pip_allhic |     pip_treatedhic | pip_utme3treatedhic |         pip_uniform | CS_allhic | CS_treatedhic | CS_utme3treatedhic | CS_uniform |
 |--------------------+-----------+-----------+--------------------------+--------------+------------------+-----------------------+---------------+--------------------+--------------------+---------------------+---------------------+-----------+---------------+--------------------+------------|
 | chr3:138843356_G_A | 3.824e-08 |       362 | chr3:137371083_139954597 |     9.15e-05 |       8.1838e-05 |            8.3182e-05 |    1.3271e-05 |  0.769104566742526 |  0.729117596855732 |   0.740639510360678 |   0.371769784624563 | TRUE      | TRUE          | TRUE               | TRUE       |
 | chr5:157884706_T_C | 3.036e-26 |       614 | chr5:156628700_158825698 |     9.15e-05 |       8.1838e-05 |            8.3182e-05 |    1.3271e-05 |  0.734647393858015 |    0.7127440486504 |    0.72179868954602 |   0.100101144641595 | TRUE      | TRUE          | TRUE               | TRUE       |
 | chr4:174728703_C_T |  3.86e-07 |       512 | chr4:174264132_176570716 |   0.00045245 |       0.00047278 |            0.00051366 |    1.3271e-05 |  0.422981933535501 |  0.379611842386748 |   0.381114818123928 |   0.106475089896024 | TRUE      | TRUE          | TRUE               | TRUE       |
 | chr2:74206685_G_A  | 4.677e-07 |       181 | chr2:73174848_75630086   |   0.00042058 |       0.00047278 |            0.00038347 |    1.3271e-05 |   0.25034174258487 |  0.404702948629355 |   0.353729177223882 |  0.0383732007204524 | TRUE      | FALSE         | FALSE              | FALSE      |
 | chr3:123062970_G_C | 4.107e-09 |       353 | chr3:121974097_123517768 |     9.15e-05 |       8.1838e-05 |            8.3182e-05 |    1.3271e-05 |  0.354539359119522 |    0.3279602434816 |   0.337861345969416 |   0.021699192981317 | TRUE      | TRUE          | TRUE               | TRUE       |
 | chr4:174729014_G_A | 4.482e-07 |       512 | chr4:174264132_176570716 |   0.00045245 |       0.00047278 |            0.00051366 |    1.3271e-05 |   0.36550309640011 |  0.328032648205271 |   0.329331089464829 |  0.0920232212877282 | TRUE      | TRUE          | TRUE               | TRUE       |
 | chr1:22470407_C_T  |  2.34e-12 |        15 | chr1:21736588_23086883   |   0.00042058 |       0.00037147 |            0.00042959 |    1.3271e-05 |  0.316885062692171 |   0.30892025080494 |   0.302745288641221 |  0.0725333259298856 | TRUE      | TRUE          | TRUE               | TRUE       |
 | chr1:22470451_G_C  |  2.34e-12 |        15 | chr1:21736588_23086883   |   0.00042058 |       0.00037147 |            0.00042959 |    1.3271e-05 |  0.316885062692171 |   0.30892025080494 |   0.302745288641221 |  0.0725333259298856 | TRUE      | TRUE          | TRUE               | TRUE       |
 | chr1:22468215_C_T  | 6.414e-13 |        15 | chr1:21736588_23086883   |     9.15e-05 |       8.1838e-05 |            0.00011143 |    1.3271e-05 |  0.239045674730662 |  0.235979274389145 |    0.27230339640513 |   0.251585635073609 | TRUE      | TRUE          | TRUE               | TRUE       |
 | chr3:155868039_G_A | 5.041e-09 |       373 | chr3:154714218_156008700 |   9.8435e-05 |       0.00010417 |            9.9467e-05 |    1.3271e-05 |  0.234046556630847 |  0.243481956093274 |   0.247185586838391 |  0.0230192688978053 | TRUE      | TRUE          | TRUE               | TRUE       |
 | chr3:139029676_G_A | 1.783e-07 |       362 | chr3:137371083_139954597 |     9.15e-05 |       0.00010417 |            9.9467e-05 |    1.3271e-05 |  0.183380167228432 |  0.221325452175758 |   0.211193096775336 |    0.08857539325385 | TRUE      | TRUE          | TRUE               | TRUE       |
 | chr3:155867092_A_G | 5.515e-09 |       373 | chr3:154714218_156008700 |     9.15e-05 |       8.1838e-05 |            8.3182e-05 |    1.3271e-05 |  0.201179999970016 |  0.176886189345687 |    0.19115688143615 |  0.0212864612808022 | TRUE      | TRUE          | TRUE               | TRUE       |
 | chr2:74207357_G_A  | 2.178e-07 |       181 | chr2:73174848_75630086   |     9.15e-05 |       0.00010417 |            9.9467e-05 |    1.3271e-05 |  0.110018144915005 |  0.180304984217642 |   0.185530071716854 |  0.0775039734019111 | TRUE      | FALSE         | FALSE              | FALSE      |
 | chr3:127889287_A_G | 5.401e-12 |       356 | chr3:126214943_128194861 |   0.00042058 |       0.00037147 |             0.0003207 |    1.3271e-05 |  0.194352857926694 |  0.198889051022433 |   0.181751312175621 | 0.00914146130218985 | TRUE      | TRUE          | TRUE               | TRUE       |
 | chr2:74230656_C_T  | 3.858e-07 |       181 | chr2:73174848_75630086   |   9.8435e-05 |       0.00010417 |            0.00013325 |    1.3271e-05 | 0.0697340168232613 |  0.106154082343996 |   0.146327332168703 |    0.04566915756667 | TRUE      | FALSE         | FALSE              | FALSE      |
 | chr3:127878416_G_A | 2.008e-12 |       356 | chr3:126214943_128194861 |     9.15e-05 |       8.1838e-05 |            8.3182e-05 |    1.3271e-05 |  0.106690485282052 |   0.11055779400468 |    0.11894897541832 |  0.0230735608852745 | TRUE      | TRUE          | TRUE               | TRUE       |
 | chr3:141106063_T_C | 2.158e-06 |       363 | chr3:139954597_141339097 |   0.00045245 |       0.00047278 |            0.00051366 |    1.3271e-05 |  0.115733420336536 |  0.107265676682021 |   0.107334842154585 |  0.0175512912059427 | TRUE      | TRUE          | TRUE               | FALSE      |
 | chr9:80472931_C_T  | 7.031e-08 |       973 | chr9:79471208_81079055   |     9.15e-05 |       0.00010417 |            9.9467e-05 |    1.3271e-05 |  0.101060314901284 |  0.112225911200875 |   0.104850691148267 |  0.0316881976915664 | FALSE     | FALSE         | FALSE              | FALSE      |
 | chr3:127895986_G_A | 1.221e-11 |       356 | chr3:126214943_128194861 |   0.00042058 |       0.00047278 |            0.00038347 |    1.3271e-05 | 0.0884289806633446 |  0.115176193776859 |   0.098883034177444 | 0.00415817719491285 | TRUE      | TRUE          | TRUE               | FALSE      |
 | chr2:74235926_A_G  | 4.006e-07 |       181 | chr2:73174848_75630086   |     9.15e-05 |       8.1838e-05 |            8.3182e-05 |    1.3271e-05 | 0.0625783827089197 | 0.0805073724913481 |  0.0881807530820088 |  0.0440894053182422 | TRUE      | FALSE         | FALSE              | FALSE      |


 #+BEGIN_SRC R :dir :session rexp :colnames yes 

     susie_df <- map_df(afiles, susie_fun) %>% mutate(snp = as_ldmap_snp(snp),ldmr=as_ldmap_region(ldmr))
     old_susie_df <- map_df(oldfiles, susie_fun) %>% 
       mutate(snp = as_ldmap_snp(snp),ldmr=as_ldmap_region(ldmr)) %>% 
       rename(old_prior = prior,old_pip=pip,old_CS=CS) %>% 
       inner_join(susie_df) %>% 
       mutate(credible_set = case_when(old_CS & CS ~ "both",
                                     CS & !old_CS ~ "new_only",
                                     !CS & old_CS ~ "old_only",
                                     !CS & !old_CS ~ "neither"))
     write_tsv(old_susie_df,"~/tmp/old_vs_new_susie.tsv")

 #+END_SRC

 #+RESULTS:

 A plot of pips from two most recent models: 

 #+BEGIN_SRC R :dir :session rexp :colnames yes :results output graphics :file "old_vs_new.png"
   ggplot(old_susie_df,aes(x=old_pip,y=pip,col=credible_set))+geom_abline(slope=1,intercept=0)+geom_point()+facet_wrap(~credible_set)
 #+END_SRC

 #+RESULTS:



 #+BEGIN_SRC R :dir :session rexp 

   regions <- distinct(susie_df,region_id) %>% pull(region_id)

   anno_dirf <- "~/Dropbox/scratch/ptb_scratch/new_bed"
   annot_yml <- "../workflow/annots.yaml"
   torus_feature_sets <- yaml::read_yaml(annot_yml)$ptb_torus_model
   
   
   anno_features <- yaml::read_yaml(annot_yml)$ptb_torus_model$reproduciblemerged
   anno_features <- c(str_replace(anno_features,"hicd-seq-both-dec-HIC","hicd-seq-bait-dec-HIC"),"hicd-seq-target-dec-HIC")
   anno_files <- fs::path(anno_dirf,anno_features,ext="bed.bz2")

   anno_f <- dplyr::if_else(file.exists(anno_files),anno_files,path_ext_remove(anno_files))

   bed_fun <- function(x, ldmrs){
     inpf <- path(anno_dirf, x, ext = "bed.bz2")
     inpf <- dplyr::if_else(file.exists(inpf),inpf,path_ext_remove(inpf))
     read_bed(inpf) %>%
       mutate(rir = region_in_region(ldmap_region,ldmrs)) %>%
       filter(!is.na(rir)) %>%
       mutate(ldmr = ldmrs[rir],anno=x)  %>%
       select(-rir)
   }
   anno_df <- map_df(anno_features, bed_fun,ldmrs = ldetect_EUR[regions]) %>%
     mutate(ldmap_region = as_ldmap_region(ldmap_region),
            ldmr = as_ldmap_region(ldmr)) %>%
     arrange(ldmap_region)

   susie_l <- split(susie_df, susie_df$ldmr) %>%
       map(function(df) {
           select(df, tag_snp = snp, tag_pval = pval, region_id) %>%
               filter(tag_pval == min(tag_pval)) %>%
               slice(1) %>%
               inner_join(df,by="region_id")
       })
   anno_l <- split(anno_df, anno_df$ldmr) %>% map(~nest(.x,data=c(ldmap_region)))

   susie_anno_l <- map2(susie_l,anno_l, function(sdf,adf){
     map_dfc(set_names(adf$data,adf$anno), function(rdf,snpv){
       snpv %overlaps% rdf$ldmap_region
     },snpv=sdf$snp) %>% mutate(snp=sdf$snp) %>%
       select(snp,everything()) %>%
       pivot_longer(-snp) %>%
       group_by(snp) %>%
       summarise(anno=list(name[value])) %>%
       ungroup()  %>%
       inner_join(sdf,by="snp") %>% select(-region_id) 
   })

   fine_sal <- map(susie_anno_l,~filter(.x,pip>0.05 | pval==min(pval))) 
 #+END_SRC

 #+RESULTS:


**** KL divergence experiments

 Can we use KL divergence to summarise the performance the model?  Below is the per-locus KL of the following 

 1) ~KL_pip2~ $D_{KL}(\text{PIP}_{model} || \text{PIP}_{uniform})$
 2) ~KL_model~ $D_{KL}(\text{PIP}_{model} || \text{Prior}_{model})$
 3) ~KL_uniform~ $D_{KL}(\text{PIP}_{model} || \text{Prior}_{model})$
 4) ~rat_KL~ $\frac{D_{KL}(\text{PIP}_{model} || \text{Prior}_{model})}{D_{KL}(\text{PIP}_{uniform} || \text{Prior}_{uniform})}$


 #+BEGIN_SRC R :dir :session rexp :colnames yes
   klfun <- function(p,q){
     pl <- p!=0 & q!=0
     p <- p[pl]
     q <- q[pl]
     sum(p * (log(p)-log(q)),na.rm=FALSE)
   }

   KL_df <- group_by(susie_df,ldmr) %>% summarise(KL_pip2pip=klfun(pip,uniform_pip),
                                                  KL_model=klfun(pip,prior),
                                                  KL_uniform=klfun(uniform_pip,uniform_prior)) %>%
     mutate(rat_KL=KL_model/KL_uniform) %>%
     arrange(desc(rat_KL))

   KL_df
 #+END_SRC



 #+RESULTS:
 | x    |
 |------|
 | TRUE |


 And a sum over all loci

 #+BEGIN_SRC R :dir :session rexp :colnames yes
 summarise(KL_df,model=sum(KL_model),uniform=sum(KL_uniform),pip2pip=sum(KL_pip2pip),rat=model/uniform)
 #+END_SRC

 #+RESULTS:
 |            model |          uniform |         pip2pip |               rat |
 |------------------+------------------+-----------------+-------------------|
 | 71.6008325389941 | 80.1206323331744 | 8.7918583393835 | 0.893662848805892 |


 Intuitively, there should bee more information (higher KL divergence) in uniform pip vs prior compared to the model pip vs prior. Not sure what else to make of this.

** Nearest gene

What are the nearest genes to our fine mapped SNPs?  Distance here is defined as the minimum distance to any part of the gene.  A distance of ~0~ means that there is overlap between the query and the target.

#+BEGIN_SRC R :dir :session rexp :colnames yes
  plan(tweak(multiprocess, workers = 2L))
    genef <- glue::glue("/home/nwknoblauch/Dropbox/scratch/ptb_scratch/results/plot_data/genes/{regions}.RDS")

    genel <- future_map2(genef, regions, function(x, y) {
        tgdf <- readRDS(x)
        tgdf %@% ranges %>%
            as_tibble() %>%
            select(symbol = names, start, end) %>%
            mutate(
                chrom = as.integer(str_remove(as.character(tgdf@seqnames), "^chr")),
                ldmr = ldetect_EUR[y]
            ) %>%
            compact_ldmap_region() %>%
            group_by(symbol, ldmr) %>%
            summarise(gene_region = convex_hull(ldmap_region)) %>%
            ungroup() %>%
            arrange(gene_region)
    },
    .options = future_options(packages = c("ldmap", "tidyverse", "rlang"))
    ) %>%
        set_names(ldetect_EUR[regions])



    stopifnot(all.equal(names(genel), names(fine_sal)))


    anno_gl <- map2_dfr(genel, anno_l, function(gdf, adf) {
        rdf <- full_join(gdf, unnest(adf, cols = data), by = c("ldmr")) %>%
            mutate(anno_gene_dist = distance(ldmap_region, gene_region)) %>%
            group_by(symbol, anno) %>%
            filter(abs(anno_gene_dist) == min(abs(anno_gene_dist))) %>%
            slice(1) %>%
            ungroup()
    }) %>% mutate(
        ldmap_region = as_ldmap_region(ldmap_region),
        ldmr = as_ldmap_region(ldmr),
        gene_region = as_ldmap_region(gene_region)
    )
#+END_SRC

#+RESULTS:

#+BEGIN_SRC R :dir :session rexp :colnames yes


    asgl <- map2_dfr(genel, susie_anno_l, function(gdf, sdf) {
      full_join(sdf, gdf, by = c("ldmr")) %>%
        mutate(gene_dist = distance(snp, gene_region)) %>%
        group_by(snp) %>%
        filter(gene_dist == min(gene_dist)) %>%
        ungroup()
    }) %>% mutate(
             snp = as_ldmap_snp(snp),
             tag_snp=as_ldmap_snp(tag_snp),
             ldmr = as_ldmap_region(ldmr),
             gene_region = as_ldmap_region(gene_region)
           )
    basgl <- left_join(dplyr::select(asgl,-anno),unnest(asgl,cols=c(anno)))
    basgl <- mutate(basgl,`Genomic Feature`=if_else(is.na(anno),
                                                    "None",
                                                    str_replace(anno,".+-([^-]+)","\\1"))) %>%
      distinct(snp,`Genomic Feature`, .keep_all=TRUE) %>% rename(`Functional PIP`=pip,`Uniform PIP`=uniform_pip)

    basgl <- mutate(basgl,`Genomic Feature`=factor(case_when(
                            `Genomic Feature` %in% c("H3K4me1","H3K27ac") ~ "Enhancer: H3K4me1 or H3K27ac",
                            `Genomic Feature` == "H3K4me3" ~ "Promoter: H3K4me3",
                            `Genomic Feature` == "HIC" ~ "HiC",
                            TRUE ~ "None/Other"),levels=c("Enhancer: H3K4me1 or H3K27ac",
                                                          "Promoter: H3K4me3",
                                                          "HiC",
                                                          "None/Other"))
                            )




    sgl <- map2_dfr(genel, fine_sal, function(gdf, sdf) {
        full_join(sdf, gdf, by = c("ldmr")) %>%
            mutate(gene_dist = abs(distance(snp, gene_region))) %>%
            group_by(snp) %>%
            filter(gene_dist == min(gene_dist)) %>%
            ungroup()
    }) %>% mutate(
        snp = as_ldmap_snp(snp),
        tag_snp=as_ldmap_snp(tag_snp),
        ldmr = as_ldmap_region(ldmr),
        gene_region = as_ldmap_region(gene_region)
    )

#+END_SRC

#+RESULTS:


As an aside, it's is also possible to map annotations to genes, as I've done here.

# #+BEGIN_SRC R :dir :session rexp :colnames yes
# filter(anno_gl,str_detect(anno,"dec_diff")) %>%
#  arrange(abs(anno_gene_dist)) %>% 
# group_by(symbol,anno) %>% 
# filter(abs(anno_gene_dist)==min(abs(anno_gene_dist))) %>% slice(1) %>% 
# ungroup()  %>% filter(abs(anno_gene_dist)<5000) %>% arrange(symbol,abs(anno_gene_dist),anno) %>% head(50)
# #+END_SRC



** Nearest HI-C

#+BEGIN_SRC R :dir :session rexp :colnames yes

  hicf <- "/home/nwknoblauch/Dropbox/scratch/ptb_scratch/new_bed/DT1_dTL4_D_48h.ibed"
  cold <- cols(
      bait_chr = col_factor(paste0("chr", c(as.character(1:22), c("X","Y")))),
      bait_start = col_double(),
      bait_end = col_double(),
      bait_name = col_character(),
      otherEnd_chr = col_factor(paste0("chr", c(as.character(1:22), c("X","Y")))),
      otherEnd_start = col_double(),
      otherEnd_end = col_double(),
      otherEnd_name = col_character(),
      N_reads = col_double(),
      score = col_double()
    )
  hicdf <- readr::read_tsv(hicf,col_names=names(cold$cols),col_types=cold,skip=1L)
  hicdf <- hicdf %>% mutate(bait_symbol=str_replace(bait_name,"([^\\*]+)\\*.+","\\1"),
         target_symbol=str_replace(otherEnd_name,"([^\\*]+)\\*.+","\\1"))


  bait_ld <- tibble::tibble(hic_region = new_ldmap_region(hicdf$bait_chr,
                                                     hicdf$bait_start,
                                                     hicdf$bait_end),

                            bait_gene = hicdf$bait_symbol,
                            target_gene=hicdf$target_symbol,
                            hic_id=seq_along(hicdf$bait_chr)) %>%
    mutate(locus_id = region_in_region(hic_region, ldetect_EUR),
           type="bait") %>%
    mutate(ldmr = ldetect_EUR[locus_id]) %>%
    filter(locus_id %in% regions, !is.na(locus_id)) %>% distinct() %>% 
    arrange(hic_region) 


  hhic_df <- compact_ldmap_region(hicdf,chrom="bait_chr",start="bait_start",end="bait_end")  %>% rename(bait_region=ldmap_region) %>% compact_ldmap_region(chrom="otherEnd_chr",start="otherEnd_start",end="otherEnd_end") %>% rename(target_region=ldmap_region)

  target_ld <- tibble::tibble(hic_region = new_ldmap_region(hicdf$otherEnd_chr,
                                                       hicdf$otherEnd_start,
                                                       hicdf$otherEnd_end),
                              bait_gene = hicdf$bait_symbol,
                              target_gene = hicdf$target_symbol,
                              hic_id=seq_along(hicdf$target_symbol)) %>%
    mutate(locus_id = region_in_region(hic_region,ldetect_EUR),
           type="target") %>%
    mutate(ldmr = ldetect_EUR[locus_id]) %>% distinct() %>% 
    filter(locus_id %in% regions, !is.na(locus_id))

  hic_dl <- bind_rows(target_ld,bait_ld)  %>% mutate(ldmr=as_ldmap_region(ldmr),hic_region=as_ldmap_region(hic_region)) %>% arrange(hic_region) %>% split(.$ldmr)

  hic_nearest <- map_dfr(names(hic_dl), function(x){
    sdf <- susie_anno_l[[x]]
    gdf <- hic_dl[[x]]
    full_join(sdf, gdf, by = c("ldmr")) %>%
      mutate(hic_dist = abs(distance(snp, hic_region))) %>%
      group_by(snp) %>% 
      filter(hic_dist == min(hic_dist)) %>% distinct() %>% 
      ungroup() 
  }) %>% mutate(
           snp = as_ldmap_snp(snp),
           tag_snp=as_ldmap_snp(tag_snp),
           ldmr = as_ldmap_region(ldmr),
           hic_region = as_ldmap_region(hic_region)
         )

  hic_sgl <- inner_join(sgl,dplyr::select(hic_nearest,-anno)) %>%
    distinct() %>%
    arrange(desc(pip))

  hic_sgl %>% mutate(anno=map_chr(anno,paste0,collapse=","))
#+END_SRC


  #+RESULTS:
  | snp                | anno                                                                                                                                                                                                                                                                                                                                                                           | tag_snp            |  tag_pval |      pval |      prior |                 pip | CS    | ldmr                     |         uniform_pip | uniform_prior | symbol    | gene_region              | gene_dist | hic_region               | bait_gene | target_gene | hic_id | locus_id | type   | hic_dist |
  |--------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+--------------------+-----------+-----------+------------+---------------------+-------+--------------------------+---------------------+---------------+-----------+--------------------------+-----------+--------------------------+-----------+-------------+--------+----------+--------+----------|
  | chr3:138843356_G_A | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1                                                                                                                                                                                                                                                                                                            | chr3:139004333_A_G | 2.667e-08 | 3.824e-08 | 8.3182e-05 |   0.740639510360678 | TRUE  | chr3:137371083_139954597 |   0.371769784624563 |    1.3271e-05 | BPESC1    | chr3:138823027_138844005 |         0 | chr3:138831264_138835574 | FOXL2     |           0 | 119881 |      362 | target |     7782 |
  | chr3:138843356_G_A | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1                                                                                                                                                                                                                                                                                                            | chr3:139004333_A_G | 2.667e-08 | 3.824e-08 | 8.3182e-05 |   0.740639510360678 | TRUE  | chr3:137371083_139954597 |   0.371769784624563 |    1.3271e-05 | BPESC1    | chr3:138823027_138844005 |         0 | chr3:138831264_138835574 | COPB2     |           0 | 119916 |      362 | target |     7782 |
  | chr5:157884706_T_C | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1                                                                                                                                                                                                                                                                                                            | chr5:157888115_C_T | 1.637e-26 | 3.036e-26 | 8.3182e-05 |    0.72179868954602 | TRUE  | chr5:156628700_158825698 |   0.100101144641595 |    1.3271e-05 | EBF1      | chr5:158122923_158526788 |    238217 | chr5:157891243_157891553 | CLINT1    |           0 | 134395 |      614 | target |     6537 |
  | chr4:174728703_C_T | chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-dec-H3K27ac,chip-seq-reproducible-ctr-H3K27ac,chip-seq-dec_diff-H3K27ac,chip-seq-reproducible-ctr-H3K4me3,chip-seq-dec_diff-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC,atac-seq-dec_diff-ATAC,hicd-seq-target-dec-HIC,chip-seq-dec_diff-H3K4me1           | chr4:174734471_G_A | 3.681e-07 |  3.86e-07 | 0.00051366 |   0.381114818123928 | TRUE  | chr4:174264132_176570716 |   0.106475089896024 |    1.3271e-05 | HAND2-AS1 | chr4:174451609_174506879 |    221824 | chr4:174728688_174729180 | HAND2     |           0 | 127925 |      512 | target |        0 |
  | chr2:74206685_G_A  | hicd-seq-target-dec-HIC,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-dec-H3K27ac                                                                                                                                                                                                                                                  | chr2:74217283_G_T  | 1.549e-07 | 4.677e-07 | 0.00038347 |   0.353729177223882 | FALSE | chr2:73174848_75630086   |  0.0383732007204524 |    1.3271e-05 | TET3      | chr2:74213531_74335302   |      6846 | chr2:74206346_74207145   | WBP1      |           0 |  97391 |      181 | target |        0 |
  | chr3:123062970_G_C | chip-seq-reproducible-dec-H3K4me1,atac-seq-reproducible-ctr-ATAC,atac-seq-reproducible-dec-ATAC,chip-seq-reproducible-ctr-H3K4me1                                                                                                                                                                                                                                              | chr3:123085359_C_T |  8.56e-10 | 4.107e-09 | 8.3182e-05 |   0.337861345969416 | TRUE  | chr3:121974097_123517768 |   0.021699192981317 |    1.3271e-05 | ADCY5     | chr3:123001143_123167392 |         0 | chr3:123068783_123069729 | SEMA5B    |           0 | 118977 |      353 | target |     5813 |
  | chr4:174729014_G_A | chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-dec-H3K27ac,chip-seq-reproducible-ctr-H3K27ac,chip-seq-dec_diff-H3K27ac,chip-seq-reproducible-ctr-H3K4me3,chip-seq-dec_diff-H3K4me3,chip-seq-reproducible-dec-H3K4me3,hicd-seq-target-dec-HIC,chip-seq-dec_diff-H3K4me1                                                              | chr4:174734471_G_A | 3.681e-07 | 4.482e-07 | 0.00051366 |   0.329331089464829 | TRUE  | chr4:174264132_176570716 |  0.0920232212877282 |    1.3271e-05 | HAND2-AS1 | chr4:174451609_174506879 |    222135 | chr4:174728688_174729180 | HAND2     |           0 | 127925 |      512 | target |        0 |
  | chr1:22470407_C_T  | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC,hicd-seq-bait-dec-HIC,hicd-seq-target-dec-HIC                                                                                                                            | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE  | chr1:21736588_23086883   |  0.0725333259298856 |    1.3271e-05 | WNT4      | chr1:22443798_22470385   |        22 | chr1:22468614_22470707   | C1QC      |        WNT4 |   1979 |       15 | target |        0 |
  | chr1:22470407_C_T  | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC,hicd-seq-bait-dec-HIC,hicd-seq-target-dec-HIC                                                                                                                            | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE  | chr1:21736588_23086883   |  0.0725333259298856 |    1.3271e-05 | WNT4      | chr1:22443798_22470385   |        22 | chr1:22468614_22470707   | WNT4      |           0 |   1949 |       15 | bait   |        0 |
  | chr1:22470407_C_T  | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC,hicd-seq-bait-dec-HIC,hicd-seq-target-dec-HIC                                                                                                                            | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE  | chr1:21736588_23086883   |  0.0725333259298856 |    1.3271e-05 | WNT4      | chr1:22443798_22470385   |        22 | chr1:22468614_22470707   | WNT4      |           0 |   1950 |       15 | bait   |        0 |
  | chr1:22470407_C_T  | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC,hicd-seq-bait-dec-HIC,hicd-seq-target-dec-HIC                                                                                                                            | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE  | chr1:21736588_23086883   |  0.0725333259298856 |    1.3271e-05 | WNT4      | chr1:22443798_22470385   |        22 | chr1:22468614_22470707   | WNT4      |           0 |   1951 |       15 | bait   |        0 |
  | chr1:22470407_C_T  | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC,hicd-seq-bait-dec-HIC,hicd-seq-target-dec-HIC                                                                                                                            | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE  | chr1:21736588_23086883   |  0.0725333259298856 |    1.3271e-05 | WNT4      | chr1:22443798_22470385   |        22 | chr1:22468614_22470707   | WNT4      |           0 |   1952 |       15 | bait   |        0 |
  | chr1:22470407_C_T  | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC,hicd-seq-bait-dec-HIC,hicd-seq-target-dec-HIC                                                                                                                            | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE  | chr1:21736588_23086883   |  0.0725333259298856 |    1.3271e-05 | WNT4      | chr1:22443798_22470385   |        22 | chr1:22468614_22470707   | WNT4      |           0 |   1953 |       15 | bait   |        0 |
  | chr1:22470407_C_T  | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC,hicd-seq-bait-dec-HIC,hicd-seq-target-dec-HIC                                                                                                                            | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE  | chr1:21736588_23086883   |  0.0725333259298856 |    1.3271e-05 | WNT4      | chr1:22443798_22470385   |        22 | chr1:22468614_22470707   | WNT4      |           0 |   1954 |       15 | bait   |        0 |
  | chr1:22470407_C_T  | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC,hicd-seq-bait-dec-HIC,hicd-seq-target-dec-HIC                                                                                                                            | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE  | chr1:21736588_23086883   |  0.0725333259298856 |    1.3271e-05 | WNT4      | chr1:22443798_22470385   |        22 | chr1:22468614_22470707   | WNT4      |           0 |   1955 |       15 | bait   |        0 |
  | chr1:22470407_C_T  | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC,hicd-seq-bait-dec-HIC,hicd-seq-target-dec-HIC                                                                                                                            | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE  | chr1:21736588_23086883   |  0.0725333259298856 |    1.3271e-05 | WNT4      | chr1:22443798_22470385   |        22 | chr1:22468614_22470707   | WNT4      |        C1QC |   1956 |       15 | bait   |        0 |
  | chr1:22470451_G_C  | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC,hicd-seq-bait-dec-HIC,hicd-seq-target-dec-HIC                                                                                                                            | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE  | chr1:21736588_23086883   |  0.0725333259298856 |    1.3271e-05 | WNT4      | chr1:22443798_22470385   |        66 | chr1:22468614_22470707   | C1QC      |        WNT4 |   1979 |       15 | target |        0 |
  | chr1:22470451_G_C  | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC,hicd-seq-bait-dec-HIC,hicd-seq-target-dec-HIC                                                                                                                            | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE  | chr1:21736588_23086883   |  0.0725333259298856 |    1.3271e-05 | WNT4      | chr1:22443798_22470385   |        66 | chr1:22468614_22470707   | WNT4      |           0 |   1949 |       15 | bait   |        0 |
  | chr1:22470451_G_C  | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC,hicd-seq-bait-dec-HIC,hicd-seq-target-dec-HIC                                                                                                                            | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE  | chr1:21736588_23086883   |  0.0725333259298856 |    1.3271e-05 | WNT4      | chr1:22443798_22470385   |        66 | chr1:22468614_22470707   | WNT4      |           0 |   1950 |       15 | bait   |        0 |
  | chr1:22470451_G_C  | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC,hicd-seq-bait-dec-HIC,hicd-seq-target-dec-HIC                                                                                                                            | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE  | chr1:21736588_23086883   |  0.0725333259298856 |    1.3271e-05 | WNT4      | chr1:22443798_22470385   |        66 | chr1:22468614_22470707   | WNT4      |           0 |   1951 |       15 | bait   |        0 |
  | chr1:22470451_G_C  | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC,hicd-seq-bait-dec-HIC,hicd-seq-target-dec-HIC                                                                                                                            | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE  | chr1:21736588_23086883   |  0.0725333259298856 |    1.3271e-05 | WNT4      | chr1:22443798_22470385   |        66 | chr1:22468614_22470707   | WNT4      |           0 |   1952 |       15 | bait   |        0 |
  | chr1:22470451_G_C  | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC,hicd-seq-bait-dec-HIC,hicd-seq-target-dec-HIC                                                                                                                            | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE  | chr1:21736588_23086883   |  0.0725333259298856 |    1.3271e-05 | WNT4      | chr1:22443798_22470385   |        66 | chr1:22468614_22470707   | WNT4      |           0 |   1953 |       15 | bait   |        0 |
  | chr1:22470451_G_C  | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC,hicd-seq-bait-dec-HIC,hicd-seq-target-dec-HIC                                                                                                                            | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE  | chr1:21736588_23086883   |  0.0725333259298856 |    1.3271e-05 | WNT4      | chr1:22443798_22470385   |        66 | chr1:22468614_22470707   | WNT4      |           0 |   1954 |       15 | bait   |        0 |
  | chr1:22470451_G_C  | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC,hicd-seq-bait-dec-HIC,hicd-seq-target-dec-HIC                                                                                                                            | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE  | chr1:21736588_23086883   |  0.0725333259298856 |    1.3271e-05 | WNT4      | chr1:22443798_22470385   |        66 | chr1:22468614_22470707   | WNT4      |           0 |   1955 |       15 | bait   |        0 |
  | chr1:22470451_G_C  | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC,hicd-seq-bait-dec-HIC,hicd-seq-target-dec-HIC                                                                                                                            | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE  | chr1:21736588_23086883   |  0.0725333259298856 |    1.3271e-05 | WNT4      | chr1:22443798_22470385   |        66 | chr1:22468614_22470707   | WNT4      |        C1QC |   1956 |       15 | bait   |        0 |
  | chr1:22468215_C_T  | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC                                                                                                                                                                          | chr1:22468215_C_T  | 6.414e-13 | 6.414e-13 | 0.00011143 |    0.27230339640513 | TRUE  | chr1:21736588_23086883   |   0.251585635073609 |    1.3271e-05 | WNT4      | chr1:22443798_22470385   |         0 | chr1:22468614_22470707   | C1QC      |        WNT4 |   1979 |       15 | target |      399 |
  | chr1:22468215_C_T  | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC                                                                                                                                                                          | chr1:22468215_C_T  | 6.414e-13 | 6.414e-13 | 0.00011143 |    0.27230339640513 | TRUE  | chr1:21736588_23086883   |   0.251585635073609 |    1.3271e-05 | WNT4      | chr1:22443798_22470385   |         0 | chr1:22468614_22470707   | WNT4      |           0 |   1949 |       15 | bait   |      399 |
  | chr1:22468215_C_T  | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC                                                                                                                                                                          | chr1:22468215_C_T  | 6.414e-13 | 6.414e-13 | 0.00011143 |    0.27230339640513 | TRUE  | chr1:21736588_23086883   |   0.251585635073609 |    1.3271e-05 | WNT4      | chr1:22443798_22470385   |         0 | chr1:22468614_22470707   | WNT4      |           0 |   1950 |       15 | bait   |      399 |
  | chr1:22468215_C_T  | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC                                                                                                                                                                          | chr1:22468215_C_T  | 6.414e-13 | 6.414e-13 | 0.00011143 |    0.27230339640513 | TRUE  | chr1:21736588_23086883   |   0.251585635073609 |    1.3271e-05 | WNT4      | chr1:22443798_22470385   |         0 | chr1:22468614_22470707   | WNT4      |           0 |   1951 |       15 | bait   |      399 |
  | chr1:22468215_C_T  | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC                                                                                                                                                                          | chr1:22468215_C_T  | 6.414e-13 | 6.414e-13 | 0.00011143 |    0.27230339640513 | TRUE  | chr1:21736588_23086883   |   0.251585635073609 |    1.3271e-05 | WNT4      | chr1:22443798_22470385   |         0 | chr1:22468614_22470707   | WNT4      |           0 |   1952 |       15 | bait   |      399 |
  | chr1:22468215_C_T  | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC                                                                                                                                                                          | chr1:22468215_C_T  | 6.414e-13 | 6.414e-13 | 0.00011143 |    0.27230339640513 | TRUE  | chr1:21736588_23086883   |   0.251585635073609 |    1.3271e-05 | WNT4      | chr1:22443798_22470385   |         0 | chr1:22468614_22470707   | WNT4      |           0 |   1953 |       15 | bait   |      399 |
  | chr1:22468215_C_T  | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC                                                                                                                                                                          | chr1:22468215_C_T  | 6.414e-13 | 6.414e-13 | 0.00011143 |    0.27230339640513 | TRUE  | chr1:21736588_23086883   |   0.251585635073609 |    1.3271e-05 | WNT4      | chr1:22443798_22470385   |         0 | chr1:22468614_22470707   | WNT4      |           0 |   1954 |       15 | bait   |      399 |
  | chr1:22468215_C_T  | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC                                                                                                                                                                          | chr1:22468215_C_T  | 6.414e-13 | 6.414e-13 | 0.00011143 |    0.27230339640513 | TRUE  | chr1:21736588_23086883   |   0.251585635073609 |    1.3271e-05 | WNT4      | chr1:22443798_22470385   |         0 | chr1:22468614_22470707   | WNT4      |           0 |   1955 |       15 | bait   |      399 |
  | chr1:22468215_C_T  | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC                                                                                                                                                                          | chr1:22468215_C_T  | 6.414e-13 | 6.414e-13 | 0.00011143 |    0.27230339640513 | TRUE  | chr1:21736588_23086883   |   0.251585635073609 |    1.3271e-05 | WNT4      | chr1:22443798_22470385   |         0 | chr1:22468614_22470707   | WNT4      |        C1QC |   1956 |       15 | bait   |      399 |
  | chr3:155868039_G_A | chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-dec-H3K27ac,chip-seq-dec_diff-H3K27ac                                                                                                                                                                                                                                                | chr3:155855597_A_G | 2.056e-09 | 5.041e-09 | 9.9467e-05 |   0.247185586838391 | TRUE  | chr3:154714218_156008700 |  0.0230192688978053 |    1.3271e-05 | KCNAB1    | chr3:155838337_155861209 |      6830 | chr3:155868286_155869647 | KCNAB1    |           0 | 120415 |      373 | target |      247 |
  | chr3:139029676_G_A | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-dec-H3K4me3,chip-seq-reproducible-ctr-H3K4me1,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC,chip-seq-reproducible-ctr-H3K27ac,chip-seq-reproducible-dec-H3K27ac                                                                                                                                        | chr3:139004333_A_G | 2.667e-08 | 1.783e-07 | 9.9467e-05 |   0.211193096775336 | TRUE  | chr3:137371083_139954597 |    0.08857539325385 |    1.3271e-05 | MRPS22    | chr3:139062798_139075887 |     33122 | chr3:139026391_139027606 | FOXL2     |           0 | 119886 |      362 | target |     2070 |
  | chr3:155867092_A_G | chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-dec-H3K4me1                                                                                                                                                                                                                                                                                                            | chr3:155855597_A_G | 2.056e-09 | 5.515e-09 | 8.3182e-05 |    0.19115688143615 | TRUE  | chr3:154714218_156008700 |  0.0212864612808022 |    1.3271e-05 | KCNAB1    | chr3:155838337_155861209 |      5883 | chr3:155868286_155869647 | KCNAB1    |           0 | 120415 |      373 | target |     1194 |
  | chr2:74207357_G_A  | chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-dec-H3K27ac                                                                                                                                                                                                                                                                          | chr2:74217283_G_T  | 1.549e-07 | 2.178e-07 | 9.9467e-05 |   0.185530071716854 | FALSE | chr2:73174848_75630086   |  0.0775039734019111 |    1.3271e-05 | TET3      | chr2:74213531_74335302   |      6174 | chr2:74206346_74207145   | WBP1      |           0 |  97391 |      181 | target |      212 |
  | chr3:127889287_A_G | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,hicd-seq-target-dec-HIC                                                                                                                                                                                                                                                                                    | chr3:127869598_C_A | 3.991e-13 | 5.401e-12 |  0.0003207 |   0.181751312175621 | TRUE  | chr3:126214943_128194861 | 0.00914146130218985 |    1.3271e-05 | EEFSEC    | chr3:127872313_128127489 |         0 | chr3:127889182_127889449 | GATA2     |           0 | 119258 |      356 | target |        0 |
  | chr2:74230656_C_T  | atac-seq-reproducible-ctr-ATAC,atac-seq-reproducible-dec-ATAC,chip-seq-reproducible-ctr-H3K4me1,chip-seq-dec_diff-H3K4me1,chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K27ac,chip-seq-reproducible-dec-H3K27ac,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,chip-seq-dec_diff-H3K27ac,chip-seq-dec_diff-H3K4me3                        | chr2:74217283_G_T  | 1.549e-07 | 3.858e-07 | 0.00013325 |   0.146327332168703 | FALSE | chr2:73174848_75630086   |    0.04566915756667 |    1.3271e-05 | TET3      | chr2:74213531_74335302   |         0 | chr2:74229554_74229990   | DGUOK     |           0 |  97228 |      181 | target |      666 |
  | chr3:127878416_G_A | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K27ac                                                                                                                                                                                                                                                                          | chr3:127869598_C_A | 3.991e-13 | 2.008e-12 | 8.3182e-05 |    0.11894897541832 | TRUE  | chr3:126214943_128194861 |  0.0230735608852745 |    1.3271e-05 | EEFSEC    | chr3:127872313_128127489 |         0 | chr3:127878466_127879077 | GATA2     |           0 | 119277 |      356 | target |       50 |
  | chr3:141106063_T_C | hicd-seq-target-dec-HIC,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-dec-H3K27ac,chip-seq-reproducible-ctr-H3K27ac,chip-seq-dec_diff-H3K27ac,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3                                                                                                                  | chr3:141125186_A_G | 6.634e-07 | 2.158e-06 | 0.00051366 |   0.107334842154585 | TRUE  | chr3:139954597_141339097 |  0.0175512912059427 |    1.3271e-05 | ZBTB38    | chr3:141043055_141168632 |         0 | chr3:141105288_141106563 | RASA2     |           0 | 119965 |      363 | target |        0 |
  | chr9:80472931_C_T  | chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-dec-H3K27ac,chip-seq-reproducible-dec-H3K4me1                                                                                                                                                                                                                                                                          | chr9:80473690_T_C  | 6.859e-08 | 7.031e-08 | 9.9467e-05 |   0.104850691148267 | FALSE | chr9:79471208_81079055   |  0.0316881976915664 |    1.3271e-05 | GNAQ      | chr9:80335191_80646219   |         0 | chr9:80443948_80444179   | ALG9      |           0 |  33401 |      973 | target |    28752 |
  | chr3:127895986_G_A | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,hicd-seq-target-dec-HIC,chip-seq-reproducible-dec-H3K27ac,chip-seq-reproducible-ctr-H3K27ac                                                                                                                                                                                                                | chr3:127869598_C_A | 3.991e-13 | 1.221e-11 | 0.00038347 |   0.098883034177444 | TRUE  | chr3:126214943_128194861 | 0.00415817719491285 |    1.3271e-05 | EEFSEC    | chr3:127872313_128127489 |         0 | chr3:127895903_127897237 | GATA2     |           0 | 119283 |      356 | target |        0 |
  | chr2:74235926_A_G  | chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-dec-H3K4me1                                                                                                                                                                                                                                                                                                            | chr2:74217283_G_T  | 1.549e-07 | 4.006e-07 | 8.3182e-05 |  0.0881807530820088 | FALSE | chr2:73174848_75630086   |  0.0440894053182422 |    1.3271e-05 | TET3      | chr2:74213531_74335302   |         0 | chr2:74232028_74232726   | CCDC142   |           0 |  97444 |      181 | target |     3200 |
  | chr3:141105570_A_G | hicd-seq-target-dec-HIC,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-dec-H3K27ac,chip-seq-reproducible-ctr-H3K27ac,chip-seq-dec_diff-H3K27ac,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3                                                                                                                  | chr3:141125186_A_G | 6.634e-07 | 2.858e-06 | 0.00051366 |  0.0828827353298337 | TRUE  | chr3:139954597_141339097 |  0.0135543180064815 |    1.3271e-05 | ZBTB38    | chr3:141043055_141168632 |         0 | chr3:141105288_141106563 | RASA2     |           0 | 119965 |      363 | target |        0 |
  | chr3:141125186_A_G | chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-dec-H3K27ac,chip-seq-reproducible-ctr-H3K27ac,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3                                                                                                                                                                    | chr3:141125186_A_G | 6.634e-07 | 6.634e-07 | 0.00013325 |  0.0821540692633212 | TRUE  | chr3:139954597_141339097 |  0.0517626617247525 |    1.3271e-05 | ZBTB38    | chr3:141043055_141168632 |         0 | chr3:141105288_141106563 | RASA2     |           0 | 119965 |      363 | target |    18623 |
  | chr3:155859113_A_G | hicd-seq-target-dec-HIC                                                                                                                                                                                                                                                                                                                                                        | chr3:155855597_A_G | 2.056e-09 | 2.062e-09 | 1.3753e-05 |  0.0794132056931665 | TRUE  | chr3:154714218_156008700 |  0.0534923024798815 |    1.3271e-05 | KCNAB1    | chr3:155838337_155861209 |         0 | chr3:155858331_155859679 | KCNAB1    |           0 | 120420 |      373 | target |        0 |
  | chr3:155861563_G_A | hicd-seq-bait-dec-HIC                                                                                                                                                                                                                                                                                                                                                          | chr3:155855597_A_G | 2.056e-09 | 2.134e-09 | 1.3753e-05 |  0.0769301930110344 | TRUE  | chr3:154714218_156008700 |  0.0518195401557614 |    1.3271e-05 | KCNAB1    | chr3:155838337_155861209 |       354 | chr3:155860834_155862503 | KCNAB1    |           0 | 120412 |      373 | bait   |        0 |
  | chr3:155861563_G_A | hicd-seq-bait-dec-HIC                                                                                                                                                                                                                                                                                                                                                          | chr3:155855597_A_G | 2.056e-09 | 2.134e-09 | 1.3753e-05 |  0.0769301930110344 | TRUE  | chr3:154714218_156008700 |  0.0518195401557614 |    1.3271e-05 | KCNAB1    | chr3:155838337_155861209 |       354 | chr3:155860834_155862503 | KCNAB1    |           0 | 120413 |      373 | bait   |        0 |
  | chr3:155861563_G_A | hicd-seq-bait-dec-HIC                                                                                                                                                                                                                                                                                                                                                          | chr3:155855597_A_G | 2.056e-09 | 2.134e-09 | 1.3753e-05 |  0.0769301930110344 | TRUE  | chr3:154714218_156008700 |  0.0518195401557614 |    1.3271e-05 | KCNAB1    | chr3:155838337_155861209 |       354 | chr3:155860834_155862503 | KCNAB1    |           0 | 120414 |      373 | bait   |        0 |
  | chr4:174729270_A_G | chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-dec-H3K27ac,chip-seq-reproducible-ctr-H3K27ac,chip-seq-dec_diff-H3K27ac,chip-seq-reproducible-ctr-H3K4me3,chip-seq-dec_diff-H3K4me3,chip-seq-reproducible-dec-H3K4me3,chip-seq-dec_diff-H3K4me1                                                                                      | chr4:174734471_G_A | 3.681e-07 | 5.175e-07 | 0.00013325 |  0.0742724933484663 | TRUE  | chr4:174264132_176570716 |  0.0800148786359195 |    1.3271e-05 | HAND2-AS1 | chr4:174451609_174506879 |    222391 | chr4:174728688_174729180 | HAND2     |           0 | 127925 |      512 | target |       90 |
  | chr3:127898501_A_C | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,atac-seq-reproducible-dec-ATAC,chip-seq-reproducible-dec-H3K4me3,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K27ac,chip-seq-reproducible-ctr-H3K27ac                                                                                                                                     | chr3:127869598_C_A | 3.991e-13 | 6.389e-12 | 0.00013325 |  0.0649480930862608 | TRUE  | chr3:126214943_128194861 | 0.00786162624567999 |    1.3271e-05 | EEFSEC    | chr3:127872313_128127489 |         0 | chr3:127897237_127898323 | GATA2     |           0 | 119259 |      356 | target |      178 |
  | chr3:127898501_A_C | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,atac-seq-reproducible-dec-ATAC,chip-seq-reproducible-dec-H3K4me3,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K27ac,chip-seq-reproducible-ctr-H3K27ac                                                                                                                                     | chr3:127869598_C_A | 3.991e-13 | 6.389e-12 | 0.00013325 |  0.0649480930862608 | TRUE  | chr3:126214943_128194861 | 0.00786162624567999 |    1.3271e-05 | EEFSEC    | chr3:127872313_128127489 |         0 | chr3:127897237_127898323 | GATA2     |           0 | 119284 |      356 | target |      178 |
  | chr3:123085359_C_T |                                                                                                                                                                                                                                                                                                                                                                                | chr3:123085359_C_T |  8.56e-10 |  8.56e-10 | 3.5663e-06 |  0.0639995247098653 | TRUE  | chr3:121974097_123517768 |  0.0959253387484401 |    1.3271e-05 | ADCY5     | chr3:123001143_123167392 |         0 | chr3:123068783_123069729 | SEMA5B    |           0 | 118977 |      353 | target |    15630 |
  | chr3:123072883_A_C | atac-seq-reproducible-ctr-ATAC                                                                                                                                                                                                                                                                                                                                                 | chr3:123085359_C_T |  8.56e-10 | 8.685e-10 | 3.5663e-06 |  0.0627655080431377 | TRUE  | chr3:121974097_123517768 |  0.0940750582195065 |    1.3271e-05 | ADCY5     | chr3:123001143_123167392 |         0 | chr3:123068783_123069729 | SEMA5B    |           0 | 118977 |      353 | target |     3154 |
  | chr5:157888115_C_T |                                                                                                                                                                                                                                                                                                                                                                                | chr5:157888115_C_T | 1.637e-26 | 1.637e-26 | 3.5663e-06 |  0.0597826928217112 | TRUE  | chr5:156628700_158825698 |   0.193379905848751 |    1.3271e-05 | EBF1      | chr5:158122923_158526788 |    234808 | chr5:157891243_157891553 | CLINT1    |           0 | 134395 |      614 | target |     3128 |
  | chr3:141125705_C_G | chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-dec-H3K27ac,chip-seq-reproducible-ctr-H3K27ac,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3                                                                                                                                                                    | chr3:141125186_A_G | 6.634e-07 | 9.537e-07 | 0.00013325 |  0.0587360750162226 | TRUE  | chr3:139954597_141339097 |  0.0370127340245823 |    1.3271e-05 | ZBTB38    | chr3:141043055_141168632 |         0 | chr3:141105288_141106563 | RASA2     |           0 | 119965 |      363 | target |    19142 |
  | chr3:155852076_C_T | hicd-seq-target-dec-HIC                                                                                                                                                                                                                                                                                                                                                        | chr3:155855597_A_G | 2.056e-09 | 2.856e-09 | 1.3753e-05 |  0.0586581178156451 | TRUE  | chr3:154714218_156008700 |  0.0395101995225114 |    1.3271e-05 | KCNAB1    | chr3:155838337_155861209 |         0 | chr3:155852003_155852361 | KCNAB1    |           0 | 120419 |      373 | target |        0 |
  | chr3:127936527_T_C | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,atac-seq-reproducible-ctr-ATAC,chip-seq-reproducible-ctr-H3K27ac,chip-seq-dec_diff-H3K4me1,chip-seq-dec_diff-H3K27ac                                                                                                                                                                                       | chr3:127869598_C_A | 3.991e-13 | 4.311e-12 | 8.3182e-05 |  0.0577792799723961 | TRUE  | chr3:126214943_128194861 |  0.0112050022395398 |    1.3271e-05 | EEFSEC    | chr3:127872313_128127489 |         0 | chr3:127936037_127936312 | GATA2     |           0 | 119255 |      356 | target |      215 |
  | chr3:127936532_T_C | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,atac-seq-reproducible-ctr-ATAC,chip-seq-reproducible-ctr-H3K27ac,chip-seq-dec_diff-H3K4me1,chip-seq-dec_diff-H3K27ac                                                                                                                                                                                       | chr3:127869598_C_A | 3.991e-13 | 4.311e-12 | 8.3182e-05 |  0.0577792799723961 | TRUE  | chr3:126214943_128194861 |  0.0112050022395398 |    1.3271e-05 | EEFSEC    | chr3:127872313_128127489 |         0 | chr3:127936037_127936312 | GATA2     |           0 | 119255 |      356 | target |      220 |
  | chr4:174729550_C_T | chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-dec-H3K27ac,chip-seq-reproducible-ctr-H3K27ac,chip-seq-dec_diff-H3K27ac,chip-seq-dec_diff-H3K4me1                                                                                                                                                                                    | chr4:174734471_G_A | 3.681e-07 |  4.98e-07 | 9.9467e-05 |   0.057620400846482 | TRUE  | chr4:174264132_176570716 |  0.0831549455660368 |    1.3271e-05 | HAND2-AS1 | chr4:174451609_174506879 |    222671 | chr4:174728688_174729180 | HAND2     |           0 | 127925 |      512 | target |      370 |
  | chr3:141124607_T_C | chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-dec-H3K27ac,chip-seq-reproducible-ctr-H3K27ac,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3                                                                                                                                                                    | chr3:141125186_A_G | 6.634e-07 | 9.778e-07 | 0.00013325 |  0.0574520631512038 | TRUE  | chr3:139954597_141339097 |  0.0362039321277795 |    1.3271e-05 | ZBTB38    | chr3:141043055_141168632 |         0 | chr3:141105288_141106563 | RASA2     |           0 | 119965 |      363 | target |    18044 |
  | chr3:127937645_G_A | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K27ac,chip-seq-dec_diff-H3K4me1,chip-seq-dec_diff-H3K27ac                                                                                                                                                                                                                      | chr3:127869598_C_A | 3.991e-13 | 4.419e-12 | 8.3182e-05 |  0.0566819421381121 | TRUE  | chr3:126214943_128194861 |  0.0109921213631076 |    1.3271e-05 | EEFSEC    | chr3:127872313_128127489 |         0 | chr3:127936037_127936312 | GATA2     |           0 | 119255 |      356 | target |     1333 |
  | chr3:141125439_T_C | chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-dec-H3K27ac,chip-seq-reproducible-ctr-H3K27ac,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3                                                                                                                                                                    | chr3:141125186_A_G | 6.634e-07 |  1.07e-06 | 0.00013325 |   0.052864893968443 | TRUE  | chr3:139954597_141339097 |  0.0333144034837468 |    1.3271e-05 | ZBTB38    | chr3:141043055_141168632 |         0 | chr3:141105288_141106563 | RASA2     |           0 | 119965 |      363 | target |    18876 |
  | chr9:80455316_G_A  | chip-seq-reproducible-ctr-H3K27ac,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-dec-H3K27ac,chip-seq-reproducible-dec-H3K4me1,chip-seq-dec_diff-H3K27ac                                                                                                                                                                                                              | chr9:80473690_T_C  | 6.859e-08 | 1.449e-07 | 9.9467e-05 |  0.0527779301613946 | FALSE | chr9:79471208_81079055   |  0.0159498464687701 |    1.3271e-05 | GNAQ      | chr9:80335191_80646219   |         0 | chr9:80443948_80444179   | ALG9      |           0 |  33401 |      973 | target |    11137 |
  | chr3:141133450_G_A | atac-seq-reproducible-dec-ATAC,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-dec-H3K27ac,chip-seq-reproducible-ctr-H3K27ac,chip-seq-reproducible-dec-H3K4me3                                                                                                                                                                       | chr3:141125186_A_G | 6.634e-07 | 7.814e-07 | 9.9467e-05 |  0.0526126433234183 | TRUE  | chr3:139954597_141339097 |  0.0444112154619771 |    1.3271e-05 | ZBTB38    | chr3:141043055_141168632 |         0 | chr3:141105288_141106563 | RASA2     |           0 | 119965 |      363 | target |    26887 |
  | chr3:141104180_G_A | chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-dec-H3K27ac,chip-seq-reproducible-ctr-H3K27ac,chip-seq-dec_diff-H3K27ac,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3                                                                                                                                          | chr3:141125186_A_G | 6.634e-07 | 1.103e-06 | 0.00013325 |  0.0514231238927406 | TRUE  | chr3:139954597_141339097 |  0.0324061897928146 |    1.3271e-05 | ZBTB38    | chr3:141043055_141168632 |         0 | chr3:141105288_141106563 | RASA2     |           0 | 119965 |      363 | target |     1108 |
  | chr4:174741209_C_T | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-dec-H3K27ac,chip-seq-dec_diff-H3K27ac,chip-seq-dec_diff-H3K4me1                                                                                                                                                                                                                                                        | chr4:174734471_G_A | 3.681e-07 | 5.796e-07 | 9.9467e-05 |    0.05060760706165 | TRUE  | chr4:174264132_176570716 |  0.0730452627545863 |    1.3271e-05 | HAND2-AS1 | chr4:174451609_174506879 |    234330 | chr4:174742651_174743099 | SAP30     |           0 | 127920 |      512 | target |     1442 |
  | chr4:174728566_T_G | chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-dec-H3K27ac,chip-seq-reproducible-ctr-H3K27ac,chip-seq-dec_diff-H3K27ac,chip-seq-reproducible-ctr-H3K4me3,chip-seq-dec_diff-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC,atac-seq-dec_diff-ATAC,chip-seq-reproducible-dec-H3K4me3,chip-seq-dec_diff-H3K4me1 | chr4:174734471_G_A | 3.681e-07 | 7.909e-07 | 0.00013325 |  0.0505149760256708 | TRUE  | chr4:174264132_176570716 |  0.0544445382660437 |    1.3271e-05 | HAND2-AS1 | chr4:174451609_174506879 |    221687 | chr4:174728688_174729180 | HAND2     |           0 | 127925 |      512 | target |      122 |
  | chr3:139004333_A_G |                                                                                                                                                                                                                                                                                                                                                                                | chr3:139004333_A_G | 2.667e-08 | 2.667e-08 | 3.5663e-06 |  0.0448128468175488 | FALSE | chr3:137371083_139954597 |   0.524775501393414 |    1.3271e-05 | PISRT1    | chr3:138951834_138952364 |     51969 | chr3:139009857_139010162 | FOXL2     |           0 | 119867 |      362 | target |     5524 |
  | chr2:74217283_G_T  | hicd-seq-target-dec-HIC                                                                                                                                                                                                                                                                                                                                                        | chr2:74217283_G_T  | 1.549e-07 | 1.549e-07 | 1.3753e-05 |  0.0358040240630982 | FALSE | chr2:73174848_75630086   |   0.108115106642254 |    1.3271e-05 | TET3      | chr2:74213531_74335302   |         0 | chr2:74216419_74217297   | INO80B    |           0 |  97351 |      181 | target |        0 |
  | chr3:127869598_C_A |                                                                                                                                                                                                                                                                                                                                                                                | chr3:127869598_C_A | 3.991e-13 | 3.991e-13 | 3.5663e-06 |  0.0241519487911227 | TRUE  | chr3:126214943_128194861 |   0.109336034655939 |    1.3271e-05 | RUVBL1    | chr3:127783628_127872757 |         0 | chr3:127861862_127862768 | GATA2     |           0 | 119276 |      356 | target |     6830 |
  | chr3:155855597_A_G |                                                                                                                                                                                                                                                                                                                                                                                | chr3:155855597_A_G | 2.056e-09 | 2.056e-09 | 3.5663e-06 |  0.0206945603600636 | TRUE  | chr3:154714218_156008700 |  0.0537569502858176 |    1.3271e-05 | KCNAB1    | chr3:155838337_155861209 |         0 | chr3:155858331_155859679 | KCNAB1    |           0 | 120420 |      373 | target |     2734 |
  | chr9:80473690_T_C  |                                                                                                                                                                                                                                                                                                                                                                                | chr9:80473690_T_C  | 6.859e-08 | 6.859e-08 | 3.5663e-06 | 0.00385062477717912 | FALSE | chr9:79471208_81079055   |  0.0324578209580096 |    1.3271e-05 | GNAQ      | chr9:80335191_80646219   |         0 | chr9:80443948_80444179   | ALG9      |           0 |  33401 |      973 | target |    29511 |
  | chr4:174734471_G_A | chip-seq-reproducible-dec-H3K27ac,chip-seq-dec_diff-H3K27ac                                                                                                                                                                                                                                                                                                                    | chr4:174734471_G_A | 3.681e-07 | 3.681e-07 | 4.2646e-06 |  0.0032713915048207 | FALSE | chr4:174264132_176570716 |   0.110079284150776 |    1.3271e-05 | HAND2-AS1 | chr4:174451609_174506879 |    227592 | chr4:174728688_174729180 | HAND2     |           0 | 127925 |      512 | target |     5291 |

** Fine mapping result
#+BEGIN_SRC R :dir :session rexp :colnames yes
hic_snp_df <-  hic_sgl %>% 
      dplyr::select(-anno,
                    -uniform_prior,
                    -uniform_pip,
                    -locus_id,
                    Locus = ldmr,
                    isInCredibleSet = CS,
                    NearestGene = symbol,
                    -target_gene,
                    DistanceToGene = gene_dist) %>% distinct() %>% arrange(desc(pip))
                    
#+END_SRC

#+RESULTS:
| snp                | tag_snp            |  tag_pval |      pval |      prior |                 pip | isInCredibleSet | Locus                    | NearestGene | gene_region              | DistanceToGene | hic_region               | bait_gene | hic_id | type   | hic_dist |
|--------------------+--------------------+-----------+-----------+------------+---------------------+-----------------+--------------------------+-------------+--------------------------+----------------+--------------------------+-----------+--------+--------+----------|
| chr3:138843356_G_A | chr3:139004333_A_G | 2.667e-08 | 3.824e-08 | 8.3182e-05 |   0.740639510360678 | TRUE            | chr3:137371083_139954597 | BPESC1      | chr3:138823027_138844005 |              0 | chr3:138831264_138835574 | FOXL2     | 119881 | target |     7782 |
| chr3:138843356_G_A | chr3:139004333_A_G | 2.667e-08 | 3.824e-08 | 8.3182e-05 |   0.740639510360678 | TRUE            | chr3:137371083_139954597 | BPESC1      | chr3:138823027_138844005 |              0 | chr3:138831264_138835574 | COPB2     | 119916 | target |     7782 |
| chr5:157884706_T_C | chr5:157888115_C_T | 1.637e-26 | 3.036e-26 | 8.3182e-05 |    0.72179868954602 | TRUE            | chr5:156628700_158825698 | EBF1        | chr5:158122923_158526788 |         238217 | chr5:157891243_157891553 | CLINT1    | 134395 | target |     6537 |
| chr4:174728703_C_T | chr4:174734471_G_A | 3.681e-07 |  3.86e-07 | 0.00051366 |   0.381114818123928 | TRUE            | chr4:174264132_176570716 | HAND2-AS1   | chr4:174451609_174506879 |         221824 | chr4:174728688_174729180 | HAND2     | 127925 | target |        0 |
| chr2:74206685_G_A  | chr2:74217283_G_T  | 1.549e-07 | 4.677e-07 | 0.00038347 |   0.353729177223882 | FALSE           | chr2:73174848_75630086   | TET3        | chr2:74213531_74335302   |           6846 | chr2:74206346_74207145   | WBP1      |  97391 | target |        0 |
| chr3:123062970_G_C | chr3:123085359_C_T |  8.56e-10 | 4.107e-09 | 8.3182e-05 |   0.337861345969416 | TRUE            | chr3:121974097_123517768 | ADCY5       | chr3:123001143_123167392 |              0 | chr3:123068783_123069729 | SEMA5B    | 118977 | target |     5813 |
| chr4:174729014_G_A | chr4:174734471_G_A | 3.681e-07 | 4.482e-07 | 0.00051366 |   0.329331089464829 | TRUE            | chr4:174264132_176570716 | HAND2-AS1   | chr4:174451609_174506879 |         222135 | chr4:174728688_174729180 | HAND2     | 127925 | target |        0 |
| chr1:22470407_C_T  | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE            | chr1:21736588_23086883   | WNT4        | chr1:22443798_22470385   |             22 | chr1:22468614_22470707   | C1QC      |   1979 | target |        0 |
| chr1:22470407_C_T  | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE            | chr1:21736588_23086883   | WNT4        | chr1:22443798_22470385   |             22 | chr1:22468614_22470707   | WNT4      |   1949 | bait   |        0 |
| chr1:22470407_C_T  | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE            | chr1:21736588_23086883   | WNT4        | chr1:22443798_22470385   |             22 | chr1:22468614_22470707   | WNT4      |   1950 | bait   |        0 |
| chr1:22470407_C_T  | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE            | chr1:21736588_23086883   | WNT4        | chr1:22443798_22470385   |             22 | chr1:22468614_22470707   | WNT4      |   1951 | bait   |        0 |
| chr1:22470407_C_T  | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE            | chr1:21736588_23086883   | WNT4        | chr1:22443798_22470385   |             22 | chr1:22468614_22470707   | WNT4      |   1952 | bait   |        0 |
| chr1:22470407_C_T  | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE            | chr1:21736588_23086883   | WNT4        | chr1:22443798_22470385   |             22 | chr1:22468614_22470707   | WNT4      |   1953 | bait   |        0 |
| chr1:22470407_C_T  | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE            | chr1:21736588_23086883   | WNT4        | chr1:22443798_22470385   |             22 | chr1:22468614_22470707   | WNT4      |   1954 | bait   |        0 |
| chr1:22470407_C_T  | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE            | chr1:21736588_23086883   | WNT4        | chr1:22443798_22470385   |             22 | chr1:22468614_22470707   | WNT4      |   1955 | bait   |        0 |
| chr1:22470407_C_T  | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE            | chr1:21736588_23086883   | WNT4        | chr1:22443798_22470385   |             22 | chr1:22468614_22470707   | WNT4      |   1956 | bait   |        0 |
| chr1:22470451_G_C  | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE            | chr1:21736588_23086883   | WNT4        | chr1:22443798_22470385   |             66 | chr1:22468614_22470707   | C1QC      |   1979 | target |        0 |
| chr1:22470451_G_C  | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE            | chr1:21736588_23086883   | WNT4        | chr1:22443798_22470385   |             66 | chr1:22468614_22470707   | WNT4      |   1949 | bait   |        0 |
| chr1:22470451_G_C  | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE            | chr1:21736588_23086883   | WNT4        | chr1:22443798_22470385   |             66 | chr1:22468614_22470707   | WNT4      |   1950 | bait   |        0 |
| chr1:22470451_G_C  | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE            | chr1:21736588_23086883   | WNT4        | chr1:22443798_22470385   |             66 | chr1:22468614_22470707   | WNT4      |   1951 | bait   |        0 |
| chr1:22470451_G_C  | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE            | chr1:21736588_23086883   | WNT4        | chr1:22443798_22470385   |             66 | chr1:22468614_22470707   | WNT4      |   1952 | bait   |        0 |
| chr1:22470451_G_C  | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE            | chr1:21736588_23086883   | WNT4        | chr1:22443798_22470385   |             66 | chr1:22468614_22470707   | WNT4      |   1953 | bait   |        0 |
| chr1:22470451_G_C  | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE            | chr1:21736588_23086883   | WNT4        | chr1:22443798_22470385   |             66 | chr1:22468614_22470707   | WNT4      |   1954 | bait   |        0 |
| chr1:22470451_G_C  | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE            | chr1:21736588_23086883   | WNT4        | chr1:22443798_22470385   |             66 | chr1:22468614_22470707   | WNT4      |   1955 | bait   |        0 |
| chr1:22470451_G_C  | chr1:22468215_C_T  | 6.414e-13 |  2.34e-12 | 0.00042959 |   0.302745288641221 | TRUE            | chr1:21736588_23086883   | WNT4        | chr1:22443798_22470385   |             66 | chr1:22468614_22470707   | WNT4      |   1956 | bait   |        0 |
| chr1:22468215_C_T  | chr1:22468215_C_T  | 6.414e-13 | 6.414e-13 | 0.00011143 |    0.27230339640513 | TRUE            | chr1:21736588_23086883   | WNT4        | chr1:22443798_22470385   |              0 | chr1:22468614_22470707   | C1QC      |   1979 | target |      399 |
| chr1:22468215_C_T  | chr1:22468215_C_T  | 6.414e-13 | 6.414e-13 | 0.00011143 |    0.27230339640513 | TRUE            | chr1:21736588_23086883   | WNT4        | chr1:22443798_22470385   |              0 | chr1:22468614_22470707   | WNT4      |   1949 | bait   |      399 |
| chr1:22468215_C_T  | chr1:22468215_C_T  | 6.414e-13 | 6.414e-13 | 0.00011143 |    0.27230339640513 | TRUE            | chr1:21736588_23086883   | WNT4        | chr1:22443798_22470385   |              0 | chr1:22468614_22470707   | WNT4      |   1950 | bait   |      399 |
| chr1:22468215_C_T  | chr1:22468215_C_T  | 6.414e-13 | 6.414e-13 | 0.00011143 |    0.27230339640513 | TRUE            | chr1:21736588_23086883   | WNT4        | chr1:22443798_22470385   |              0 | chr1:22468614_22470707   | WNT4      |   1951 | bait   |      399 |
| chr1:22468215_C_T  | chr1:22468215_C_T  | 6.414e-13 | 6.414e-13 | 0.00011143 |    0.27230339640513 | TRUE            | chr1:21736588_23086883   | WNT4        | chr1:22443798_22470385   |              0 | chr1:22468614_22470707   | WNT4      |   1952 | bait   |      399 |
| chr1:22468215_C_T  | chr1:22468215_C_T  | 6.414e-13 | 6.414e-13 | 0.00011143 |    0.27230339640513 | TRUE            | chr1:21736588_23086883   | WNT4        | chr1:22443798_22470385   |              0 | chr1:22468614_22470707   | WNT4      |   1953 | bait   |      399 |
| chr1:22468215_C_T  | chr1:22468215_C_T  | 6.414e-13 | 6.414e-13 | 0.00011143 |    0.27230339640513 | TRUE            | chr1:21736588_23086883   | WNT4        | chr1:22443798_22470385   |              0 | chr1:22468614_22470707   | WNT4      |   1954 | bait   |      399 |
| chr1:22468215_C_T  | chr1:22468215_C_T  | 6.414e-13 | 6.414e-13 | 0.00011143 |    0.27230339640513 | TRUE            | chr1:21736588_23086883   | WNT4        | chr1:22443798_22470385   |              0 | chr1:22468614_22470707   | WNT4      |   1955 | bait   |      399 |
| chr1:22468215_C_T  | chr1:22468215_C_T  | 6.414e-13 | 6.414e-13 | 0.00011143 |    0.27230339640513 | TRUE            | chr1:21736588_23086883   | WNT4        | chr1:22443798_22470385   |              0 | chr1:22468614_22470707   | WNT4      |   1956 | bait   |      399 |
| chr3:155868039_G_A | chr3:155855597_A_G | 2.056e-09 | 5.041e-09 | 9.9467e-05 |   0.247185586838391 | TRUE            | chr3:154714218_156008700 | KCNAB1      | chr3:155838337_155861209 |           6830 | chr3:155868286_155869647 | KCNAB1    | 120415 | target |      247 |
| chr3:139029676_G_A | chr3:139004333_A_G | 2.667e-08 | 1.783e-07 | 9.9467e-05 |   0.211193096775336 | TRUE            | chr3:137371083_139954597 | MRPS22      | chr3:139062798_139075887 |          33122 | chr3:139026391_139027606 | FOXL2     | 119886 | target |     2070 |
| chr3:155867092_A_G | chr3:155855597_A_G | 2.056e-09 | 5.515e-09 | 8.3182e-05 |    0.19115688143615 | TRUE            | chr3:154714218_156008700 | KCNAB1      | chr3:155838337_155861209 |           5883 | chr3:155868286_155869647 | KCNAB1    | 120415 | target |     1194 |
| chr2:74207357_G_A  | chr2:74217283_G_T  | 1.549e-07 | 2.178e-07 | 9.9467e-05 |   0.185530071716854 | FALSE           | chr2:73174848_75630086   | TET3        | chr2:74213531_74335302   |           6174 | chr2:74206346_74207145   | WBP1      |  97391 | target |      212 |
| chr3:127889287_A_G | chr3:127869598_C_A | 3.991e-13 | 5.401e-12 |  0.0003207 |   0.181751312175621 | TRUE            | chr3:126214943_128194861 | EEFSEC      | chr3:127872313_128127489 |              0 | chr3:127889182_127889449 | GATA2     | 119258 | target |        0 |
| chr2:74230656_C_T  | chr2:74217283_G_T  | 1.549e-07 | 3.858e-07 | 0.00013325 |   0.146327332168703 | FALSE           | chr2:73174848_75630086   | TET3        | chr2:74213531_74335302   |              0 | chr2:74229554_74229990   | DGUOK     |  97228 | target |      666 |
| chr3:127878416_G_A | chr3:127869598_C_A | 3.991e-13 | 2.008e-12 | 8.3182e-05 |    0.11894897541832 | TRUE            | chr3:126214943_128194861 | EEFSEC      | chr3:127872313_128127489 |              0 | chr3:127878466_127879077 | GATA2     | 119277 | target |       50 |
| chr3:141106063_T_C | chr3:141125186_A_G | 6.634e-07 | 2.158e-06 | 0.00051366 |   0.107334842154585 | TRUE            | chr3:139954597_141339097 | ZBTB38      | chr3:141043055_141168632 |              0 | chr3:141105288_141106563 | RASA2     | 119965 | target |        0 |
| chr9:80472931_C_T  | chr9:80473690_T_C  | 6.859e-08 | 7.031e-08 | 9.9467e-05 |   0.104850691148267 | FALSE           | chr9:79471208_81079055   | GNAQ        | chr9:80335191_80646219   |              0 | chr9:80443948_80444179   | ALG9      |  33401 | target |    28752 |
| chr3:127895986_G_A | chr3:127869598_C_A | 3.991e-13 | 1.221e-11 | 0.00038347 |   0.098883034177444 | TRUE            | chr3:126214943_128194861 | EEFSEC      | chr3:127872313_128127489 |              0 | chr3:127895903_127897237 | GATA2     | 119283 | target |        0 |
| chr2:74235926_A_G  | chr2:74217283_G_T  | 1.549e-07 | 4.006e-07 | 8.3182e-05 |  0.0881807530820088 | FALSE           | chr2:73174848_75630086   | TET3        | chr2:74213531_74335302   |              0 | chr2:74232028_74232726   | CCDC142   |  97444 | target |     3200 |
| chr3:141105570_A_G | chr3:141125186_A_G | 6.634e-07 | 2.858e-06 | 0.00051366 |  0.0828827353298337 | TRUE            | chr3:139954597_141339097 | ZBTB38      | chr3:141043055_141168632 |              0 | chr3:141105288_141106563 | RASA2     | 119965 | target |        0 |
| chr3:141125186_A_G | chr3:141125186_A_G | 6.634e-07 | 6.634e-07 | 0.00013325 |  0.0821540692633212 | TRUE            | chr3:139954597_141339097 | ZBTB38      | chr3:141043055_141168632 |              0 | chr3:141105288_141106563 | RASA2     | 119965 | target |    18623 |
| chr3:155859113_A_G | chr3:155855597_A_G | 2.056e-09 | 2.062e-09 | 1.3753e-05 |  0.0794132056931665 | TRUE            | chr3:154714218_156008700 | KCNAB1      | chr3:155838337_155861209 |              0 | chr3:155858331_155859679 | KCNAB1    | 120420 | target |        0 |
| chr3:155861563_G_A | chr3:155855597_A_G | 2.056e-09 | 2.134e-09 | 1.3753e-05 |  0.0769301930110344 | TRUE            | chr3:154714218_156008700 | KCNAB1      | chr3:155838337_155861209 |            354 | chr3:155860834_155862503 | KCNAB1    | 120412 | bait   |        0 |
| chr3:155861563_G_A | chr3:155855597_A_G | 2.056e-09 | 2.134e-09 | 1.3753e-05 |  0.0769301930110344 | TRUE            | chr3:154714218_156008700 | KCNAB1      | chr3:155838337_155861209 |            354 | chr3:155860834_155862503 | KCNAB1    | 120413 | bait   |        0 |
| chr3:155861563_G_A | chr3:155855597_A_G | 2.056e-09 | 2.134e-09 | 1.3753e-05 |  0.0769301930110344 | TRUE            | chr3:154714218_156008700 | KCNAB1      | chr3:155838337_155861209 |            354 | chr3:155860834_155862503 | KCNAB1    | 120414 | bait   |        0 |
| chr4:174729270_A_G | chr4:174734471_G_A | 3.681e-07 | 5.175e-07 | 0.00013325 |  0.0742724933484663 | TRUE            | chr4:174264132_176570716 | HAND2-AS1   | chr4:174451609_174506879 |         222391 | chr4:174728688_174729180 | HAND2     | 127925 | target |       90 |
| chr3:127898501_A_C | chr3:127869598_C_A | 3.991e-13 | 6.389e-12 | 0.00013325 |  0.0649480930862608 | TRUE            | chr3:126214943_128194861 | EEFSEC      | chr3:127872313_128127489 |              0 | chr3:127897237_127898323 | GATA2     | 119259 | target |      178 |
| chr3:127898501_A_C | chr3:127869598_C_A | 3.991e-13 | 6.389e-12 | 0.00013325 |  0.0649480930862608 | TRUE            | chr3:126214943_128194861 | EEFSEC      | chr3:127872313_128127489 |              0 | chr3:127897237_127898323 | GATA2     | 119284 | target |      178 |
| chr3:123085359_C_T | chr3:123085359_C_T |  8.56e-10 |  8.56e-10 | 3.5663e-06 |  0.0639995247098653 | TRUE            | chr3:121974097_123517768 | ADCY5       | chr3:123001143_123167392 |              0 | chr3:123068783_123069729 | SEMA5B    | 118977 | target |    15630 |
| chr3:123072883_A_C | chr3:123085359_C_T |  8.56e-10 | 8.685e-10 | 3.5663e-06 |  0.0627655080431377 | TRUE            | chr3:121974097_123517768 | ADCY5       | chr3:123001143_123167392 |              0 | chr3:123068783_123069729 | SEMA5B    | 118977 | target |     3154 |
| chr5:157888115_C_T | chr5:157888115_C_T | 1.637e-26 | 1.637e-26 | 3.5663e-06 |  0.0597826928217112 | TRUE            | chr5:156628700_158825698 | EBF1        | chr5:158122923_158526788 |         234808 | chr5:157891243_157891553 | CLINT1    | 134395 | target |     3128 |
| chr3:141125705_C_G | chr3:141125186_A_G | 6.634e-07 | 9.537e-07 | 0.00013325 |  0.0587360750162226 | TRUE            | chr3:139954597_141339097 | ZBTB38      | chr3:141043055_141168632 |              0 | chr3:141105288_141106563 | RASA2     | 119965 | target |    19142 |
| chr3:155852076_C_T | chr3:155855597_A_G | 2.056e-09 | 2.856e-09 | 1.3753e-05 |  0.0586581178156451 | TRUE            | chr3:154714218_156008700 | KCNAB1      | chr3:155838337_155861209 |              0 | chr3:155852003_155852361 | KCNAB1    | 120419 | target |        0 |
| chr3:127936527_T_C | chr3:127869598_C_A | 3.991e-13 | 4.311e-12 | 8.3182e-05 |  0.0577792799723961 | TRUE            | chr3:126214943_128194861 | EEFSEC      | chr3:127872313_128127489 |              0 | chr3:127936037_127936312 | GATA2     | 119255 | target |      215 |
| chr3:127936532_T_C | chr3:127869598_C_A | 3.991e-13 | 4.311e-12 | 8.3182e-05 |  0.0577792799723961 | TRUE            | chr3:126214943_128194861 | EEFSEC      | chr3:127872313_128127489 |              0 | chr3:127936037_127936312 | GATA2     | 119255 | target |      220 |
| chr4:174729550_C_T | chr4:174734471_G_A | 3.681e-07 |  4.98e-07 | 9.9467e-05 |   0.057620400846482 | TRUE            | chr4:174264132_176570716 | HAND2-AS1   | chr4:174451609_174506879 |         222671 | chr4:174728688_174729180 | HAND2     | 127925 | target |      370 |
| chr3:141124607_T_C | chr3:141125186_A_G | 6.634e-07 | 9.778e-07 | 0.00013325 |  0.0574520631512038 | TRUE            | chr3:139954597_141339097 | ZBTB38      | chr3:141043055_141168632 |              0 | chr3:141105288_141106563 | RASA2     | 119965 | target |    18044 |
| chr3:127937645_G_A | chr3:127869598_C_A | 3.991e-13 | 4.419e-12 | 8.3182e-05 |  0.0566819421381121 | TRUE            | chr3:126214943_128194861 | EEFSEC      | chr3:127872313_128127489 |              0 | chr3:127936037_127936312 | GATA2     | 119255 | target |     1333 |
| chr3:141125439_T_C | chr3:141125186_A_G | 6.634e-07 |  1.07e-06 | 0.00013325 |   0.052864893968443 | TRUE            | chr3:139954597_141339097 | ZBTB38      | chr3:141043055_141168632 |              0 | chr3:141105288_141106563 | RASA2     | 119965 | target |    18876 |
| chr9:80455316_G_A  | chr9:80473690_T_C  | 6.859e-08 | 1.449e-07 | 9.9467e-05 |  0.0527779301613946 | FALSE           | chr9:79471208_81079055   | GNAQ        | chr9:80335191_80646219   |              0 | chr9:80443948_80444179   | ALG9      |  33401 | target |    11137 |
| chr3:141133450_G_A | chr3:141125186_A_G | 6.634e-07 | 7.814e-07 | 9.9467e-05 |  0.0526126433234183 | TRUE            | chr3:139954597_141339097 | ZBTB38      | chr3:141043055_141168632 |              0 | chr3:141105288_141106563 | RASA2     | 119965 | target |    26887 |
| chr3:141104180_G_A | chr3:141125186_A_G | 6.634e-07 | 1.103e-06 | 0.00013325 |  0.0514231238927406 | TRUE            | chr3:139954597_141339097 | ZBTB38      | chr3:141043055_141168632 |              0 | chr3:141105288_141106563 | RASA2     | 119965 | target |     1108 |
| chr4:174741209_C_T | chr4:174734471_G_A | 3.681e-07 | 5.796e-07 | 9.9467e-05 |    0.05060760706165 | TRUE            | chr4:174264132_176570716 | HAND2-AS1   | chr4:174451609_174506879 |         234330 | chr4:174742651_174743099 | SAP30     | 127920 | target |     1442 |
| chr4:174728566_T_G | chr4:174734471_G_A | 3.681e-07 | 7.909e-07 | 0.00013325 |  0.0505149760256708 | TRUE            | chr4:174264132_176570716 | HAND2-AS1   | chr4:174451609_174506879 |         221687 | chr4:174728688_174729180 | HAND2     | 127925 | target |      122 |
| chr3:139004333_A_G | chr3:139004333_A_G | 2.667e-08 | 2.667e-08 | 3.5663e-06 |  0.0448128468175488 | FALSE           | chr3:137371083_139954597 | PISRT1      | chr3:138951834_138952364 |          51969 | chr3:139009857_139010162 | FOXL2     | 119867 | target |     5524 |
| chr2:74217283_G_T  | chr2:74217283_G_T  | 1.549e-07 | 1.549e-07 | 1.3753e-05 |  0.0358040240630982 | FALSE           | chr2:73174848_75630086   | TET3        | chr2:74213531_74335302   |              0 | chr2:74216419_74217297   | INO80B    |  97351 | target |        0 |
| chr3:127869598_C_A | chr3:127869598_C_A | 3.991e-13 | 3.991e-13 | 3.5663e-06 |  0.0241519487911227 | TRUE            | chr3:126214943_128194861 | RUVBL1      | chr3:127783628_127872757 |              0 | chr3:127861862_127862768 | GATA2     | 119276 | target |     6830 |
| chr3:155855597_A_G | chr3:155855597_A_G | 2.056e-09 | 2.056e-09 | 3.5663e-06 |  0.0206945603600636 | TRUE            | chr3:154714218_156008700 | KCNAB1      | chr3:155838337_155861209 |              0 | chr3:155858331_155859679 | KCNAB1    | 120420 | target |     2734 |
| chr9:80473690_T_C  | chr9:80473690_T_C  | 6.859e-08 | 6.859e-08 | 3.5663e-06 | 0.00385062477717912 | FALSE           | chr9:79471208_81079055   | GNAQ        | chr9:80335191_80646219   |              0 | chr9:80443948_80444179   | ALG9      |  33401 | target |    29511 |
| chr4:174734471_G_A | chr4:174734471_G_A | 3.681e-07 | 3.681e-07 | 4.2646e-06 |  0.0032713915048207 | FALSE           | chr4:174264132_176570716 | HAND2-AS1   | chr4:174451609_174506879 |         227592 | chr4:174728688_174729180 | HAND2     | 127925 | target |     5291 |

** adding rsids

We can go back to the HDF5 file to get the rsids

#+BEGIN_SRC R :dir :session rexp :colnames yes
  library(EigenH5)

  susie_ld_df <- distinct(all_susie_df, region_id) %>% mutate(chrom = chromosomes(ldetect_EUR[region_id]), file_path = path_expand(path("~/tmp/LD", glue::glue("{chrom}_{region_id}.h5"))))

  stopifnot(all(file.exists(susie_ld_df$file_path)))
  susie_ld <- map_df(susie_ld_df$file_path, function(x) {
      read_df_h5(x, "snp", c("snp_struct", "marker.ID")) %>%
          mutate(
              snp_struct = ldmap:::migrate_ldmap_snp(snp_struct),
              ld_id = 1:n()
          )
  }) %>% select(snp = snp_struct, rsid = marker.ID, ld_id)

  rs_su_df <- left_join(all_susie_df, susie_ld)
  write_tsv(rs_su_df, "~/tmp/all_susie_results.tsv.gz")

  susie_ld <- group_by(rs_su_df, region_id) %>%
      filter(pval == min(pval)) %>%
      ungroup() %>%
      mutate(chrom = chromosomes(ldetect_EUR[region_id]), file_path = path_expand(path("~/tmp/LD", glue::glue("{chrom}_{region_id}.h5")))) %>%
      pmap_df(function(snp, ld_id, file_path, region_id, ...) {
          tibble::tibble(r = c(read_matrix_h5v(file_path, "R", i = ld_id))) %>% mutate(ld_id = 1:n(), region_id = region_id)
      }) %>%
      inner_join(rs_su_df) %>%
      select(snp,rsid,r)
#+END_SRC

#+RESULTS:




#+NAME: goodsnps
| rsid        |
|-------------|
| rs147843771 |
| rs17315501  |
| rs2946164   |
| rs13141656  |
| rs7663453   |
| rs13387174  |
| rs4677884   |
| rs56318008  |
| rs55938609  |
| rs3820282   |
| rs4679761   |
| rs9882088   |
| rs3122173   |
| rs2999048   |
| rs1554535   |

#+BEGIN_SRC R :session rexp
final_model_anno <- torus_feature_sets[["utme3treatedhic"]]

#+END_SRC


#+BEGIN_SRC R :session rexp :var goodsnps=goodsnps :colnames yes
  torus_results <- inner_join(hic_nearest, susie_ld) %>%
      mutate(anno = map(anno, function(x) {
          c(str_replace(x, "hicd-seq-.+-dec-HIC", "hicd-seq-both-dec-HIC"), "intercept")
      })) %>%
      unnest(anno) %>%
      filter(anno %in% c("intercept", final_model_anno)) %>%
      mutate(val = 1L) %>%
      select(snp, anno, rsid, ldmr, pval, starts_with("uniform"), prior, pip, val) %>%
      distinct() %>%
      pivot_wider(names_from = "anno", values_from = "val", values_fill = list(val = 0L)) %>%
      select(-intercept)
#+END_SRC

#+RESULTS:


#+BEGIN_SRC R :session rexp  :colnames yes
  group_by(torus_results, ldmr) %>%
    mutate(minp = min(pval)) %>%
    ungroup() %>%
    arrange(minp, desc(pip))  %>%
    select(-minp)  %>%
    WriteXLS::WriteXLS("~/Dropbox/MOD\ paper\ 1/Figures_GWAS/torus_full.xls")
#+END_SRC

#+RESULTS:

#+BEGIN_SRC R :dir :session rexp :var goodsnps=goodsnps :colnames yes
  good_hic <- inner_join(hic_nearest,susie_ld) %>% 
    filter(pip>0.01) %>%
    mutate(bait_gene=if_else(bait_gene==".","",bait_gene),
           target_gene=if_else(target_gene==".","",target_gene),
           is_hic=abs(hic_dist)<1000,
           hic_bait_gene=if_else(is_hic,bait_gene,""),
           hic_target_gene=if_else(is_hic,target_gene,"")) %>%
    mutate(anno=map2_chr(anno,is_hic,function(x,y){
      annos <- unique(str_remove(x,".+-"))
      if(y)
        annos <- unique(c(annos,"HIC"))
      paste0(annos,collapse=",")
    })) %>% 
    group_by(snp,rsid,ldmr,anno,pip,pval) %>%
    summarise(hic_genes=paste0(unique(c(hic_bait_gene,hic_target_gene)),collapse=",")) %>% 
    ungroup()  %>% mutate(hic_genes=str_remove(hic_genes,",$"),anno=str_replace(anno,"HIC","Hi-C") )
    #+END_SRC

    #+RESULTS:
    | snp                | rsid        | ldmr                     | anno                              |                pip |      pval | hic_genes |
    |--------------------+-------------+--------------------------+-----------------------------------+--------------------+-----------+-----------|
    | chr1:22422721_G_A  | rs10917151  | chr1:21736588_23086883   | H3K4me1                           | 0.0209526156811722 | 6.836e-12 |           |
    | chr1:22436446_G_C  | rs7412010   | chr1:21736588_23086883   | H3K4me1,H3K27ac                   | 0.0368352701058852 | 4.507e-12 |           |
    | chr1:22444975_C_T  | rs10737462  | chr1:21736588_23086883   | H3K4me1,H3K27ac                   | 0.0245819503007232 | 6.927e-12 |           |
    | chr1:22468215_C_T  | rs3820282   | chr1:21736588_23086883   | H3K4me1,H3K4me3,ATAC,Hi-C         |   0.27230339640513 | 6.414e-13 | C1QC,WNT4 |
    | chr1:22470407_C_T  | rs56318008  | chr1:21736588_23086883   | H3K4me1,H3K4me3,ATAC,Hi-C         |  0.302745288641221 |  2.34e-12 | C1QC,WNT4 |
    | chr1:22470451_G_C  | rs55938609  | chr1:21736588_23086883   | H3K4me1,H3K4me3,ATAC,Hi-C         |  0.302745288641221 |  2.34e-12 | C1QC,WNT4 |
    | chr2:74206685_G_A  | rs13387174  | chr2:73174848_75630086   | Hi-C,H3K4me1,H3K27ac              |  0.353729177223882 | 4.677e-07 | WBP1      |
    | chr2:74207357_G_A  | rs13390332  | chr2:73174848_75630086   | H3K4me1,H3K27ac,Hi-C              |  0.185530071716854 | 2.178e-07 | WBP1      |
    | chr2:74217283_G_T  | rs6721042   | chr2:73174848_75630086   | Hi-C                              | 0.0358040240630982 | 1.549e-07 | INO80B    |
    | chr2:74227912_C_T  | rs34363691  | chr2:73174848_75630086   | ATAC,H3K4me1,Hi-C                 | 0.0297501532551466 | 1.313e-06 | WDR54     |
    | chr2:74228241_T_C  | rs35259799  | chr2:73174848_75630086   | Hi-C,ATAC,H3K4me1                 | 0.0461160461661728 | 3.492e-06 | WDR54     |
    | chr2:74230656_C_T  | rs10166357  | chr2:73174848_75630086   | ATAC,H3K4me1,H3K27ac,H3K4me3,Hi-C |  0.146327332168703 | 3.858e-07 | DGUOK     |
    | chr2:74232731_G_C  | rs13391722  | chr2:73174848_75630086   | H3K4me1,Hi-C                      | 0.0355146857021134 | 1.074e-06 | CCDC142   |
    | chr2:74235926_A_G  | rs34555419  | chr2:73174848_75630086   | H3K4me1                           | 0.0881807530820088 | 4.006e-07 |           |
    | chr3:123061168_A_G | rs13078718  | chr3:121974097_123517768 |                                   | 0.0130085054180841 |  4.61e-09 |           |
    | chr3:123062970_G_C | rs4677884   | chr3:121974097_123517768 | H3K4me1,ATAC                      |  0.337861345969416 | 4.107e-09 |           |
    | chr3:123064831_T_C | rs9289218   | chr3:121974097_123517768 |                                   | 0.0142495965237444 | 4.171e-09 |           |
    | chr3:123065488_C_G | rs9857544   | chr3:121974097_123517768 |                                   | 0.0190809356304447 | 3.061e-09 |           |
    | chr3:123065490_C_G | rs11924387  | chr3:121974097_123517768 |                                   | 0.0185071994784833 | 3.156e-09 |           |
    | chr3:123066485_T_G | rs6438788   | chr3:121974097_123517768 |                                   | 0.0199190104430715 | 2.921e-09 |           |
    | chr3:123068109_C_T | rs4450740   | chr3:121974097_123517768 | Hi-C                              | 0.0210222173700403 | 2.759e-09 | SEMA5B    |
    | chr3:123068286_T_C | rs4596093   | chr3:121974097_123517768 | Hi-C                              | 0.0235917843181461 | 2.446e-09 | SEMA5B    |
    | chr3:123068743_A_G | rs4630884   | chr3:121974097_123517768 | Hi-C                              | 0.0259322777061546 | 2.218e-09 | SEMA5B    |
    | chr3:123072883_A_C | rs9861425   | chr3:121974097_123517768 | ATAC                              | 0.0627655080431377 | 8.685e-10 |           |
    | chr3:123075118_T_C | rs6778215   | chr3:121974097_123517768 |                                   | 0.0319558586003551 | 1.779e-09 |           |
    | chr3:123077042_T_A | rs4093840   | chr3:121974097_123517768 |                                   | 0.0223767115987361 | 2.598e-09 |           |
    | chr3:123078079_A_G | rs2062432   | chr3:121974097_123517768 |                                   | 0.0184863704789805 | 3.177e-09 |           |
    | chr3:123079159_T_A | rs9865576   | chr3:121974097_123517768 |                                   | 0.0228163774426396 | 2.532e-09 |           |
    | chr3:123082416_G_A | rs9881942   | chr3:121974097_123517768 |                                   | 0.0229541404878673 | 2.515e-09 |           |
    | chr3:123085098_A_G | rs6781704   | chr3:121974097_123517768 |                                   | 0.0218313099225327 | 2.655e-09 |           |
    | chr3:123085337_T_C | rs6794803   | chr3:121974097_123517768 |                                   | 0.0324812646097671 | 1.745e-09 |           |
    | chr3:123085359_C_T | rs6794886   | chr3:121974097_123517768 |                                   | 0.0639995247098653 |  8.56e-10 |           |
    | chr3:123087264_G_C | rs13097463  | chr3:121974097_123517768 |                                   | 0.0146147494533215 | 4.063e-09 |           |
    | chr3:123089670_A_G | rs11923649  | chr3:121974097_123517768 |                                   | 0.0435498757102315 | 1.278e-09 |           |
    | chr3:123096000_A_G | rs4467388   | chr3:121974097_123517768 |                                   | 0.0268378032112218 | 2.143e-09 |           |
    | chr3:123096322_C_G | rs2332510   | chr3:121974097_123517768 |                                   | 0.0253855067522505 | 2.267e-09 |           |
    | chr3:123112292_T_C | rs28654158  | chr3:121974097_123517768 | ATAC                              | 0.0269677714062401 | 2.129e-09 |           |
    | chr3:127822320_C_T | rs7641133   | chr3:126214943_128194861 | H3K4me1                           | 0.0345790073683665 | 7.309e-12 |           |
    | chr3:127869598_C_A | rs144609957 | chr3:126214943_128194861 |                                   | 0.0241519487911227 | 3.991e-13 |           |
    | chr3:127878416_G_A | rs2999048   | chr3:126214943_128194861 | H3K4me1,H3K27ac,Hi-C              |   0.11894897541832 | 2.008e-12 | GATA2     |
    | chr3:127878817_T_C | rs2999049   | chr3:126214943_128194861 | Hi-C                              | 0.0342544389486695 | 1.132e-12 | GATA2     |
    | chr3:127889287_A_G | rs3122173   | chr3:126214943_128194861 | H3K4me1,Hi-C                      |  0.181751312175621 | 5.401e-12 | GATA2     |
    | chr3:127895226_A_G | rs2687729   | chr3:126214943_128194861 | H3K4me1,Hi-C                      |  0.049288925444982 | 5.163e-12 | GATA2     |
    | chr3:127895986_G_A | rs1554535   | chr3:126214943_128194861 | H3K4me1,Hi-C,H3K27ac              |  0.098883034177444 | 1.221e-11 | GATA2     |
    | chr3:127898501_A_C | rs2811476   | chr3:126214943_128194861 | H3K4me1,ATAC,H3K4me3,H3K27ac,Hi-C | 0.0649480930862608 | 6.389e-12 | GATA2     |
    | chr3:127936527_T_C | rs9879865   | chr3:126214943_128194861 | H3K4me1,ATAC,H3K27ac,Hi-C         | 0.0577792799723961 | 4.311e-12 | GATA2     |
    | chr3:127936532_T_C | rs9879866   | chr3:126214943_128194861 | H3K4me1,ATAC,H3K27ac,Hi-C         | 0.0577792799723961 | 4.311e-12 | GATA2     |
    | chr3:127937645_G_A | rs9847576   | chr3:126214943_128194861 | H3K4me1,H3K27ac                   | 0.0566819421381121 | 4.419e-12 |           |
    | chr3:128046643_G_A | rs4857841   | chr3:126214943_128194861 | Hi-C                              | 0.0177294832252679 | 2.212e-12 | GATA2     |
    | chr3:138843356_G_A | rs147843771 | chr3:137371083_139954597 | H3K4me1                           |  0.740639510360678 | 3.824e-08 |           |
    | chr3:139004333_A_G | rs62270785  | chr3:137371083_139954597 |                                   | 0.0448128468175488 | 2.667e-08 |           |
    | chr3:139029676_G_A | rs17315501  | chr3:137371083_139954597 | H3K4me1,H3K4me3,ATAC,H3K27ac      |  0.211193096775336 | 1.783e-07 |           |
    | chr3:141101961_C_T | rs9853018   | chr3:139954597_141339097 | H3K4me1,H3K27ac,H3K4me3           | 0.0125344310842652 | 3.733e-06 |           |
    | chr3:141102833_G_A | rs6763931   | chr3:139954597_141339097 | ATAC,H3K4me1,H3K27ac,H3K4me3      | 0.0209896414177978 | 2.921e-06 |           |
    | chr3:141104180_G_A | rs6767786   | chr3:139954597_141339097 | H3K4me1,H3K27ac,H3K4me3           | 0.0514231238927406 | 1.103e-06 |           |
    | chr3:141105570_A_G | rs724016    | chr3:139954597_141339097 | Hi-C,H3K4me1,H3K27ac,H3K4me3      | 0.0828827353298337 | 2.858e-06 | RASA2     |
    | chr3:141106063_T_C | rs7632381   | chr3:139954597_141339097 | Hi-C,H3K4me1,H3K27ac,H3K4me3      |  0.107334842154585 | 2.158e-06 | RASA2     |
    | chr3:141106954_A_T | rs13077048  | chr3:139954597_141339097 | H3K4me1,H3K27ac,Hi-C              | 0.0106463282135183 | 4.464e-06 | RASA2     |
    | chr3:141110074_A_G | rs4683606   | chr3:139954597_141339097 | H3K4me1,H3K27ac                   |  0.016804309276977 | 2.705e-06 |           |
    | chr3:141118028_A_G | rs13068733  | chr3:139954597_141339097 | H3K4me1,H3K27ac                   | 0.0157066759454859 | 2.917e-06 |           |
    | chr3:141121814_A_C | rs2871960   | chr3:139954597_141339097 | ATAC,H3K4me1,H3K27ac,H3K4me3      | 0.0381888300210145 | 1.526e-06 |           |
    | chr3:141124607_T_C | rs2011092   | chr3:139954597_141339097 | H3K4me1,H3K27ac,H3K4me3           | 0.0574520631512038 | 9.778e-07 |           |
    | chr3:141125186_A_G | rs1344674   | chr3:139954597_141339097 | H3K4me1,H3K27ac,H3K4me3           | 0.0821540692633212 | 6.634e-07 |           |
    | chr3:141125439_T_C | rs6767899   | chr3:139954597_141339097 | H3K4me1,H3K27ac,H3K4me3           |  0.052864893968443 |  1.07e-06 |           |
    | chr3:141125705_C_G | rs1344672   | chr3:139954597_141339097 | H3K4me1,H3K27ac,H3K4me3           | 0.0587360750162226 | 9.537e-07 |           |
    | chr3:141128804_G_A | rs13099193  | chr3:139954597_141339097 | H3K4me1,H3K27ac                   | 0.0272922839911848 | 1.602e-06 |           |
    | chr3:141129999_G_A | rs13066993  | chr3:139954597_141339097 | H3K4me1,H3K27ac,H3K4me3           | 0.0269137975390084 | 1.622e-06 |           |
    | chr3:141130835_C_T | rs35225290  | chr3:139954597_141339097 | H3K4me1,H3K27ac                   | 0.0283500611164137 | 1.538e-06 |           |
    | chr3:141133450_G_A | rs1991431   | chr3:139954597_141339097 | ATAC,H3K4me1,H3K27ac,H3K4me3      | 0.0526126433234183 | 7.814e-07 |           |
    | chr3:141133960_G_A | rs13091182  | chr3:139954597_141339097 | H3K4me1,H3K27ac                   |  0.026560720210736 | 1.647e-06 |           |
    | chr3:141139330_G_A | rs6785073   | chr3:139954597_141339097 | H3K4me1,H3K27ac                   | 0.0278761056038784 | 1.559e-06 |           |
    | chr3:141140366_A_T | rs6763927   | chr3:139954597_141339097 | H3K4me1,H3K27ac                   | 0.0475870193360597 | 8.742e-07 |           |
    | chr3:141140968_C_T | rs9846396   | chr3:139954597_141339097 | H3K4me1,H3K27ac                   | 0.0459534601878102 | 9.087e-07 |           |
    | chr3:141142691_G_A | rs6440006   | chr3:139954597_141339097 | H3K4me1,H3K27ac                   | 0.0220796801739341 | 2.012e-06 |           |
    | chr3:141150026_A_G | rs7625643   | chr3:139954597_141339097 | H3K4me1,H3K27ac,H3K4me3           | 0.0115807940637556 |  5.59e-06 |           |
    | chr3:141154542_T_C | rs6440008   | chr3:139954597_141339097 | H3K4me1,H3K27ac,H3K4me3           | 0.0115037684673659 |   4.1e-06 |           |
    | chr3:155820102_A_G | rs1994502   | chr3:154714218_156008700 | H3K4me1                           | 0.0315705105041723 | 3.701e-08 |           |
    | chr3:155829897_G_T | rs28406457  | chr3:154714218_156008700 |                                   | 0.0123771721542963 | 3.555e-09 |           |
    | chr3:155843745_C_T | rs13073556  | chr3:154714218_156008700 |                                   | 0.0101730081646089 | 4.355e-09 |           |
    | chr3:155844010_A_G | rs4680232   | chr3:154714218_156008700 |                                   | 0.0120379185615658 | 3.659e-09 |           |
    | chr3:155844353_A_T | rs4680233   | chr3:154714218_156008700 |                                   | 0.0122575994904055 | 3.582e-09 |           |
    | chr3:155846398_T_G | rs11709514  | chr3:154714218_156008700 |                                   | 0.0173152479298468 | 2.492e-09 |           |
    | chr3:155852076_C_T | rs6793964   | chr3:154714218_156008700 | Hi-C                              | 0.0586581178156451 | 2.856e-09 | KCNAB1    |
    | chr3:155855597_A_G | rs56231269  | chr3:154714218_156008700 |                                   | 0.0206945603600636 | 2.056e-09 |           |
    | chr3:155856674_G_A | rs9814661   | chr3:154714218_156008700 |                                   | 0.0189715141319304 | 2.259e-09 |           |
    | chr3:155856843_T_C | rs9856468   | chr3:154714218_156008700 |                                   | 0.0189715141319304 | 2.261e-09 |           |
    | chr3:155858044_A_G | rs6441035   | chr3:154714218_156008700 | Hi-C                              | 0.0204668484227688 | 2.084e-09 | KCNAB1    |
    | chr3:155859113_A_G | rs4680237   | chr3:154714218_156008700 | Hi-C                              | 0.0794132056931665 | 2.062e-09 | KCNAB1    |
    | chr3:155861563_G_A | rs7618820   | chr3:154714218_156008700 | Hi-C                              | 0.0769301930110344 | 2.134e-09 | KCNAB1    |
    | chr3:155862524_A_G | rs4359773   | chr3:154714218_156008700 | Hi-C                              | 0.0179991929992214 | 2.389e-09 | KCNAB1    |
    | chr3:155862593_A_G | rs4359774   | chr3:154714218_156008700 | Hi-C                              | 0.0191336479751648 | 2.237e-09 | KCNAB1    |
    | chr3:155862705_T_C | rs4605502   | chr3:154714218_156008700 | Hi-C                              | 0.0184444336474435 | 2.315e-09 | KCNAB1    |
    | chr3:155867092_A_G | rs9882088   | chr3:154714218_156008700 | H3K4me1                           |   0.19115688143615 | 5.515e-09 |           |
    | chr3:155868039_G_A | rs4679761   | chr3:154714218_156008700 | H3K4me1,H3K27ac,Hi-C              |  0.247185586838391 | 5.041e-09 | KCNAB1    |
    | chr4:174726131_T_G | rs5014764   | chr4:174264132_176570716 | H3K4me1,H3K27ac                   | 0.0399164630650034 | 7.474e-07 |           |
    | chr4:174728566_T_G | rs13121843  | chr4:174264132_176570716 | H3K4me1,H3K27ac,H3K4me3,ATAC,Hi-C | 0.0505149760256708 | 7.909e-07 | HAND2     |
    | chr4:174728703_C_T | rs13141656  | chr4:174264132_176570716 | H3K4me1,H3K27ac,H3K4me3,ATAC,Hi-C |  0.381114818123928 |  3.86e-07 | HAND2     |
    | chr4:174729014_G_A | rs7663453   | chr4:174264132_176570716 | H3K4me1,H3K27ac,H3K4me3,Hi-C      |  0.329331089464829 | 4.482e-07 | HAND2     |
    | chr4:174729270_A_G | rs7689307   | chr4:174264132_176570716 | H3K4me1,H3K27ac,H3K4me3,Hi-C      | 0.0742724933484663 | 5.175e-07 | HAND2     |
    | chr4:174729550_C_T | rs12512745  | chr4:174264132_176570716 | H3K4me1,H3K27ac,Hi-C              |  0.057620400846482 |  4.98e-07 | HAND2     |
    | chr4:174741209_C_T | rs13140184  | chr4:174264132_176570716 | H3K4me1,H3K27ac                   |   0.05060760706165 | 5.796e-07 |           |
    | chr5:157884706_T_C | rs2946164   | chr5:156628700_158825698 | H3K4me1                           |   0.72179868954602 | 3.036e-26 |           |
    | chr5:157886627_C_T | rs2946179   | chr5:156628700_158825698 |                                   | 0.0307636206410981 | 3.046e-26 |           |
    | chr5:157886953_A_G | rs7729301   | chr5:156628700_158825698 |                                   | 0.0309460059451321 | 3.025e-26 |           |
    | chr5:157887966_C_T | rs6881817   | chr5:156628700_158825698 |                                   |  0.044774365818272 | 2.059e-26 |           |
    | chr5:157888115_C_T | rs6881996   | chr5:156628700_158825698 |                                   | 0.0597826928217112 | 1.637e-26 |           |
    | chr5:157891878_A_G | rs2946160   | chr5:156628700_158825698 | Hi-C                              | 0.0189353165784302 | 5.304e-26 | CLINT1    |
    | chr5:157892530_T_C | rs2964481   | chr5:156628700_158825698 | ATAC,Hi-C                         | 0.0158141577185017 | 6.023e-26 | CLINT1    |
    | chr5:157894747_T_C | rs12520982  | chr5:156628700_158825698 |                                   | 0.0159819700855176 | 5.784e-26 |           |
    | chr5:157895049_C_T | rs2963463   | chr5:156628700_158825698 |                                   | 0.0358461958975438 | 2.688e-26 |           |
    | chr5:157896786_T_C | rs2963462   | chr5:156628700_158825698 |                                   | 0.0197827615962538 | 4.465e-26 |           |
    | chr9:80323020_G_A  | rs7857953   | chr9:79471208_81079055   | H3K27ac,H3K4me1,H3K4me3,ATAC      |  0.027312545096304 | 4.007e-07 |           |
    | chr9:80325842_T_C  | rs12345348  | chr9:79471208_81079055   | H3K27ac,H3K4me1                   | 0.0134875757958209 | 6.351e-07 |           |
    | chr9:80330718_C_G  | rs4745664   | chr9:79471208_81079055   | H3K27ac,H3K4me1                   | 0.0161642640233651 | 5.157e-07 |           |
    | chr9:80341653_C_T  | rs7875020   | chr9:79471208_81079055   | H3K27ac,H3K4me1                   | 0.0162926105675348 | 5.174e-07 |           |
    | chr9:80348352_T_C  | rs3780299   | chr9:79471208_81079055   | H3K27ac,H3K4me1                   | 0.0205531080184171 |  4.03e-07 |           |
    | chr9:80358635_A_G  | rs979354    | chr9:79471208_81079055   | H3K27ac,H3K4me1                   | 0.0255334454675957 | 3.152e-07 |           |
    | chr9:80364115_C_A  | rs10869963  | chr9:79471208_81079055   | H3K27ac,H3K4me1                   | 0.0231025988823537 |  3.53e-07 |           |
    | chr9:80422183_C_T  | rs3780305   | chr9:79471208_81079055   | H3K27ac,H3K4me1,ATAC              | 0.0217229109454142 | 3.819e-07 |           |
    | chr9:80454629_A_C  | rs1887772   | chr9:79471208_81079055   | H3K27ac,H3K4me1,H3K4me3,ATAC      | 0.0491457489135665 | 2.159e-07 |           |
    | chr9:80455316_G_A  | rs1854325   | chr9:79471208_81079055   | H3K27ac,H3K4me1                   | 0.0527779301613946 | 1.449e-07 |           |
    | chr9:80456737_G_A  | rs1328524   | chr9:79471208_81079055   | H3K4me1,H3K27ac                   | 0.0397775696949738 | 1.987e-07 |           |
    | chr9:80460024_A_T  | rs1328525   | chr9:79471208_81079055   | H3K4me1                           | 0.0196432858174973 | 3.457e-07 |           |
    | chr9:80472931_C_T  | rs11145589  | chr9:79471208_81079055   | H3K4me1,H3K27ac                   |  0.104850691148267 | 7.031e-08 |           |
    | chr9:80494386_G_A  | rs7860090   | chr9:79471208_81079055   | H3K27ac,H3K4me1                   | 0.0102610686893942 | 6.993e-07 |           |
    | chr9:80500405_C_T  | rs10781468  | chr9:79471208_81079055   | H3K4me1                           | 0.0124630171944785 | 5.613e-07 |           |
    | chr9:80544662_C_A  | rs7852315   | chr9:79471208_81079055   | H3K4me1,Hi-C                      | 0.0136326435515508 |   5.2e-07 | CEP78     |
    | chr9:80567510_T_C  | rs7866517   | chr9:79471208_81079055   | H3K4me1                           | 0.0136313870542825 | 5.154e-07 |           |
    | chr9:80568980_C_A  | rs2026009   | chr9:79471208_81079055   | H3K27ac,H3K4me1                   | 0.0198831342156075 | 4.186e-07 |           |
    | chr9:80604672_T_G  | rs1541056   | chr9:79471208_81079055   | H3K4me1                           | 0.0123513781784148 | 5.762e-07 |           |
    | chr9:80613593_C_T  | rs1075369   | chr9:79471208_81079055   | H3K4me1                           | 0.0124069103980547 | 5.763e-07 |           |
    | chr9:80614389_C_T  | rs7044515   | chr9:79471208_81079055   | H3K27ac,H3K4me1,H3K4me3,ATAC      | 0.0185851907029475 | 6.075e-07 |           |
    | chr9:80624691_T_C  | rs1930544   | chr9:79471208_81079055   | H3K4me1,Hi-C                      | 0.0122962589861165 | 5.794e-07 | PSAT1     |
    | chr9:80629814_G_C  | rs4744857   | chr9:79471208_81079055   | H3K27ac,H3K4me1,H3K4me3           | 0.0117351495396265 | 1.003e-06 |           |
    | chr9:80630009_T_C  | rs10781478  | chr9:79471208_81079055   | H3K27ac,H3K4me1,H3K4me3           | 0.0129516300398346 | 9.094e-07 |           |
    | chr9:80630123_C_T  | rs10870007  | chr9:79471208_81079055   | H3K27ac,H3K4me1,H3K4me3           | 0.0110208340036504 | 1.093e-06 |           |
    | chr9:80630131_A_C  | rs10870008  | chr9:79471208_81079055   | H3K27ac,H3K4me1,H3K4me3           |  0.011181512258733 |  1.05e-06 |           |
    | chr9:80638165_T_C  | rs1041584   | chr9:79471208_81079055   | H3K27ac,H3K4me1,H3K4me3,ATAC      | 0.0117493645723988 | 7.287e-07 |           |
    | chr9:80638290_C_T  | rs1041583   | chr9:79471208_81079055   | H3K27ac,H3K4me1,H3K4me3,ATAC      | 0.0103051853694986 | 8.545e-07 |           |
    | chr9:80649703_A_C  | rs10870013  | chr9:79471208_81079055   | H3K27ac,H3K4me1                   | 0.0119636716103413 | 7.242e-07 |           |




#+BEGIN_SRC R :dir :session rexp 
  rename(good_hic,locus=ldmr) %>% 
    write_tsv("~/Dropbox/MOD\ paper\ 1/Figures_GWAS/high_pip_snps.tsv")

#+END_SRC    

#+RESULTS:
| chr1:22422721_G_A  | rs10917151  | chr1:21736588_23086883   | H3K4me1                           | 0.0209526156811722 | 6.836e-12 |           |
| chr1:22436446_G_C  | rs7412010   | chr1:21736588_23086883   | H3K4me1,H3K27ac                   | 0.0368352701058852 | 4.507e-12 |           |
| chr1:22444975_C_T  | rs10737462  | chr1:21736588_23086883   | H3K4me1,H3K27ac                   | 0.0245819503007232 | 6.927e-12 |           |
| chr1:22468215_C_T  | rs3820282   | chr1:21736588_23086883   | H3K4me1,H3K4me3,ATAC,Hi-C         |   0.27230339640513 | 6.414e-13 | C1QC,WNT4 |
| chr1:22470407_C_T  | rs56318008  | chr1:21736588_23086883   | H3K4me1,H3K4me3,ATAC,Hi-C         |  0.302745288641221 |  2.34e-12 | C1QC,WNT4 |
| chr1:22470451_G_C  | rs55938609  | chr1:21736588_23086883   | H3K4me1,H3K4me3,ATAC,Hi-C         |  0.302745288641221 |  2.34e-12 | C1QC,WNT4 |
| chr2:74206685_G_A  | rs13387174  | chr2:73174848_75630086   | Hi-C,H3K4me1,H3K27ac              |  0.353729177223882 | 4.677e-07 | WBP1      |
| chr2:74207357_G_A  | rs13390332  | chr2:73174848_75630086   | H3K4me1,H3K27ac,Hi-C              |  0.185530071716854 | 2.178e-07 | WBP1      |
| chr2:74217283_G_T  | rs6721042   | chr2:73174848_75630086   | Hi-C                              | 0.0358040240630982 | 1.549e-07 | INO80B    |
| chr2:74227912_C_T  | rs34363691  | chr2:73174848_75630086   | ATAC,H3K4me1,Hi-C                 | 0.0297501532551466 | 1.313e-06 | WDR54     |
| chr2:74228241_T_C  | rs35259799  | chr2:73174848_75630086   | Hi-C,ATAC,H3K4me1                 | 0.0461160461661728 | 3.492e-06 | WDR54     |
| chr2:74230656_C_T  | rs10166357  | chr2:73174848_75630086   | ATAC,H3K4me1,H3K27ac,H3K4me3,Hi-C |  0.146327332168703 | 3.858e-07 | DGUOK     |
| chr2:74232731_G_C  | rs13391722  | chr2:73174848_75630086   | H3K4me1,Hi-C                      | 0.0355146857021134 | 1.074e-06 | CCDC142   |
| chr2:74235926_A_G  | rs34555419  | chr2:73174848_75630086   | H3K4me1                           | 0.0881807530820088 | 4.006e-07 |           |
| chr3:123061168_A_G | rs13078718  | chr3:121974097_123517768 |                                   | 0.0130085054180841 |  4.61e-09 |           |
| chr3:123062970_G_C | rs4677884   | chr3:121974097_123517768 | H3K4me1,ATAC                      |  0.337861345969416 | 4.107e-09 |           |
| chr3:123064831_T_C | rs9289218   | chr3:121974097_123517768 |                                   | 0.0142495965237444 | 4.171e-09 |           |
| chr3:123065488_C_G | rs9857544   | chr3:121974097_123517768 |                                   | 0.0190809356304447 | 3.061e-09 |           |
| chr3:123065490_C_G | rs11924387  | chr3:121974097_123517768 |                                   | 0.0185071994784833 | 3.156e-09 |           |
| chr3:123066485_T_G | rs6438788   | chr3:121974097_123517768 |                                   | 0.0199190104430715 | 2.921e-09 |           |
| chr3:123068109_C_T | rs4450740   | chr3:121974097_123517768 | Hi-C                              | 0.0210222173700403 | 2.759e-09 | SEMA5B    |
| chr3:123068286_T_C | rs4596093   | chr3:121974097_123517768 | Hi-C                              | 0.0235917843181461 | 2.446e-09 | SEMA5B    |
| chr3:123068743_A_G | rs4630884   | chr3:121974097_123517768 | Hi-C                              | 0.0259322777061546 | 2.218e-09 | SEMA5B    |
| chr3:123072883_A_C | rs9861425   | chr3:121974097_123517768 | ATAC                              | 0.0627655080431377 | 8.685e-10 |           |
| chr3:123075118_T_C | rs6778215   | chr3:121974097_123517768 |                                   | 0.0319558586003551 | 1.779e-09 |           |
| chr3:123077042_T_A | rs4093840   | chr3:121974097_123517768 |                                   | 0.0223767115987361 | 2.598e-09 |           |
| chr3:123078079_A_G | rs2062432   | chr3:121974097_123517768 |                                   | 0.0184863704789805 | 3.177e-09 |           |
| chr3:123079159_T_A | rs9865576   | chr3:121974097_123517768 |                                   | 0.0228163774426396 | 2.532e-09 |           |
| chr3:123082416_G_A | rs9881942   | chr3:121974097_123517768 |                                   | 0.0229541404878673 | 2.515e-09 |           |
| chr3:123085098_A_G | rs6781704   | chr3:121974097_123517768 |                                   | 0.0218313099225327 | 2.655e-09 |           |
| chr3:123085337_T_C | rs6794803   | chr3:121974097_123517768 |                                   | 0.0324812646097671 | 1.745e-09 |           |
| chr3:123085359_C_T | rs6794886   | chr3:121974097_123517768 |                                   | 0.0639995247098653 |  8.56e-10 |           |
| chr3:123087264_G_C | rs13097463  | chr3:121974097_123517768 |                                   | 0.0146147494533215 | 4.063e-09 |           |
| chr3:123089670_A_G | rs11923649  | chr3:121974097_123517768 |                                   | 0.0435498757102315 | 1.278e-09 |           |
| chr3:123096000_A_G | rs4467388   | chr3:121974097_123517768 |                                   | 0.0268378032112218 | 2.143e-09 |           |
| chr3:123096322_C_G | rs2332510   | chr3:121974097_123517768 |                                   | 0.0253855067522505 | 2.267e-09 |           |
| chr3:123112292_T_C | rs28654158  | chr3:121974097_123517768 | ATAC                              | 0.0269677714062401 | 2.129e-09 |           |
| chr3:127822320_C_T | rs7641133   | chr3:126214943_128194861 | H3K4me1                           | 0.0345790073683665 | 7.309e-12 |           |
| chr3:127869598_C_A | rs144609957 | chr3:126214943_128194861 |                                   | 0.0241519487911227 | 3.991e-13 |           |
| chr3:127878416_G_A | rs2999048   | chr3:126214943_128194861 | H3K4me1,H3K27ac,Hi-C              |   0.11894897541832 | 2.008e-12 | GATA2     |
| chr3:127878817_T_C | rs2999049   | chr3:126214943_128194861 | Hi-C                              | 0.0342544389486695 | 1.132e-12 | GATA2     |
| chr3:127889287_A_G | rs3122173   | chr3:126214943_128194861 | H3K4me1,Hi-C                      |  0.181751312175621 | 5.401e-12 | GATA2     |
| chr3:127895226_A_G | rs2687729   | chr3:126214943_128194861 | H3K4me1,Hi-C                      |  0.049288925444982 | 5.163e-12 | GATA2     |
| chr3:127895986_G_A | rs1554535   | chr3:126214943_128194861 | H3K4me1,Hi-C,H3K27ac              |  0.098883034177444 | 1.221e-11 | GATA2     |
| chr3:127898501_A_C | rs2811476   | chr3:126214943_128194861 | H3K4me1,ATAC,H3K4me3,H3K27ac,Hi-C | 0.0649480930862608 | 6.389e-12 | GATA2     |
| chr3:127936527_T_C | rs9879865   | chr3:126214943_128194861 | H3K4me1,ATAC,H3K27ac,Hi-C         | 0.0577792799723961 | 4.311e-12 | GATA2     |
| chr3:127936532_T_C | rs9879866   | chr3:126214943_128194861 | H3K4me1,ATAC,H3K27ac,Hi-C         | 0.0577792799723961 | 4.311e-12 | GATA2     |
| chr3:127937645_G_A | rs9847576   | chr3:126214943_128194861 | H3K4me1,H3K27ac                   | 0.0566819421381121 | 4.419e-12 |           |
| chr3:128046643_G_A | rs4857841   | chr3:126214943_128194861 | Hi-C                              | 0.0177294832252679 | 2.212e-12 | GATA2     |
| chr3:138843356_G_A | rs147843771 | chr3:137371083_139954597 | H3K4me1                           |  0.740639510360678 | 3.824e-08 |           |
| chr3:139004333_A_G | rs62270785  | chr3:137371083_139954597 |                                   | 0.0448128468175488 | 2.667e-08 |           |
| chr3:139029676_G_A | rs17315501  | chr3:137371083_139954597 | H3K4me1,H3K4me3,ATAC,H3K27ac      |  0.211193096775336 | 1.783e-07 |           |
| chr3:141101961_C_T | rs9853018   | chr3:139954597_141339097 | H3K4me1,H3K27ac,H3K4me3           | 0.0125344310842652 | 3.733e-06 |           |
| chr3:141102833_G_A | rs6763931   | chr3:139954597_141339097 | ATAC,H3K4me1,H3K27ac,H3K4me3      | 0.0209896414177978 | 2.921e-06 |           |
| chr3:141104180_G_A | rs6767786   | chr3:139954597_141339097 | H3K4me1,H3K27ac,H3K4me3           | 0.0514231238927406 | 1.103e-06 |           |
| chr3:141105570_A_G | rs724016    | chr3:139954597_141339097 | Hi-C,H3K4me1,H3K27ac,H3K4me3      | 0.0828827353298337 | 2.858e-06 | RASA2     |
| chr3:141106063_T_C | rs7632381   | chr3:139954597_141339097 | Hi-C,H3K4me1,H3K27ac,H3K4me3      |  0.107334842154585 | 2.158e-06 | RASA2     |
| chr3:141106954_A_T | rs13077048  | chr3:139954597_141339097 | H3K4me1,H3K27ac,Hi-C              | 0.0106463282135183 | 4.464e-06 | RASA2     |
| chr3:141110074_A_G | rs4683606   | chr3:139954597_141339097 | H3K4me1,H3K27ac                   |  0.016804309276977 | 2.705e-06 |           |
| chr3:141118028_A_G | rs13068733  | chr3:139954597_141339097 | H3K4me1,H3K27ac                   | 0.0157066759454859 | 2.917e-06 |           |
| chr3:141121814_A_C | rs2871960   | chr3:139954597_141339097 | ATAC,H3K4me1,H3K27ac,H3K4me3      | 0.0381888300210145 | 1.526e-06 |           |
| chr3:141124607_T_C | rs2011092   | chr3:139954597_141339097 | H3K4me1,H3K27ac,H3K4me3           | 0.0574520631512038 | 9.778e-07 |           |
| chr3:141125186_A_G | rs1344674   | chr3:139954597_141339097 | H3K4me1,H3K27ac,H3K4me3           | 0.0821540692633212 | 6.634e-07 |           |
| chr3:141125439_T_C | rs6767899   | chr3:139954597_141339097 | H3K4me1,H3K27ac,H3K4me3           |  0.052864893968443 |  1.07e-06 |           |
| chr3:141125705_C_G | rs1344672   | chr3:139954597_141339097 | H3K4me1,H3K27ac,H3K4me3           | 0.0587360750162226 | 9.537e-07 |           |
| chr3:141128804_G_A | rs13099193  | chr3:139954597_141339097 | H3K4me1,H3K27ac                   | 0.0272922839911848 | 1.602e-06 |           |
| chr3:141129999_G_A | rs13066993  | chr3:139954597_141339097 | H3K4me1,H3K27ac,H3K4me3           | 0.0269137975390084 | 1.622e-06 |           |
| chr3:141130835_C_T | rs35225290  | chr3:139954597_141339097 | H3K4me1,H3K27ac                   | 0.0283500611164137 | 1.538e-06 |           |
| chr3:141133450_G_A | rs1991431   | chr3:139954597_141339097 | ATAC,H3K4me1,H3K27ac,H3K4me3      | 0.0526126433234183 | 7.814e-07 |           |
| chr3:141133960_G_A | rs13091182  | chr3:139954597_141339097 | H3K4me1,H3K27ac                   |  0.026560720210736 | 1.647e-06 |           |
| chr3:141139330_G_A | rs6785073   | chr3:139954597_141339097 | H3K4me1,H3K27ac                   | 0.0278761056038784 | 1.559e-06 |           |
| chr3:141140366_A_T | rs6763927   | chr3:139954597_141339097 | H3K4me1,H3K27ac                   | 0.0475870193360597 | 8.742e-07 |           |
| chr3:141140968_C_T | rs9846396   | chr3:139954597_141339097 | H3K4me1,H3K27ac                   | 0.0459534601878102 | 9.087e-07 |           |
| chr3:141142691_G_A | rs6440006   | chr3:139954597_141339097 | H3K4me1,H3K27ac                   | 0.0220796801739341 | 2.012e-06 |           |
| chr3:141150026_A_G | rs7625643   | chr3:139954597_141339097 | H3K4me1,H3K27ac,H3K4me3           | 0.0115807940637556 |  5.59e-06 |           |
| chr3:141154542_T_C | rs6440008   | chr3:139954597_141339097 | H3K4me1,H3K27ac,H3K4me3           | 0.0115037684673659 |   4.1e-06 |           |
| chr3:155820102_A_G | rs1994502   | chr3:154714218_156008700 | H3K4me1                           | 0.0315705105041723 | 3.701e-08 |           |
| chr3:155829897_G_T | rs28406457  | chr3:154714218_156008700 |                                   | 0.0123771721542963 | 3.555e-09 |           |
| chr3:155843745_C_T | rs13073556  | chr3:154714218_156008700 |                                   | 0.0101730081646089 | 4.355e-09 |           |
| chr3:155844010_A_G | rs4680232   | chr3:154714218_156008700 |                                   | 0.0120379185615658 | 3.659e-09 |           |
| chr3:155844353_A_T | rs4680233   | chr3:154714218_156008700 |                                   | 0.0122575994904055 | 3.582e-09 |           |
| chr3:155846398_T_G | rs11709514  | chr3:154714218_156008700 |                                   | 0.0173152479298468 | 2.492e-09 |           |
| chr3:155852076_C_T | rs6793964   | chr3:154714218_156008700 | Hi-C                              | 0.0586581178156451 | 2.856e-09 | KCNAB1    |
| chr3:155855597_A_G | rs56231269  | chr3:154714218_156008700 |                                   | 0.0206945603600636 | 2.056e-09 |           |
| chr3:155856674_G_A | rs9814661   | chr3:154714218_156008700 |                                   | 0.0189715141319304 | 2.259e-09 |           |
| chr3:155856843_T_C | rs9856468   | chr3:154714218_156008700 |                                   | 0.0189715141319304 | 2.261e-09 |           |
| chr3:155858044_A_G | rs6441035   | chr3:154714218_156008700 | Hi-C                              | 0.0204668484227688 | 2.084e-09 | KCNAB1    |
| chr3:155859113_A_G | rs4680237   | chr3:154714218_156008700 | Hi-C                              | 0.0794132056931665 | 2.062e-09 | KCNAB1    |
| chr3:155861563_G_A | rs7618820   | chr3:154714218_156008700 | Hi-C                              | 0.0769301930110344 | 2.134e-09 | KCNAB1    |
| chr3:155862524_A_G | rs4359773   | chr3:154714218_156008700 | Hi-C                              | 0.0179991929992214 | 2.389e-09 | KCNAB1    |
| chr3:155862593_A_G | rs4359774   | chr3:154714218_156008700 | Hi-C                              | 0.0191336479751648 | 2.237e-09 | KCNAB1    |
| chr3:155862705_T_C | rs4605502   | chr3:154714218_156008700 | Hi-C                              | 0.0184444336474435 | 2.315e-09 | KCNAB1    |
| chr3:155867092_A_G | rs9882088   | chr3:154714218_156008700 | H3K4me1                           |   0.19115688143615 | 5.515e-09 |           |
| chr3:155868039_G_A | rs4679761   | chr3:154714218_156008700 | H3K4me1,H3K27ac,Hi-C              |  0.247185586838391 | 5.041e-09 | KCNAB1    |
| chr4:174726131_T_G | rs5014764   | chr4:174264132_176570716 | H3K4me1,H3K27ac                   | 0.0399164630650034 | 7.474e-07 |           |
| chr4:174728566_T_G | rs13121843  | chr4:174264132_176570716 | H3K4me1,H3K27ac,H3K4me3,ATAC,Hi-C | 0.0505149760256708 | 7.909e-07 | HAND2     |
| chr4:174728703_C_T | rs13141656  | chr4:174264132_176570716 | H3K4me1,H3K27ac,H3K4me3,ATAC,Hi-C |  0.381114818123928 |  3.86e-07 | HAND2     |
| chr4:174729014_G_A | rs7663453   | chr4:174264132_176570716 | H3K4me1,H3K27ac,H3K4me3,Hi-C      |  0.329331089464829 | 4.482e-07 | HAND2     |
| chr4:174729270_A_G | rs7689307   | chr4:174264132_176570716 | H3K4me1,H3K27ac,H3K4me3,Hi-C      | 0.0742724933484663 | 5.175e-07 | HAND2     |
| chr4:174729550_C_T | rs12512745  | chr4:174264132_176570716 | H3K4me1,H3K27ac,Hi-C              |  0.057620400846482 |  4.98e-07 | HAND2     |
| chr4:174741209_C_T | rs13140184  | chr4:174264132_176570716 | H3K4me1,H3K27ac                   |   0.05060760706165 | 5.796e-07 |           |
| chr5:157884706_T_C | rs2946164   | chr5:156628700_158825698 | H3K4me1                           |   0.72179868954602 | 3.036e-26 |           |
| chr5:157886627_C_T | rs2946179   | chr5:156628700_158825698 |                                   | 0.0307636206410981 | 3.046e-26 |           |
| chr5:157886953_A_G | rs7729301   | chr5:156628700_158825698 |                                   | 0.0309460059451321 | 3.025e-26 |           |
| chr5:157887966_C_T | rs6881817   | chr5:156628700_158825698 |                                   |  0.044774365818272 | 2.059e-26 |           |
| chr5:157888115_C_T | rs6881996   | chr5:156628700_158825698 |                                   | 0.0597826928217112 | 1.637e-26 |           |
| chr5:157891878_A_G | rs2946160   | chr5:156628700_158825698 | Hi-C                              | 0.0189353165784302 | 5.304e-26 | CLINT1    |
| chr5:157892530_T_C | rs2964481   | chr5:156628700_158825698 | ATAC,Hi-C                         | 0.0158141577185017 | 6.023e-26 | CLINT1    |
| chr5:157894747_T_C | rs12520982  | chr5:156628700_158825698 |                                   | 0.0159819700855176 | 5.784e-26 |           |
| chr5:157895049_C_T | rs2963463   | chr5:156628700_158825698 |                                   | 0.0358461958975438 | 2.688e-26 |           |
| chr5:157896786_T_C | rs2963462   | chr5:156628700_158825698 |                                   | 0.0197827615962538 | 4.465e-26 |           |
| chr9:80323020_G_A  | rs7857953   | chr9:79471208_81079055   | H3K27ac,H3K4me1,H3K4me3,ATAC      |  0.027312545096304 | 4.007e-07 |           |
| chr9:80325842_T_C  | rs12345348  | chr9:79471208_81079055   | H3K27ac,H3K4me1                   | 0.0134875757958209 | 6.351e-07 |           |
| chr9:80330718_C_G  | rs4745664   | chr9:79471208_81079055   | H3K27ac,H3K4me1                   | 0.0161642640233651 | 5.157e-07 |           |
| chr9:80341653_C_T  | rs7875020   | chr9:79471208_81079055   | H3K27ac,H3K4me1                   | 0.0162926105675348 | 5.174e-07 |           |
| chr9:80348352_T_C  | rs3780299   | chr9:79471208_81079055   | H3K27ac,H3K4me1                   | 0.0205531080184171 |  4.03e-07 |           |
| chr9:80358635_A_G  | rs979354    | chr9:79471208_81079055   | H3K27ac,H3K4me1                   | 0.0255334454675957 | 3.152e-07 |           |
| chr9:80364115_C_A  | rs10869963  | chr9:79471208_81079055   | H3K27ac,H3K4me1                   | 0.0231025988823537 |  3.53e-07 |           |
| chr9:80422183_C_T  | rs3780305   | chr9:79471208_81079055   | H3K27ac,H3K4me1,ATAC              | 0.0217229109454142 | 3.819e-07 |           |
| chr9:80454629_A_C  | rs1887772   | chr9:79471208_81079055   | H3K27ac,H3K4me1,H3K4me3,ATAC      | 0.0491457489135665 | 2.159e-07 |           |
| chr9:80455316_G_A  | rs1854325   | chr9:79471208_81079055   | H3K27ac,H3K4me1                   | 0.0527779301613946 | 1.449e-07 |           |
| chr9:80456737_G_A  | rs1328524   | chr9:79471208_81079055   | H3K4me1,H3K27ac                   | 0.0397775696949738 | 1.987e-07 |           |
| chr9:80460024_A_T  | rs1328525   | chr9:79471208_81079055   | H3K4me1                           | 0.0196432858174973 | 3.457e-07 |           |
| chr9:80472931_C_T  | rs11145589  | chr9:79471208_81079055   | H3K4me1,H3K27ac                   |  0.104850691148267 | 7.031e-08 |           |
| chr9:80494386_G_A  | rs7860090   | chr9:79471208_81079055   | H3K27ac,H3K4me1                   | 0.0102610686893942 | 6.993e-07 |           |
| chr9:80500405_C_T  | rs10781468  | chr9:79471208_81079055   | H3K4me1                           | 0.0124630171944785 | 5.613e-07 |           |
| chr9:80544662_C_A  | rs7852315   | chr9:79471208_81079055   | H3K4me1,Hi-C                      | 0.0136326435515508 |   5.2e-07 | CEP78     |
| chr9:80567510_T_C  | rs7866517   | chr9:79471208_81079055   | H3K4me1                           | 0.0136313870542825 | 5.154e-07 |           |
| chr9:80568980_C_A  | rs2026009   | chr9:79471208_81079055   | H3K27ac,H3K4me1                   | 0.0198831342156075 | 4.186e-07 |           |
| chr9:80604672_T_G  | rs1541056   | chr9:79471208_81079055   | H3K4me1                           | 0.0123513781784148 | 5.762e-07 |           |
| chr9:80613593_C_T  | rs1075369   | chr9:79471208_81079055   | H3K4me1                           | 0.0124069103980547 | 5.763e-07 |           |
| chr9:80614389_C_T  | rs7044515   | chr9:79471208_81079055   | H3K27ac,H3K4me1,H3K4me3,ATAC      | 0.0185851907029475 | 6.075e-07 |           |
| chr9:80624691_T_C  | rs1930544   | chr9:79471208_81079055   | H3K4me1,Hi-C                      | 0.0122962589861165 | 5.794e-07 | PSAT1     |
| chr9:80629814_G_C  | rs4744857   | chr9:79471208_81079055   | H3K27ac,H3K4me1,H3K4me3           | 0.0117351495396265 | 1.003e-06 |           |
| chr9:80630009_T_C  | rs10781478  | chr9:79471208_81079055   | H3K27ac,H3K4me1,H3K4me3           | 0.0129516300398346 | 9.094e-07 |           |
| chr9:80630123_C_T  | rs10870007  | chr9:79471208_81079055   | H3K27ac,H3K4me1,H3K4me3           | 0.0110208340036504 | 1.093e-06 |           |
| chr9:80630131_A_C  | rs10870008  | chr9:79471208_81079055   | H3K27ac,H3K4me1,H3K4me3           |  0.011181512258733 |  1.05e-06 |           |
| chr9:80638165_T_C  | rs1041584   | chr9:79471208_81079055   | H3K27ac,H3K4me1,H3K4me3,ATAC      | 0.0117493645723988 | 7.287e-07 |           |
| chr9:80638290_C_T  | rs1041583   | chr9:79471208_81079055   | H3K27ac,H3K4me1,H3K4me3,ATAC      | 0.0103051853694986 | 8.545e-07 |           |
| chr9:80649703_A_C  | rs10870013  | chr9:79471208_81079055   | H3K27ac,H3K4me1                   | 0.0119636716103413 | 7.242e-07 |           |

#+BEGIN_SRC R :dir :session rexp :var goodsnps=goodsnps :colnames yes
filter(good_hic,snp==snp[1]) %>% mutate(anno=map_chr(anno,function(x){
        paste0(unique(str_remove(x,".+-")),collapse=",")
        }))
#+END_SRC

#+RESULTS:
| snp               | anno                 | tag_snp           |  tag_pval |      pval |      prior |              pip | CS   | ldmr                   |       uniform_pip | uniform_prior | hic_region             | bait_gene | target_gene | hic_id | locus_id | type   | hic_dist | rsid      | r |
|-------------------+----------------------+-------------------+-----------+-----------+------------+------------------+------+------------------------+-------------------+---------------+------------------------+-----------+-------------+--------+----------+--------+----------+-----------+---|
| chr1:22468215_C_T | H3K4me1,H3K4me3,ATAC | chr1:22468215_C_T | 6.414e-13 | 6.414e-13 | 0.00011143 | 0.27230339640513 | TRUE | chr1:21736588_23086883 | 0.251585635073609 |    1.3271e-05 | chr1:22468614_22470707 | C1QC      |        WNT4 |   1979 |       15 | target |      399 | rs3820282 | 1 |
| chr1:22468215_C_T | H3K4me1,H3K4me3,ATAC | chr1:22468215_C_T | 6.414e-13 | 6.414e-13 | 0.00011143 | 0.27230339640513 | TRUE | chr1:21736588_23086883 | 0.251585635073609 |    1.3271e-05 | chr1:22468614_22470707 | WNT4      |           0 |   1949 |       15 | bait   |      399 | rs3820282 | 1 |
| chr1:22468215_C_T | H3K4me1,H3K4me3,ATAC | chr1:22468215_C_T | 6.414e-13 | 6.414e-13 | 0.00011143 | 0.27230339640513 | TRUE | chr1:21736588_23086883 | 0.251585635073609 |    1.3271e-05 | chr1:22468614_22470707 | WNT4      |           0 |   1950 |       15 | bait   |      399 | rs3820282 | 1 |
| chr1:22468215_C_T | H3K4me1,H3K4me3,ATAC | chr1:22468215_C_T | 6.414e-13 | 6.414e-13 | 0.00011143 | 0.27230339640513 | TRUE | chr1:21736588_23086883 | 0.251585635073609 |    1.3271e-05 | chr1:22468614_22470707 | WNT4      |           0 |   1951 |       15 | bait   |      399 | rs3820282 | 1 |
| chr1:22468215_C_T | H3K4me1,H3K4me3,ATAC | chr1:22468215_C_T | 6.414e-13 | 6.414e-13 | 0.00011143 | 0.27230339640513 | TRUE | chr1:21736588_23086883 | 0.251585635073609 |    1.3271e-05 | chr1:22468614_22470707 | WNT4      |           0 |   1952 |       15 | bait   |      399 | rs3820282 | 1 |
| chr1:22468215_C_T | H3K4me1,H3K4me3,ATAC | chr1:22468215_C_T | 6.414e-13 | 6.414e-13 | 0.00011143 | 0.27230339640513 | TRUE | chr1:21736588_23086883 | 0.251585635073609 |    1.3271e-05 | chr1:22468614_22470707 | WNT4      |           0 |   1953 |       15 | bait   |      399 | rs3820282 | 1 |
| chr1:22468215_C_T | H3K4me1,H3K4me3,ATAC | chr1:22468215_C_T | 6.414e-13 | 6.414e-13 | 0.00011143 | 0.27230339640513 | TRUE | chr1:21736588_23086883 | 0.251585635073609 |    1.3271e-05 | chr1:22468614_22470707 | WNT4      |           0 |   1954 |       15 | bait   |      399 | rs3820282 | 1 |
| chr1:22468215_C_T | H3K4me1,H3K4me3,ATAC | chr1:22468215_C_T | 6.414e-13 | 6.414e-13 | 0.00011143 | 0.27230339640513 | TRUE | chr1:21736588_23086883 | 0.251585635073609 |    1.3271e-05 | chr1:22468614_22470707 | WNT4      |           0 |   1955 |       15 | bait   |      399 | rs3820282 | 1 |
| chr1:22468215_C_T | H3K4me1,H3K4me3,ATAC | chr1:22468215_C_T | 6.414e-13 | 6.414e-13 | 0.00011143 | 0.27230339640513 | TRUE | chr1:21736588_23086883 | 0.251585635073609 |    1.3271e-05 | chr1:22468614_22470707 | WNT4      |        C1QC |   1956 |       15 | bait   |      399 | rs3820282 | 1 |
    
    #+BEGIN_SRC R :dir :session rexp :var checks=goodsnps :colnames yes
    gsnps <- left_join(checks,left_join(asgl,susie_ld)) %>% 
    select(rsid,snp,anno,pip,ldmr) %>% 
      as_tibble() %>%
      mutate(anno=map_chr(anno,function(x){
        paste0(unique(str_remove(x,".+-")),collapse=",")
        }))

#+END_SRC

#+RESULTS:
| rsid        | snp                | anno                             |               pip | ldmr                     |
|-------------+--------------------+----------------------------------+-------------------+--------------------------|
| rs147843771 | chr3:138843356_G_A | H3K4me1                          | 0.740639510360678 | chr3:137371083_139954597 |
| rs17315501  | chr3:139029676_G_A | H3K4me1,H3K4me3,ATAC,H3K27ac     | 0.211193096775336 | chr3:137371083_139954597 |
| rs2946164   | chr5:157884706_T_C | H3K4me1                          |  0.72179868954602 | chr5:156628700_158825698 |
| rs13141656  | chr4:174728703_C_T | H3K4me1,H3K27ac,H3K4me3,ATAC,HIC | 0.381114818123928 | chr4:174264132_176570716 |
| rs7663453   | chr4:174729014_G_A | H3K4me1,H3K27ac,H3K4me3,HIC      | 0.329331089464829 | chr4:174264132_176570716 |
| rs13387174  | chr2:74206685_G_A  | HIC,H3K4me1,H3K27ac              | 0.353729177223882 | chr2:73174848_75630086   |
| rs4677884   | chr3:123062970_G_C | H3K4me1,ATAC                     | 0.337861345969416 | chr3:121974097_123517768 |
| rs56318008  | chr1:22470407_C_T  | H3K4me1,H3K4me3,ATAC,HIC         | 0.302745288641221 | chr1:21736588_23086883   |
| rs55938609  | chr1:22470451_G_C  | H3K4me1,H3K4me3,ATAC,HIC         | 0.302745288641221 | chr1:21736588_23086883   |
| rs3820282   | chr1:22468215_C_T  | H3K4me1,H3K4me3,ATAC             |  0.27230339640513 | chr1:21736588_23086883   |
| rs4679761   | chr3:155868039_G_A | H3K4me1,H3K27ac                  | 0.247185586838391 | chr3:154714218_156008700 |
| rs9882088   | chr3:155867092_A_G | H3K4me1                          |  0.19115688143615 | chr3:154714218_156008700 |
| rs3122173   | chr3:127889287_A_G | H3K4me1,HIC                      | 0.181751312175621 | chr3:126214943_128194861 |
| rs2999048   | chr3:127878416_G_A | H3K4me1,H3K27ac                  |  0.11894897541832 | chr3:126214943_128194861 |
| rs1554535   | chr3:127895986_G_A | H3K4me1,HIC,H3K27ac              | 0.098883034177444 | chr3:126214943_128194861 |

#+BEGIN_SRC R :dir :session rexp :colnames yes
rs_su_df
#+END_SRC

#+RESULTS:


* Plotting
** DONE drop ATAC from uniform vs Function(change from informed)
** DONE [#A] put back on top of one-another
** DONE [#A] top priority is the per locus plot
** DONE Enhancer mark (Histone)
** DONE Promoter mark feature
** DONE HiC  


** QQ plot

#+BEGIN_SRC R :dir :session rexp 
  library(qqman)
  library(EigenH5)
  library(ldmap)
  library(tidyverse)
  base_d <- "/home/nwknoblauch/Dropbox/scratch/ptb_scratch/"
  gwas_f <- fs::path(base_d,"ptb_gwas.h5")
                                          #ls_h5(gwas_f,"snp")
  snp_df <- read_df_h5(gwas_f,"snp",subcols = c("snp_struct","rsid","pval")) %>%
    mutate(snp_struct=ldmap:::migrate_ldmap_snp(snp_struct)) %>%
    explode_snp_struct()  %>%
    rename(SNP = rsid,
           CHR = chrom,
           BP = pos,
           P = pval)
  png(filename = "~/Dropbox/MOD paper 1/Figures_GWAS/FigureS_Manhattan_plot.png",width=12,height=12,res=320,units="in")      
  manhattan(snp_df, annotateTop=FALSE,suggestiveline=FALSE,
            main = "Genetic Association With Gestational Duration",col=c("#9d5fb5","#ceacdb")
            )
  dev.off()
#+END_SRC

#+RESULTS:



#+BEGIN_SRC R :dir :session rexp :results output graphics :file "~/Dropbox/MOD paper 1/Figures_GWAS/gwas_qq.png" :exports both
qqman::qq(snp_df$P)
#+END_SRC

#+RESULTS:
[[file:~/Dropbox/MOD paper 1/Figures_GWAS/gwas_qq.png]]


* eQTL
** spend UP TO half day optimizing PC adjustment
** number of e-genes should go up then down (not necessarily eQTL)


* GWAS
** TODO Manhattan Plot and QQ plot of GWAS
** TODO add comment about not having the information
** TODO put plots in GWAS folder


* This table
** DONE What does "target_gene" mean? (email noboru)
** TODO only report hic associations up to *5kb*
** TODO only report the bait of the interaction 
** TODO split Hi-C out in to it's own table
** TODO fine-mapping 
  
  #+BEGIN_SRC R :dir :session rexp :colnames yes
  filter(hic_sgl,hic_dist<gene_dist,bait_gene!=symbol,target_gene!=symbol) %>% 
  arrange(desc(pip)) %>% 
  select(-tag_snp,-tag_pval,-prior,-uniform_pip,-uniform_prior,-locus_id) %>% 
  mutate(anno=map_chr(anno,paste0,collapse=","))
  #+END_SRC
  
  #+BEGIN_SRC R :dir :session rexp :colnames yes
  hic_sgl %>% mutate(anno=map_chr(anno,paste0,collapse=",")) %>% 
  filter(hic_dist==0) %>% 
  arrange(desc(pip)) %>% 
  select(-prior,-uniform_prior,-locus_id)
  #+END_SRC

  #+RESULTS:
  | snp                |      pval |                pip | CS    | ldmr                     |         uniform_pip | symbol    | gene_region              | gene_dist | hic_region               | bait_gene | target_gene | type   | hic_dist | anno                                                                                                                                                                                                                                                                                                                                                               |
  |--------------------+-----------+--------------------+-------+--------------------------+---------------------+-----------+--------------------------+-----------+--------------------------+-----------+-------------+--------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
  | chr4:174728703_C_T |  3.86e-07 |  0.381114818123928 | TRUE  | chr4:174264132_176570716 |   0.106475089896024 | HAND2-AS1 | chr4:174451609_174506879 |    221824 | chr4:174728688_174729180 | HAND2     |           0 | target |        0 | chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-dec-H3K27ac,chip-seq-reproducible-ctr-H3K27ac,chip-seq-dec_diff-H3K27ac,chip-seq-reproducible-ctr-H3K4me3,chip-seq-dec_diff-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC,atac-seq-dec_diff-ATAC,hicd-seq-both-dec-HIC,chip-seq-dec_diff-H3K4me1 |
  | chr2:74206685_G_A  | 4.677e-07 |  0.353729177223882 | FALSE | chr2:73174848_75630086   |  0.0383732007204524 | TET3      | chr2:74213531_74335302   |      6846 | chr2:74206346_74207145   | WBP1      |           0 | target |        0 | hicd-seq-both-dec-HIC,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-dec-H3K27ac                                                                                                                                                                                                                                        |
  | chr4:174729014_G_A | 4.482e-07 |  0.329331089464829 | TRUE  | chr4:174264132_176570716 |  0.0920232212877282 | HAND2-AS1 | chr4:174451609_174506879 |    222135 | chr4:174728688_174729180 | HAND2     |           0 | target |        0 | chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-dec-H3K27ac,chip-seq-reproducible-ctr-H3K27ac,chip-seq-dec_diff-H3K27ac,chip-seq-reproducible-ctr-H3K4me3,chip-seq-dec_diff-H3K4me3,chip-seq-reproducible-dec-H3K4me3,hicd-seq-both-dec-HIC,chip-seq-dec_diff-H3K4me1                                                    |
  | chr1:22470407_C_T  |  2.34e-12 |  0.302745288641221 | TRUE  | chr1:21736588_23086883   |  0.0725333259298856 | WNT4      | chr1:22443798_22470385   |        22 | chr1:22468614_22470707   | C1QC      |        WNT4 | target |        0 | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC,hicd-seq-both-dec-HIC                                                                                                                                        |
  | chr1:22470407_C_T  |  2.34e-12 |  0.302745288641221 | TRUE  | chr1:21736588_23086883   |  0.0725333259298856 | WNT4      | chr1:22443798_22470385   |        22 | chr1:22468614_22470707   | WNT4      |           0 | bait   |        0 | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC,hicd-seq-both-dec-HIC                                                                                                                                        |
  | chr1:22470407_C_T  |  2.34e-12 |  0.302745288641221 | TRUE  | chr1:21736588_23086883   |  0.0725333259298856 | WNT4      | chr1:22443798_22470385   |        22 | chr1:22468614_22470707   | WNT4      |        C1QC | bait   |        0 | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC,hicd-seq-both-dec-HIC                                                                                                                                        |
  | chr1:22470451_G_C  |  2.34e-12 |  0.302745288641221 | TRUE  | chr1:21736588_23086883   |  0.0725333259298856 | WNT4      | chr1:22443798_22470385   |        66 | chr1:22468614_22470707   | C1QC      |        WNT4 | target |        0 | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC,hicd-seq-both-dec-HIC                                                                                                                                        |
  | chr1:22470451_G_C  |  2.34e-12 |  0.302745288641221 | TRUE  | chr1:21736588_23086883   |  0.0725333259298856 | WNT4      | chr1:22443798_22470385   |        66 | chr1:22468614_22470707   | WNT4      |           0 | bait   |        0 | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC,hicd-seq-both-dec-HIC                                                                                                                                        |
  | chr1:22470451_G_C  |  2.34e-12 |  0.302745288641221 | TRUE  | chr1:21736588_23086883   |  0.0725333259298856 | WNT4      | chr1:22443798_22470385   |        66 | chr1:22468614_22470707   | WNT4      |        C1QC | bait   |        0 | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3,atac-seq-reproducible-dec-ATAC,atac-seq-reproducible-ctr-ATAC,hicd-seq-both-dec-HIC                                                                                                                                        |
  | chr3:127889287_A_G | 5.401e-12 |  0.181751312175621 | TRUE  | chr3:126214943_128194861 | 0.00914146130218985 | EEFSEC    | chr3:127872313_128127489 |         0 | chr3:127889182_127889449 | GATA2     |           0 | target |        0 | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,hicd-seq-both-dec-HIC                                                                                                                                                                                                                                                                          |
  | chr3:141106063_T_C | 2.158e-06 |  0.107334842154585 | TRUE  | chr3:139954597_141339097 |  0.0175512912059427 | ZBTB38    | chr3:141043055_141168632 |         0 | chr3:141105288_141106563 | RASA2     |           0 | target |        0 | hicd-seq-both-dec-HIC,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-dec-H3K27ac,chip-seq-reproducible-ctr-H3K27ac,chip-seq-dec_diff-H3K27ac,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3                                                                                                        |
  | chr3:127895986_G_A | 1.221e-11 |  0.098883034177444 | TRUE  | chr3:126214943_128194861 | 0.00415817719491285 | EEFSEC    | chr3:127872313_128127489 |         0 | chr3:127895903_127897237 | GATA2     |           0 | target |        0 | chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-ctr-H3K4me1,hicd-seq-both-dec-HIC,chip-seq-reproducible-dec-H3K27ac,chip-seq-reproducible-ctr-H3K27ac                                                                                                                                                                                                      |
  | chr3:141105570_A_G | 2.858e-06 | 0.0828827353298337 | TRUE  | chr3:139954597_141339097 |  0.0135543180064815 | ZBTB38    | chr3:141043055_141168632 |         0 | chr3:141105288_141106563 | RASA2     |           0 | target |        0 | hicd-seq-both-dec-HIC,chip-seq-reproducible-ctr-H3K4me1,chip-seq-reproducible-dec-H3K4me1,chip-seq-reproducible-dec-H3K27ac,chip-seq-reproducible-ctr-H3K27ac,chip-seq-dec_diff-H3K27ac,chip-seq-reproducible-ctr-H3K4me3,chip-seq-reproducible-dec-H3K4me3                                                                                                        |
  | chr3:155859113_A_G | 2.062e-09 | 0.0794132056931665 | TRUE  | chr3:154714218_156008700 |  0.0534923024798815 | KCNAB1    | chr3:155838337_155861209 |         0 | chr3:155858331_155859679 | KCNAB1    |           0 | target |        0 | hicd-seq-both-dec-HIC                                                                                                                                                                                                                                                                                                                                              |
  | chr3:155861563_G_A | 2.134e-09 | 0.0769301930110344 | TRUE  | chr3:154714218_156008700 |  0.0518195401557614 | KCNAB1    | chr3:155838337_155861209 |       354 | chr3:155860834_155862503 | KCNAB1    |           0 | bait   |        0 | hicd-seq-both-dec-HIC                                                                                                                                                                                                                                                                                                                                              |
  | chr3:155852076_C_T | 2.856e-09 | 0.0586581178156451 | TRUE  | chr3:154714218_156008700 |  0.0395101995225114 | KCNAB1    | chr3:155838337_155861209 |         0 | chr3:155852003_155852361 | KCNAB1    |           0 | target |        0 | hicd-seq-both-dec-HIC                                                                                                                                                                                                                                                                                                                                              |
  | chr2:74217283_G_T  | 1.549e-07 | 0.0358040240630982 | FALSE | chr2:73174848_75630086   |   0.108115106642254 | TET3      | chr2:74213531_74335302   |         0 | chr2:74216419_74217297   | INO80B    |           0 | target |        0 | hicd-seq-both-dec-HIC                                                                                                                                                                                                                                                                                                                                              |


  
** Locus level summary

  #+BEGIN_SRC R :dir :session rexp :colnames yes

    max_sgl <- group_by(sgl, ldmr) %>%
      mutate(set_size=sum(CS)) %>%
      filter(pip==max(pip)) %>% slice(1) %>% 
      ungroup()

#+END_SRC

#+RESULTS:

#+BEGIN_SRC R :dir :session rexp 
base  <-  6 # set the height of your figure (and font)
expand  <-  2 # font size increase (arbitrarily set at 2 for the moment)
basgl %>% 
    ggplot(aes(x=`Uniform PIP`,y=`Functional PIP`,col=`Genomic Feature`),size=0.01) + 
    geom_point() + 
    geom_abline(slope=1,intercept=0) +coord_fixed()+theme(
      strip.background = element_blank(),
      strip.text.x = element_blank()
    )+
    ggtitle("Reprioritization of GWAS Candidate SNPs\nBy Functional Annotation")

ggsave(filename = "~/Dropbox/MOD paper 1/Figures_GWAS/Figure6A.png", width = 12, height = 12, dpi = "retina",units="in")

#+END_SRC

#+RESULTS:


#+BEGIN_SRC R :dir :session rexp :colnames yes
  library(ggrepel)
  rs_su_df <- left_join(distinct(asgl,snp,pip,.keep_all=TRUE),susie_ld)  %>% select(-anno,-tag_snp,-tag_pval,-pval,-prior,-contains("uniform"))

  plot_rs_df <- group_by(rs_su_df,ldmr) %>% 
    mutate(`Credible Set Size`=sum(CS),is_top=(pip==max(pip))) %>%
    ungroup() %>% filter(is_top)

#+END_SRC


#+RESULTS:
| snp                |               pip | CS   | ldmr                     | symbol | gene_region              | gene_dist | rsid        |                 r | Credible Set Size | is_top |
|--------------------+-------------------+------+--------------------------+--------+--------------------------+-----------+-------------+-------------------+-------------------+--------|
| chr3:138843356_G_A | 0.740639510360678 | TRUE | chr3:137371083_139954597 | CLSTN2 | chr3:139654027_139894915 |   -810671 | rs147843771 | 0.604851582836265 |               152 | TRUE   |


#+NAME: xinTable
| rsid        | Gene         |
|-------------+--------------|
| rs56318008  | WNT4         |
| rs13387174  | STAMBP,TET3  |
| rs4677884   | ADCY5        |
| rs3122173   | GATA2,EEFSEC |
| rs147843771 | FOXL2,MRPS22 |
| rs7632381   | RASA2,ZBTB38 |
| rs4679761   | KCNAB1       |
| rs13141656  | HAND2        |
| rs2946164   | CLINT1,EBF1  |
| rs11145589  | GNAQ         |





#+BEGIN_SRC R :dir :session rexp :var table=xinTable
plot_rs_df <- inner_join(plot_rs_df,table)
#+END_SRC

#+RESULTS:
| chr3:138843356_G_A | 0.740639510360678 | TRUE | chr3:137371083_139954597 | CLSTN2 | chr3:139654027_139894915 | -810671 | rs147843771 | 0.604851582836265 | 152 | TRUE | FOXL2,MRPS22 |


#+BEGIN_SRC R :dir :session rexp :results output graphics :file "~/Dropbox/MOD paper 1/Figures_GWAS/Figure6B.png" :exports both
plot_rs_df %>%
    mutate(name=paste0(rsid, "_", Gene)) %>% 
    ggplot(aes(x = `Credible Set Size`, y = pip)) +
    geom_point() + geom_text_repel(aes(label = name)) +
    ylab("Locus Maximum PIP")

#+END_SRC

#+RESULTS:
[[file:~/Dropbox/MOD paper 1/Figures_GWAS/Figure6B.png]]

#+BEGIN_SRC R  :session rexp :colnames yes

  library(dbplyr)

  ldmr <- ldmap:::parse_ldmap_region("chr4:174329014_174829014")

  con <- DBI::dbConnect(RMariaDB::MariaDB(), 
    host = "genome-mysql.soe.ucsc.edu",
    user = "genome",
    dbname="hg19"
  )

  genes_db <- tbl(con, "ncbiRefSeqCurated")
  names_db <- tbl(con, "ncbiRefSeqLink")

  ldch <- paste0("chr",chromosomes(ldmr))
  sldmr <- starts(ldmr)
  eldmr <- ends(ldmr)

  hand2_genes <- filter(genes_db,chrom==ldch,(cdsStart>sldmr && cdsStart<eldmr)|| (cdsEnd > sldmr && cdsEnd < eldmr)) %>% inner_join(names_db,by=c("name"="id")) %>% collect()
#+END_SRC

#+RESULTS:

#+BEGIN_SRC R :session rexp :colnames yes
hand2_genes %>% select_if(~!is.list(.)) 
#+END_SRC

#+RESULTS:
|  bin | name.x      | chrom | strand |   txStart |     txEnd |  cdsStart |    cdsEnd | exonCount | score | name2     | cdsStartStat | cdsEndStat | status    | name.y    | product                                                     | mrnaAcc     | protAcc     | locusLinkId | omimId |  hgnc | genbank     | pseudo | gbkey | source     | gene_biotype | gene_synonym | ncrna_class | externalId |
|------+-------------+-------+--------+-----------+-----------+-----------+-----------+-----------+-------+-----------+--------------+------------+-----------+-----------+-------------------------------------------------------------+-------------+-------------+-------------+--------+-------+-------------+--------+-------+------------+--------------+--------------+-------------+------------|
|  239 | NR_136197.1 | chr4  | +      | 174449750 | 174463083 | 174463083 | 174463083 |         4 |     0 | HAND2-AS1 | none         | none       | Validated | HAND2-AS1 | HAND2 antisense RNA 1 (head to head), transcript variant 7  | NR_136197.1 |             |       79804 | 617240 | 48872 | NR_136197.1 |        | ncRNA | BestRefSeq |              |              |             |            |
|  239 | NR_136198.1 | chr4  | +      | 174451521 | 174463083 | 174463083 | 174463083 |         3 |     0 | HAND2-AS1 | none         | none       | Validated | HAND2-AS1 | HAND2 antisense RNA 1 (head to head), transcript variant 8  | NR_136198.1 |             |       79804 | 617240 | 48872 | NR_136198.1 |        | ncRNA | BestRefSeq |              |              |             |            |
|  239 | NR_136193.1 | chr4  | +      | 174451521 | 174463083 | 174463083 | 174463083 |         4 |     0 | HAND2-AS1 | none         | none       | Validated | HAND2-AS1 | HAND2 antisense RNA 1 (head to head), transcript variant 3  | NR_136193.1 |             |       79804 | 617240 | 48872 | NR_136193.1 |        | ncRNA | BestRefSeq |              |              |             |            |
|  239 | NR_136192.1 | chr4  | +      | 174451521 | 174463083 | 174463083 | 174463083 |         4 |     0 | HAND2-AS1 | none         | none       | Validated | HAND2-AS1 | HAND2 antisense RNA 1 (head to head), transcript variant 2  | NR_136192.1 |             |       79804 | 617240 | 48872 | NR_136192.1 |        | ncRNA | BestRefSeq |              |              |             |            |
|  239 | NR_136200.1 | chr4  | +      | 174451521 | 174463083 | 174463083 | 174463083 |         4 |     0 | HAND2-AS1 | none         | none       | Validated | HAND2-AS1 | HAND2 antisense RNA 1 (head to head), transcript variant 10 | NR_136200.1 |             |       79804 | 617240 | 48872 | NR_136200.1 |        | ncRNA | BestRefSeq |              |              |             |            |
|  239 | NR_136199.1 | chr4  | +      | 174451521 | 174463083 | 174463083 | 174463083 |         5 |     0 | HAND2-AS1 | none         | none       | Validated | HAND2-AS1 | HAND2 antisense RNA 1 (head to head), transcript variant 9  | NR_136199.1 |             |       79804 | 617240 | 48872 | NR_136199.1 |        | ncRNA | BestRefSeq |              |              |             |            |
|  239 | NR_136194.1 | chr4  | +      | 174451521 | 174463083 | 174463083 | 174463083 |         4 |     0 | HAND2-AS1 | none         | none       | Validated | HAND2-AS1 | HAND2 antisense RNA 1 (head to head), transcript variant 4  | NR_136194.1 |             |       79804 | 617240 | 48872 | NR_136194.1 |        | ncRNA | BestRefSeq |              |              |             |            |
|  239 | NR_136201.1 | chr4  | +      | 174451521 | 174463083 | 174463083 | 174463083 |         4 |     0 | HAND2-AS1 | none         | none       | Validated | HAND2-AS1 | HAND2 antisense RNA 1 (head to head), transcript variant 11 | NR_136201.1 |             |       79804 | 617240 | 48872 | NR_136201.1 |        | ncRNA | BestRefSeq |              |              |             |            |
|  239 | NR_136195.1 | chr4  | +      | 174451521 | 174506879 | 174506879 | 174506879 |         5 |     0 | HAND2-AS1 | none         | none       | Validated | HAND2-AS1 | HAND2 antisense RNA 1 (head to head), transcript variant 5  | NR_136195.1 |             |       79804 | 617240 | 48872 | NR_136195.1 |        | ncRNA | BestRefSeq |              |              |             |            |
|  239 | NR_136196.1 | chr4  | +      | 174451521 | 174512406 | 174512406 | 174512406 |         5 |     0 | HAND2-AS1 | none         | none       | Validated | HAND2-AS1 | HAND2 antisense RNA 1 (head to head), transcript variant 6  | NR_136196.1 |             |       79804 | 617240 | 48872 | NR_136196.1 |        | ncRNA | BestRefSeq |              |              |             |            |
|  239 | NR_003679.2 | chr4  | +      | 174451608 | 174463083 | 174463083 | 174463083 |         4 |     0 | HAND2-AS1 | none         | none       | Validated | HAND2-AS1 | HAND2 antisense RNA 1 (head to head), transcript variant 1  | NR_003679.2 |             |       79804 | 617240 | 48872 | NR_003679.2 |        | ncRNA | BestRefSeq |              |              |             |            |
| 1915 | NM_021973.2 | chr4  | 0      | 174447651 | 174451378 | 174448427 | 174450440 |         2 |     0 | HAND2     | cmpl         | cmpl       | Reviewed  | HAND2     | heart and neural crest derivatives expressed 2              | NM_021973.2 | NP_068808.1 |        9464 | 602407 |  4808 | NM_021973.2 |        | mRNA  | BestRefSeq |              |              |             |            |

#+BEGIN_SRC R :session rexp :colnames yes
  hand2_genedf <-   select_if(hand2_genes,~!is.list(.)) %>%
      distinct(txStart,txEnd,.keep_all=TRUE) %>%
      transmute(start=txStart,
                end=txEnd,
                strand=if_else(strand=="+",1,-1),
                chrom=as.integer(str_remove(chrom,"chr")),
                symbol=name2) %>% compact_ldmap_region()

  hand2_genedf <- inner_join(hand2_genedf,split_by_overlap(hand2_genedf$ldmap_region),by=c("ldmap_region"="ldmr")) %>%
    group_by(group) %>%
    mutate(plot_grp=1:n()) %>%
    ungroup() %>% mutate(strand=strand==-1)





#+END_SRC

#+RESULTS:
| x    |
|------|
| TRUE |

* Fine mapping locus zoom plot


#+NAME: hand2_t
| Locus | locus_ldmr               | rsid       |
|-------+--------------------------+------------|
| HAND2 | chr4:174329014_174829014 | rs13141656 |
| HAND2 | chr4:174329014_174829014 | rs7663453  |


#+BEGIN_SRC R  :session rexp :var table=hand2_t :colnames yes
susie_hand2 <- left_join(susie_df,susie_ld) %>% inner_join(dplyr::mutate(table,locus_ldmr=ldmap:::parse_ldmap_region(locus_ldmr)))
#+END_SRC

#+RESULTS:
| snp                |      pval |      prior |               pip | CS   | region_id | ldmr                     |        uniform_pip | uniform_prior | rsid       | r | Locus | locus_ldmr               |
|--------------------+-----------+------------+-------------------+------+-----------+--------------------------+--------------------+---------------+------------+---+-------+--------------------------|
| chr4:174728703_C_T |  3.86e-07 | 0.00051366 | 0.381114818123928 | TRUE |       512 | chr4:174264132_176570716 |  0.106475089896024 |    1.3271e-05 | rs13141656 | 1 | HAND2 | chr4:174329014_174829014 |
| chr4:174729014_G_A | 4.482e-07 | 0.00051366 | 0.329331089464829 | TRUE |       512 | chr4:174264132_176570716 | 0.0920232212877282 |    1.3271e-05 | rs7663453  | 1 | HAND2 | chr4:174329014_174829014 |



#+NAME: gata2_t
| Locus | rsid      |
|-------+-----------|
| GATA2 | rs3122173 |
| GATA2 | rs2999048 |
| GATA2 | rs1554535 |
| GATA2 | rs2811476 |
| GATA2 | rs9879865 |
| GATA2 | rs9879866 |


#+BEGIN_SRC R :session rexp :var table=gata2_t :colnames yes
susie_gata2 <- left_join(susie_df,susie_ld) %>% inner_join(table)
#+END_SRC

#+RESULTS:
| snp                |      pval |      prior |                pip | CS   | region_id | ldmr                     |         uniform_pip | uniform_prior | rsid      |                 r | Locus |
|--------------------+-----------+------------+--------------------+------+-----------+--------------------------+---------------------+---------------+-----------+-------------------+-------|
| chr3:127878416_G_A | 2.008e-12 | 8.3182e-05 |   0.11894897541832 | TRUE |       356 | chr3:126214943_128194861 |  0.0230735608852745 |    1.3271e-05 | rs2999048 | 0.978056852325533 | GATA2 |
| chr3:127889287_A_G | 5.401e-12 |  0.0003207 |  0.181751312175621 | TRUE |       356 | chr3:126214943_128194861 | 0.00914146130218985 |    1.3271e-05 | rs3122173 | 0.991614750321586 | GATA2 |
| chr3:127895986_G_A | 1.221e-11 | 0.00038347 |  0.098883034177444 | TRUE |       356 | chr3:126214943_128194861 | 0.00415817719491285 |    1.3271e-05 | rs1554535 | 0.975256508031458 | GATA2 |
| chr3:127898501_A_C | 6.389e-12 | 0.00013325 | 0.0649480930862608 | TRUE |       356 | chr3:126214943_128194861 | 0.00786162624567999 |    1.3271e-05 | rs2811476 | 0.988844383308266 | GATA2 |
| chr3:127936527_T_C | 4.311e-12 | 8.3182e-05 | 0.0577792799723961 | TRUE |       356 | chr3:126214943_128194861 |  0.0112050022395398 |    1.3271e-05 | rs9879865 | 0.988771734360442 | GATA2 |
| chr3:127936532_T_C | 4.311e-12 | 8.3182e-05 | 0.0577792799723961 | TRUE |       356 | chr3:126214943_128194861 |  0.0112050022395398 |    1.3271e-05 | rs9879866 | 0.988771734360442 | GATA2 |


# chr3 128198318 128198319 rs886057921
# chr4 174450242 174450243 rs1553974835



#+BEGIN_SRC R  :session rexp
  library(ldmap)
  library(tidyverse)
  library(patchwork)
  library(santoku)
  library(wesanderson)
  ldmr <- ldmap:::parse_ldmap_region("chr4:174329014_174829014")



  #sub_hic_df <- filter(hhic_df,!is.na(region_in_region(bait_region,ldmr,TRUE)) | !is.na(region_in_region(target_region,ldmr,TRUE))) %>% filter(chromosomes(bait_region)==chromosomes(target_region))


  gen_bw_url <- function(anno, trt, sample = NA) {
    is_chip <- anno %in% c("H3K4me1", "H3K4me3", "H3K27ac")
    stopifnot(
      trt %in% c("dec", "unt"),
      anno %in% c("H3K4me1", "H3K4me3", "H3K27ac", "ATAC"),
      is.na(sample) || sample %in% c("DSC1", "DSC2", "DSC3")
    )
    is_sample <- !is.na(sample)
    if (is_sample) {
      pref <- sample
    } else {
      if (is_chip) {
        pref <- "chip-seq"
      } else {
        pref <- "atac-seq"
      }
    }
    base_url <- "https://mnlab.uchicago.edu/open/tracks/mod-dec/chip-seq/"
  #  base_url <- "/run/media/nwknoblauch/Data/ptb_scratch/"
    if (is_chip) {
      suff <- paste0("-", anno)
    } else {
      base_url <- "https://mnlab.uchicago.edu/open/tracks/mod-dec/atac-seq/"
      suff <- ""
    }
    glue::glue("{base_url}{pref}-{trt}{suff}.bw")
  }



  read_region <- function(ldmr, anno = c("H3K4me1"), trt = "unt", sample = NA) {
    stopifnot(length(ldmr) == 1)
    ret_url <- gen_bw_url(anno, trt, sample)
    gr <- GenomicRanges::GRanges(
                           seqnames = paste0(
                             "chr",
                             chromosomes(ldmr)
                           ),
                           ranges = IRanges::IRanges(starts(ldmr), ends(ldmr))
                         )
    rtracklayer::import.bw(ret_url, which = gr) %>%
      as_tibble() %>%
      mutate(seqnames = as.integer(str_remove(seqnames, "chr"))) %>%
      compact_ldmap_region(chrom = "seqnames") %>%
      dplyr::select(-strand, -width)
  }
#+END_SRC

#+BEGIN_SRC R :session rexp
  tldmr <- ldmap:::parse_ldmap_region("chr4:174329014_174829014")
  tsusie_df <- dplyr::filter(susie_df, snp %overlaps% tldmr) %>%
      arrange(positions(snp)) %>%
      left_join(susie_ld) %>%
      dplyr::left_join(dplyr::mutate(susie_hand2, is_pick = TRUE)) %>%
      mutate(
          is_pick = if_else(is.na(is_pick), FALSE, is_pick),
          is_minp = pval == min(pval)
      ) %>%
      mutate(ldc = chop(r^2, breaks = c(0.25, 0.75, 0.9)))

  ispf <- function(x) {
      filter(x, is_pick)
  }
  isppf <- function(x) {
      filter(x, is_pick | is_minp)
  }

  sp <- filter(tsusie_df, is_pick)

  pal <- c("#010101",
           "#00018b",
           "#00ff01",
           "#fe0000") %>% set_names(levels(tsusie_df$ldc))

  xpoint_1 <- filter(tsusie_df, is_pick) %>% slice(1)
  xpoint_2 <- filter(tsusie_df, is_pick) %>% slice(2)
  pip_plot <- ggplot(tsusie_df, aes(x = positions(snp), y = pip)) +
      geom_point(size = 0.4) + 
      annotate("segment",
          x = positions(xpoint_1$snp) + 20000,
          xend = positions(xpoint_1$snp),
          y = xpoint_1$pip-0.06,
          size=0.5,
          yend = xpoint_1$pip,
          arrow = arrow(length=unit(0.1,"inches"))
      ) +
      annotate("text",
          x = positions(xpoint_1$snp) + 50000,
          y = xpoint_1$pip-0.06,
          family = "Helvetica",
          size = 3,
          label = xpoint_1$rsid,
      ) +
      annotate("segment",
          x = positions(xpoint_2$snp) - 20000,
          xend = positions(xpoint_2$snp),
          size=0.5,
          y = xpoint_2$pip,
          yend = xpoint_2$pip,
          arrow = arrow(length=unit(0.1,"inches"))
      ) +
      annotate("text",
          x = positions(xpoint_2$snp) - 50000,
          y = xpoint_2$pip,
          family = "Helvetica",
          size=3,
          label = xpoint_2$rsid,
      ) +
    xlab("Position on Chromosome 4 (bp)") +
    theme_minimal(base_family="Helvetica")+
      theme(
          text = element_text(size = 8, family = "Helvetica"),
          plot.margin = margin(),
        legend.position = "none",
        panel.grid.minor = element_blank(),
          axis.title.y = element_blank()
      ) + xlim(c(starts(ldmr), ends(ldmr))) 
  p_plot <- ggplot(tsusie_df, aes(x = positions(snp), y = -log10(pval))) +
      geom_point(aes(col = ldc), size = 0.5) +
    scale_color_manual(values = pal) +
    theme_minimal(base_family="Helvetica")+
      theme(
          text = element_text(size = 6, family = "Helvetica"),
          legend.position = "none",
          plot.margin = margin(),
          axis.title.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        panel.grid.minor = element_blank(),
      ) + xlim(c(starts(ldmr), ends(ldmr)))

  temp_x <- 174450242
  temp_x2 <- 128198319
  rp <- (p_plot / pip_plot) &
    geom_vline(aes(xintercept = positions(snp)), data = ispf, linetype = "dashed") &
    geom_vline(xintercept = temp_x)
  # png(filename = "~/Dropbox/MOD paper 1/Figures_GWAS/Draft_LocusZoom.svg",width=180,height=180,,units="mm")
  # 174728858
  # svg(filename = "~/Dropbox/MOD paper 1/Figures_GWAS/Draft_LocusZoom.svg",height=3.5)
  rp
  fn <- "~/Dropbox/MOD paper 1/Figures_GWAS/Draft_LocusZoom_HAND2.png"
  ggsave(
      filename = fn,
      width = 180,
      height = 50.8,
      units = "mm",
      dpi = "retina"
  )



  ## shicdf <-  ggplot() +
  ##   geom_curve(data=sub_hic_df,aes(xend = pmax(midpoints(bait_region), midpoints(target_region)), x = pmin(midpoints(target_region), midpoints(bait_region)), y = 4, yend = 4)) +
  ##   geom_rect(aes(xmin = starts(ldmap_region),
  ##                 xmax = ends(ldmap_region),
  ##                 ymin = plot_grp,
  ##                 ymax = plot_grp + .5,
  ##                 col=factor(strand),fill=factor(strand)),data=hand2_genedf)+
  ##   scale_colour_manual(values = c(
  ##                         "FALSE" = "#ff0000",
  ##                         "TRUE" = "#0101fa"
  ##                       ))+
  ##   scale_fill_manual(values = c(
  ##                       "FALSE" = "#ff0000",
  ##                       "TRUE" = "#0101fa"
  ##                     )) +
  ##   geom_text(aes(label=symbol,y=plot_grp+0.5,x=ends(ldmap_region)+2),hjust="left",data=hand2_genedf)+
  ##   geom_vline(aes(xintercept=positions(snp)),data=sp,linetype="dashed")+xlab("Position on Chromosome 4 (bp)")+
  ##   theme(
  ##     legend.position = "none",
  ##     plot.margin = margin(),
  ##     axis.ticks.y = element_blank(),
  ##     axis.text.y = element_blank()) + ylab("HiC Contacts")+ coord_cartesian(xlim = c(starts(ldmr),ends(ldmr)))
#+END_SRC

#+BEGIN_SRC R :session rexp :var table=xinTable_hl :file "~/Dropbox/MOD paper 1/Fine_Mapping/ggplot_Hand2.png" :results output graphics
  ldmr <- ldmap:::parse_ldmap_region("chr3:127791990-128291990")
  tldmr <- ldmr
  tsusie_df <- dplyr::filter(susie_df, snp %overlaps% tldmr) %>%
    arrange(positions(snp)) %>%
    left_join(susie_ld) %>%
    dplyr::left_join(dplyr::mutate(susie_gata2, is_pick = TRUE)) %>%
    mutate(is_pick = if_else(is.na(is_pick), FALSE, is_pick),
           is_minp=pval==min(pval)) %>%
    mutate(ldc=chop(r^2,breaks=c(0.25,0.75,0.9)))

    sp <- filter(tsusie_df, is_pick)

    pal <- wes_palette("Zissou1", 4, type = "discrete") %>% set_names(levels(tsusie_df$ldc))
    pip_plot <- ggplot(tsusie_df, aes(x = positions(snp), y = pip)) +
      geom_point(aes(col = ldc)) +
      scale_color_manual(name=bquote(r^2),
                         values=pal)+
      xlab("Position on Chromosome 4 (bp)")+
      theme(
        plot.margin=margin(),
        ## axis.title.x = element_blank(),
        ## axis.text.x = element_blank(),
        ## axis.ticks.x = element_blank(),
        axis.title.y = element_blank()
      ) + xlim(c(starts(ldmr),ends(ldmr)))+scale_y_reverse()


    p_plot <- ggplot(tsusie_df, aes(x = positions(snp), y = -log10(pval))) +
      geom_point(aes(col = ldc)) +
      scale_color_manual(values=pal)+
      theme(
        legend.position = "none",
        plot.margin = margin(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank()
      ) + xlim(c(starts(ldmr),ends(ldmr)))

  temp_x2 <- 128198319
    rp <- (p_plot/pip_plot ) &
      geom_vline(aes(xintercept = positions(snp)), data = ispf,linetype="dashed") &
      ggrepel::geom_text_repel(
                 mapping = aes(label = rsid),
                 data = isppf, 
               )&geom_vline(xintercept=temp_x2)
                                            #png(filename = "~/Dropbox/MOD paper 1/Figures_GWAS/Draft_LocusZoom.svg",width=180,height=180,,units="mm")

    svg(filename = "~/Dropbox/MOD paper 1/Figures_GWAS/Draft_LocusZoom.svg")
    rp
    dev.off()


#+END_SRC
